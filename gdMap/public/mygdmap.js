!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:s})},i.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";let s,n,r;function a(){for(var t=0,e=arguments.length;t<e;t++)o(arguments[0],arguments[t]);return arguments[0]}function o(t,e){for(var i in e)t[i]=e[i];return t}i.r(e);let h={};h.init=function(t={}){this.isShow=!0,this.idKey="id";for(const e in t)this[e]=t[e];this.data=[],this.idObject={}},h.remove=function(){s.remove(this.data),this.data.length=0,this.idObject={}},h.load=function(t){this.onLoad&&this.onLoad(this,t),this.remove();const e=this;t.forEach(function(t){e.add(t)})},h.getById=function(t){return this.idObject[t]},h.del=function(t){const e=this.data.indexOf(t);if(-1!==e){const i=t.params[this.idKey];delete this.idObject[i],this.data[e].setMap(null),this.data[e]=null,this.data.splice(e,1)}else console.error("删除的对象不存在！")},h.delById=function(t){const e=this.idObject[t];if(e){const i=this.data.indexOf(e);delete this.idObject[t],this.data[i].setMap(null),this.data[i]=null,this.data.splice(i,1)}else console.error("删除的对象不存在！")},h.add=function(t){var e=this;this.onAdd&&this.onAdd(t,this);const i=this.newFeature(t);if(!i)return!1;var r,a;this.isShow&&i.setMap(s),i.params=t,i.del=function(){e.del.bind(e)(i)},this.onClick&&i.on("click",function(t){e.onClick(t.target)}),this.setContextMenu&&(r=i,a=this.setContextMenu,r.eventList=a,r.on("rightclick",function(t){var e=n.get("items");e.length>0&&n.set("items",[]),r.eventList.forEach(function(t){n.addItem(t.title,function(){t.callback(r)},t.i)}),n.open(s,t.lnglat)})),this.onDragend&&i.on("dragend",function(t){e.onDragend(t.target)}),t[this.idKey]&&(this.idObject[t[this.idKey]]=i),this.data.push(i)};var l=h;const d=function(t={}){if(!t[this.positionKey])return!1;const e=new AMap.Marker(a({},this.default,t.default||{}));return e.setPosition(t[this.positionKey]),t[this.contentKey]&&e.setContent(t[this.contentKey]),e},c=function(t={}){this.contentKey="content",this.positionKey="position",this.init(t)};(c.prototype=a({},l)).newFeature=d,c.prototype.default={};const p=function(t={}){if(!t[this.pathKey])return!1;const e=new AMap.Polyline(a({},this.default,t.default||{}));return e.setPath(t[this.pathKey]),e},u=function(t={}){this.pathKey="path",this.init(t)};(u.prototype=a({},l)).newFeature=p,u.prototype.default={};const f=function(t={}){if(!t[this.pathKey])return!1;const e=new AMap.Polygon(a({},this.default,t.default||{}));return e.setPath(t[this.pathKey]),e},y=function(t={}){this.pathKey="path",this.init(t)};(y.prototype=a({},l)).newFeature=f,y.prototype.default={};const m=function(t={}){if(!t[this.centerKey]||!t[this.radiusKey])return!1;const e=new AMap.Circle(a({},this.default,t.default||{}));return e.setCenter(t[this.centerKey]),e.setRadius(t[this.radiusKey]),e},v=function(t={}){this.centerKey="center",this.radiusKey="radius",this.init(t)};(v.prototype=a({},l)).newFeature=m,v.prototype.default={};const g=function(t={}){this.contentKey="content",this.positionKey="position",this.centerKey="center",this.radiusKey="radius",this.pathKey="path",this.typeKey="type",this.init(t)};(g.prototype=a({},l)).newFeature=function(t){let e=null;switch(t[this.typeKey]){case"marker":e=d.bind(this)(t);break;case"polygon":e=f.bind(this)(t);break;case"polyline":e=p.bind(this)(t);break;case"circle":e=m.bind(this)(t)}return e},g.prototype.default={};var k=g;const M=function(t={}){t.default&&(t.default=a(this.default,t.default)),t.markerDefault&&(delete t.default,t.default=t.markerDefault);const e=new AMap.MarkerClusterer(map,[],this.default);return e.add=function(t){this.markers.add(t),this.addMarker(this.markers.data[this.markers.data.length-1])},e.remove=function(){this.clearMarkers(),this.markers.remove()},e.load=function(t){this.markers.load(t),this.setMarkers(this.markers.data)},e.getById=function(t){return this.markers.getById(t)},e.delById=function(t){var e=this.markers.getById(t);this.removeMarker(e),this.markers.delById(t)},e.markers=new c(a({},t,{isShow:!1})),e};M.prototype.default={};var w=M;const x=function(t){const e=this;this.data=null,this.title=t.title,this.width=t.width?t.width+"px":"auto";let i="";t.butsModal?i=t.butsModal(t.buts,this.data):t.buts.forEach(function(e){i+='                <a class="'+(t.btnClass?t.btnClass:"my_iw_btn")+'" href="javascript:void(0)">'+e+"</a>            "}),this.btnHtml=i,t.butClick&&$("body").on("click",".my_iw_btns a",function(){t.butClick($.trim($(this).text()),e.data)}),$("body").on("click",".amap-info-close",function(){r.close()}),this.render=t.modal||function(i){e.data=i;let s="";for(let e in t.field)s+='<tr><td><span class="my_iw_title">'+t.field[e]+'</span>：<span class="my_iw_colon_1">'+i[e]+"</span></td></tr>";return"            <table>"+s+"</table>        "}};x.prototype.show=function(t,e){r.open(map,t);const i='        <div class="my_infoWindow" style="width:'+this.width+'">            <span class="weui-loadmore__tips" style="cursor: pointer;" id="infowindow_context_close">                <a href="javascript:void(0);" style="color: red;">&gt;&gt;</a>                <span id="infowindow_context_title">'+this.title+'</span>                <a href="javascript:void(0);" style="color: red;">&lt;&lt;</a>                <a class="amap-info-close" href="javascript: void(0)">×</a>            </span>            <div class="my_iw_main">                '+this.render(e)+'            </div>            <div class="my_iw_btns">'+this.btnHtml+'</div>            <div class="my_iw_top"></div>            <div class="my_iw_bottom"></div>        </div>        <div class="my_iw_jt"></div>    ';r.setContent(i)},x.prototype.hide=function(){r.close()};var b=x;const P=function(t,e,i){var s=Math.PI/180,n=180/Math.PI,r=function(t,e){this.lon=t,this.lat=e,this.x=s*t,this.y=s*e};r.prototype.view=function(){return String(this.lon).slice(0,4)+","+String(this.lat).slice(0,4)},r.prototype.antipode=function(){var t=-1*this.lat,e=this.lon<0?180+this.lon:-1*(180-this.lon);return new r(e,t)};var a=function(){this.coords=[],this.length=0};a.prototype.move_to=function(t){this.length++,this.coords.push(t)};var o=function(t){this.properties=t||{},this.geometries=[]};o.prototype.json=function(){if(this.geometries.length<=0)return{geometry:{type:"LineString",coordinates:null},type:"Feature",properties:this.properties};if(1==this.geometries.length)return{geometry:{type:"LineString",coordinates:this.geometries[0].coords},type:"Feature",properties:this.properties};for(var t=[],e=0;e<this.geometries.length;e++)t.push(this.geometries[e].coords);return{geometry:{type:"MultiLineString",coordinates:t},type:"Feature",properties:this.properties}},o.prototype.wkt=function(){for(var t="",e="LINESTRING(",i=function(t){e+=t[0]+" "+t[1]+","},s=0;s<this.geometries.length;s++){if(0===this.geometries[s].coords.length)return"LINESTRING(empty)";this.geometries[s].coords.forEach(i),t+=e.substring(0,e.length-1)+")"}return t};var h=function(t,e,i){if(!t||void 0===t.x||void 0===t.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");if(!e||void 0===e.x||void 0===e.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");this.start=new r(t.x,t.y),this.end=new r(e.x,e.y),this.properties=i||{};var s=this.start.x-this.end.x,n=this.start.y-this.end.y,a=Math.pow(Math.sin(n/2),2)+Math.cos(this.start.y)*Math.cos(this.end.y)*Math.pow(Math.sin(s/2),2);if(this.g=2*Math.asin(Math.sqrt(a)),this.g==Math.PI)throw new Error("it appears "+t.view()+" and "+e.view()+" are 'antipodal', e.g diametrically opposite, thus there is no single route but rather infinite");if(isNaN(this.g))throw new Error("could not calculate great circle between "+t+" and "+e)};return h.prototype.interpolate=function(t){var e=Math.sin((1-t)*this.g)/Math.sin(this.g),i=Math.sin(t*this.g)/Math.sin(this.g),s=e*Math.cos(this.start.y)*Math.cos(this.start.x)+i*Math.cos(this.end.y)*Math.cos(this.end.x),r=e*Math.cos(this.start.y)*Math.sin(this.start.x)+i*Math.cos(this.end.y)*Math.sin(this.end.x),a=e*Math.sin(this.start.y)+i*Math.sin(this.end.y),o=n*Math.atan2(a,Math.sqrt(Math.pow(s,2)+Math.pow(r,2)));return[n*Math.atan2(r,s),o]},h.prototype.Arc=function(t,e){var i=[];if(!t||t<=2)i.push([this.start.lon,this.start.lat]),i.push([this.end.lon,this.end.lat]);else for(var s=1/(t-1),n=0;n<t;++n){var r=s*n,h=this.interpolate(r);i.push(h)}for(var l=!1,d=0,c=e&&e.offset?e.offset:10,p=180-c,u=-180+c,f=360-c,y=1;y<i.length;++y){var m=i[y-1][0],v=i[y][0],g=Math.abs(v-m);g>f&&(v>p&&m<u||m>p&&v<u)?l=!0:g>d&&(d=g)}var k=[];if(l&&d<c){var M=[];k.push(M);for(var w=0;w<i.length;++w){var x=parseFloat(i[w][0]);if(w>0&&Math.abs(x-i[w-1][0])>f){var b=parseFloat(i[w-1][0]),P=parseFloat(i[w-1][1]),K=parseFloat(i[w][0]),_=parseFloat(i[w][1]);if(b>-180&&b<u&&180==K&&w+1<i.length&&i[w-1][0]>-180&&i[w-1][0]<u){M.push([-180,i[w][1]]),w++,M.push([i[w][0],i[w][1]]);continue}if(b>p&&b<180&&-180==K&&w+1<i.length&&i[w-1][0]>p&&i[w-1][0]<180){M.push([180,i[w][1]]),w++,M.push([i[w][0],i[w][1]]);continue}if(b<u&&K>p){var C=b;b=K,K=C;var I=P;P=_,_=I}if(b>p&&K<u&&(K+=360),b<=180&&K>=180&&b<K){var S=(180-b)/(K-b),j=S*_+(1-S)*P;M.push([i[w-1][0]>p?180:-180,j]),(M=[]).push([i[w-1][0]>p?-180:180,j]),k.push(M)}else M=[],k.push(M);M.push([x,i[w][1]])}else M.push([i[w][0],i[w][1]])}}else{var A=[];k.push(A);for(var T=0;T<i.length;++T)A.push([i[T][0],i[T][1]])}for(var D=new o(this.properties),F=0;F<k.length;++F){var O=new a;D.geometries.push(O);for(var B=k[F],E=0;E<B.length;++E)O.move_to(B[E])}return D},new h(e,i).Arc(t,{offset:0}).geometries[0].coords},K=function(t={}){this.endKey="end",this.idKey="id",this.type="type",t.speed=t.speed||30,t.time=t.time||1e4;for(const e in t)this[e]=t[e];this.fps=(this.time-500)/this.speed,this.devices=[],this.renderTimer=null,this.index=0,this.trackMarker=null,this.polyline=new AMap.Polyline({}||this.default),this.path=[]};K.prototype={running:function(t){const e=this;this.clear();for(let e=0,i=t.length;e<i;e++)switch(t[e][this.type]){case"change":let i=this.markers.getById(t[e][this.idKey]);if(i){const s=i.getPosition();i.moveShapes=P(this.speed,{x:s.lng,y:s.lat},{x:t[e][this.endKey][0],y:t[e][this.endKey][1]}),this.devices.push(i)}break;case"add":this.markerClusterer?this.markerClusterer.add(t[e]):this.markers.add(t[e]);break;case"del":this.markerClusterer?this.markerClusterer.delById(t[e][this.idKey]):this.markers.delById(t[e][this.idKey])}this.trackMarker&&this.trackMarker.moveShapes&&this.trackMarker.moveShapes.length>0&&this.path.push(this.trackMarker.moveShapes[0]),this.renderTimer=setInterval(function(){if(e.index>=e.speed)return clearInterval(e.renderTimer),!1;e.render(),e.index++},this.fps)},clear:function(){clearInterval(this.renderTimer),this.index<this.speed&&(this.index=this.speed-1,this.render()),this.devices.forEach(function(t){t.moveShapes.length=0}),this.devices.length=0,this.index=0},render:function(){for(let t=0;t<this.devices.length;t++)this.devices[t].moveShapes&&this.devices[t].moveShapes[this.index]&&this.devices[t].setPosition(this.devices[t].moveShapes[this.index]);r.feature&&r.feature.moveShapes&&r.feature.moveShapes[this.index]&&r.setPosition(r.feature.moveShapes[this.index]),this.trackMarker&&this.trackMarker.moveShapes&&this.trackMarker.moveShapes[this.index]&&(this.path[this.path.length-1]=this.trackMarker.moveShapes[this.index],this.polyline.setPath(this.path))},startTrack:function(t){var e=this.markers.getById(t);if(!e||this.trackMarker===e)return!1;this.clearTrack(),this.markerClusterer&&(this.markerClusterer.removeMarker(e),s.add(e)),this.trackMarker=e;const i=e.getPosition();this.path.push(i),this.path.push(i),s.add(this.polyline)},clearTrack:function(){if(!this.trackMarker)return!1;this.markerClusterer&&this.markerClusterer.addMarker(this.trackMarker),this.trackMarker=null,s.remove(this.polyline),this.path.length=0}};const _={data:[],runData:[],timeout:null,rate:20,isPaly:!1,index:0,markerDefault:{},polylineDefault:{},init:function(t={}){for(const e in t)this[e]=t[e]},setData:function(t=[]){if(t.length<1)return!1;(this.marker||this.polyline||this.passedPolyline)&&this.remove(),this.data=t,this.runData.length=0,t[0].timestamp=new Date(t[0].time).getTime();for(let e=1,i=t.length;e<i;e++)if(t[e].timestamp=new Date(t[e].time).getTime(),t[e-1].position!==t[e].position){const i=t[e].timestamp-t[e-1].timestamp,s=AMap.GeometryUtil.distance(t[e-1].position,t[e].position)/i*3600;t[e-1].speed=s}this.marker=new AMap.Marker(a({},this.markerDefault,{position:t[0].position,map:s,autoRotation:!0})),this.polyline=new AMap.Polyline(a({},this.polylineDefault,{map:s})),this.passedPolyline=new AMap.Polyline(a({},this.polylineDefault,{map:s}));const e=this;this.marker.on("moving",function(t){e.passedPolyline.setPath([e.startPosition,t.passedPath[1]])}),this.marker.on("moveend",function(t){e.index++,e.start(e.index)}),this.isPaly=!0,this.start()},getPath:function(t){const e=[];e.push(this.data[0].position);for(let i=0;i<t;i++)e.push(this.data[i+1].position);return e},start:function(t=0){const e=this.data[t],i=this.data[t+1],s=this;if(this.onStart&&this.onStart({index:t,speed:e.speed||0,start:e.position,end:i.position}),!i)return!1;if(this.index=t,e.speed){const s=this.getPath(t);this.startPosition=e.position,this.polyline.setPath(s),this.marker.setPosition(e.position),this.marker.moveTo(i.position,e.speed*this.rate)}else this.timeout=setTimeout(function(){clearTimeout(s.timeout),s.index++,s.start(s.index)},(i.timestamp-e.timestamp)/this.rate)},pause:function(){if(!this.isPaly)return!1;this.isPaly=!1,this.data[this.index].speed?this.marker.pauseMove():clearTimeout(this.timeout)},play:function(){if(this.isPaly)return!1;this.isPaly=!0,this.data[this.index].speed?this.marker.resumeMove():this.start(this.index)},reload:function(t){this.index=t,this.marker.stopMove(),clearTimeout(this.timeout),this.passedPolyline.setPath([]);const e=this.getPath(t);this.polyline.setPath(e),this.marker.setPosition(e[e.length-1]),this.start(t),this.isPaly=!0},remove:function(){this.marker.stopMove(),this.marker.setMap(null),this.marker=null,this.polyline.setMap(null),this.polyline=null,this.passedPolyline.setMap(null),this.passedPolyline=null}};const C={getMap:function(){return s},setMap:function(t,e={},i={}){return s=new AMap.Map(t,e||{}),!i.notContextMenu&&(n=new AMap.ContextMenu),!i.notInfoWindow&&(r=new AMap.InfoWindow),s},getContextMenu:function(){return n},getInfoWindow:function(){return r},setInfoWindow:function(t={}){for(let e in t)r.set(e,t[e])},playback:_,Markers:c,Polylines:u,Polygons:y,Circles:v,OverlayGroup:k,MarkerClusterer:w,InfoWindowCustom:b,MarkerRunning:K};window.gdMap=C}]);