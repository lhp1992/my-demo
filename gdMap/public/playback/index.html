<!DOCTYPE HTML>
<html>
<head>
<meta name="viewport" content="width=device-width initial-scale=1.0 maximum-scale=1.0 user-scalable=0">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>3D地图</title>
<style type="text/css">
    html,body,#container{
        width: 100%;
        height: 100%;
        margin: 0;
    }
    .button-group {
        position: absolute;
        bottom: 20px;
        right: 20px;
        font-size: 12px;
        padding: 10px;
    }
    .button-group .button {
        height: 28px;
        line-height: 28px;
        background-color: #0D9BF2;
        color: #FFF;
        border: 0;
        outline: none;
        padding-left: 5px;
        padding-right: 5px;
        border-radius: 3px;
        margin-bottom: 4px;
        cursor: pointer;
    }
    .slider-container{
        display: inline-block;
    }
</style>
<script src="../jquery.min.js"></script>
<script language="javascript" src="http://webapi.amap.com/maps?v=1.4.7&key=2d5b9876e9b0a4a522ced74a580450c9"></script>
<script type="text/javascript" src="../mygdmap.js"></script>

<link rel="stylesheet" type="text/css" href="jquery.range.css">
<script type="text/javascript" src="jquery.range.js"></script>

</head>
<body >
    <div id="container"></div>
    <div class="button-group">
        <input id="play" class="button" type="button" value="播放">
        <input id="pause" class="button" type="button" value="暂停">
        <input type="hidden" class="slider-input" value="">
    </div>
</body>
<script type="text/javascript">

    function randomPoints (n) {
        var center = map.getCenter()
        var lngX = center.lng
        var latY = center.lat
        let arr = []
        for (var i = 1; i < (n + 1); i++) {
            var point = []
            point[0] = lngX + (Math.random() * 2 - 1) * 0.01
            point[1] = latY + (Math.random() * 2 - 1) * 0.01
            arr.push({
                center: point
            })
        }
        return arr
    }

    var map = gdMap.setMap("container", {
        zoom: 15
    })

    var positions = randomPoints(10)
    var data = [
        {
            position: positions[0].center,
            time: '2018-01-08 11:30:51'
        }, {
            position: positions[0].center,
            time: '2018-01-08 11:31:51'
        }, {
            position: positions[1].center,
            time: '2018-01-08 11:32:51'
        }, {
            position: positions[1].center,
            time: '2018-01-08 11:33:51'
        }, {
            position: positions[2].center,
            time: '2018-01-08 11:34:51'
        }, {
            position: positions[2].center,
            time: '2018-01-08 11:35:51'
        }, {
            position: positions[3].center,
            time: '2018-01-08 11:36:51'
        }, {
            position: positions[3].center,
            time: '2018-01-08 11:37:51'
        }, {
            position: positions[4].center,
            time: '2018-01-08 11:38:51'
        }, {
            position: positions[4].center,
            time: '2018-01-08 11:39:51'
        }, {
            position: positions[5].center,
            time: '2018-01-08 11:40:51'
        }, {
            position: positions[5].center,
            time: '2018-01-08 11:41:51'
        }, {
            position: positions[6].center,
            time: '2018-01-08 11:42:51'
        }, {
            position: positions[6].center,
            time: '2018-01-08 11:43:51'
        }, {
            position: positions[7].center,
            time: '2018-01-08 11:44:51'
        }, {
            position: positions[7].center,
            time: '2018-01-08 11:45:51'
        }, {
            position: positions[8].center,
            time: '2018-01-08 11:46:51'
        }, {
            position: positions[8].center,
            time: '2018-01-08 11:47:51'
        }, {
            position: positions[9].center,
            time: '2018-01-08 11:48:51'
        }, {
            position: positions[9].center,
            time: '2018-01-08 11:49:51'
        }
    ]
    var len = data.length - 1
    var playback = gdMap.playback

    $('.slider-input').jRange({
        from: 0,
        to: 100,
        width: 300,
        ondragstar: function(){
            playback.onStart = null
        },
        ondragend: function(e){
            playback.onStart = onStart
            var index = Math.ceil(e / 100 * len)
            playback.reload(index)
        },
        onbarclicked: function(e){
            var index = Math.ceil(e / 100 * len)
            playback.reload(index)
        }
    });

    function onStart(opt){
        console.log('实时速度'+ opt.speed.toFixed(2) +'km/h')
        var n = Math.round(opt.index / len * 100)
        $('.slider-input').jRange('setValue', n.toString());
    }

    playback.init({
        markerDefault: {
            icon: 'JT.png',
            offset: new AMap.Pixel(-15, -12)
        },
        polylineDefault: {
            strokeStyle: 'dashed',
            strokeColor: '#f00',
            strokeWeight: 1
        },
        onStart: onStart
    })
    playback.setData(data)

    $('#play').click(function(){
        playback.play()
    })
    $('#pause').click(function(){
        playback.pause()
    })


</script>
</html>