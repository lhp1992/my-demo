_jsload_('AMap.PlaceSearch', 'g.VE=g.aa.extend({ja:[g.sa],r:function(a){this.CLASS_NAME="AMap.PlaceSearch";g.c.va(this,a);this.M=g.extend({showCover:!0,autoFitView:!0},a||{});this.M.pageIndex=this.M.pageIndex||1;this.M.pageSize="number"!==typeof this.M.pageSize||0>this.M.pageSize?10:50<this.M.pageSize?50:this.M.pageSize;this.url=g.A.Rd+"/v3/place";this.lT=this.M.renderEngine||"PlaceSearchRenderByMarkerList";if(this.M.map||this.M.panel)g.qb.load("AMap."+this.lT),this.M.extensions="all";this.M.children&&(this.M.extensions="all")}, clear:function(){g.c.add(this,"clear");this.N&&this.N.clear()},setLang:function(a){g.c.add(this,"setLang");this.M.lang=a||"zh_cn"},getLang:function(){return this.M.lang},search:function(a,b){var c=["s=rsv3","children="+(this.M.children?"1":"")];c.push("key="+g.A.key);this.Vq(this.M,{city:"city",rankBy:"sortrule",type:"types",pageIndex:"page",pageSize:"offset",extensions:"extensions",citylimit:"citylimit"},c);this.rG(this.url+"/text",c,b,{keywords:a||""},"KEYWORD",arguments)},searchInBounds:function(a, b,c){g.c.add(this,"searchInBounds");if(b){var d=["polygon="+b,"s=rsv3","children="+(this.M.children?"1":"")];d.push("key="+g.A.key);this.Vq(this.M,{city:"city",rankBy:"sortrule",type:"types",pageIndex:"page",pageSize:"offset",extensions:"extensions",citylimit:"citylimit"},d);this.rG(this.url+"/polygon",d,c,{keywords:a||""},"POLYGON",arguments)}else g.event.O(this,"error",{info:"NO_PARAMS"}),c&&"function"===typeof c&&c("error","NO_PARAMS")},searchNearBy:function(a,b,c,d){g.c.add(this,"searchNearBy"); if(b){b=g.a.Ha(b);var e=["location="+b,"s=rsv3","children="+(this.M.children?"1":"")];e.push("key="+g.A.key);c&&e.push("radius="+c);this.Vq(this.M,{city:"city",rankBy:"sortrule",type:"types",pageIndex:"page",pageSize:"offset",extensions:"extensions",citylimit:"citylimit"},e);this.rG(this.url+"/around",e,d,{keywords:a||""},"NEARBY",arguments)}else g.event.O(this,"error",{info:"NO_PARAMS"}),d&&"function"===typeof d&&d("error","NO_PARAMS")},getDetails:function(a,b){g.c.add(this,"getDetails");if(a){var c= ["id="+a,"s=rsv3"];c.push("key="+g.A.key);this.rG(this.url+"/detail",c,b,{},"ID")}else g.event.O(this,"error",{info:"NO_PARAMS"}),b&&"function"===typeof b&&b("error","NO_PARAMS")},setType:function(a){g.c.add(this,"setType");this.M.type=a},setPageIndex:function(a){g.c.add(this,"setPageIndex");this.M.pageIndex=a||1},setPageSize:function(a){g.c.add(this,"setPageSize");this.M.pageSize="number"!==typeof a||0>a?10:50<a?50:a},setCity:function(a){g.c.add(this,"setCity");this.M.city=a},setCityLimit:function(a){this.M.citylimit= a},Vq:function(a,b,c){for(var d in a)"undefined"!==typeof a[d]&&"undefined"!==typeof b[d]&&c.push(b[d]+"="+a[d]);c.push("language="+this.getLang())},rG:function(a,b,c,d,e,f){a+=0<b.length?"?"+b.join("&"):"";a=new g.fb.vb(a,{callback:"callback",vd:e,Cx:!0,PH:d});a.g("complete",function(a){this.Fc(a,c,e,f)},this);a.g("error",function(a){this.ec(a,c)},this)},fa:function(a){return a instanceof Array&&0===a.length||"undefined"===typeof a?"":a},DX:function(a){for(var b in a)a.hasOwnProperty(b)&&(a[b]=this.fa(a[b]), "object"===typeof a[b]&&this.DX(a[b]))},Bd:function(a){if(a){var b=a.split(",");return 2===b.length?new g.T(b[0],b[1]):a}return a},PN:function(a){function b(a){return a?(a=a.split(","),new g.T(a[0],a[1])):null}this.DX(a);var c={id:a.id,name:a.name,type:a.type,location:b(a.location),address:a.address,tel:a.tel,distance:parseFloat(a.distance),shopinfo:a.shopinfo};c.shopinfo=a.shopinfo&&a.shopinfo.length?a.shopinfo:"";if(a.children){for(var d=a.children,e=0,f=d.length;e<f;e++)d[e].location=b(d[e].location); c.children=d}d={website:a.website,pcode:a.pcode,citycode:a.citycode,adcode:a.adcode,postcode:a.postcode,pname:a.pname,cityname:a.cityname,adname:a.adname,email:a.email,photos:a.photos,entr_location:b(a.entr_location),exit_location:b(a.exit_location),groupbuy:"0"!==a.groupbuy_num,discount:"0"!==a.discount_num};"1"===a.indoor_map?(d.indoor_map=!0,d.indoor_data={cpid:this.fa(a.indoor_data.cpid),floor:this.fa(a.indoor_data.floor),truefloor:this.fa(a.indoor_data.truefloor)}):d.indoor_map=!1;e={groupbuys:"", discounts:"",deep_type:"",dining:"",hotel:"",cinema:"",scenic:""};if(a.rich_content){if(d.groupbuy){var f=a.rich_content.groupbuys,h=f.length;0<h&&(e.groupbuys=[]);for(var k=0;k<h;k+=1)e.groupbuys.push({title:f[k].title,type_code:f[k].typecode,type:f[k].type,detail:f[k].detail,stime:f[k].start_time,etime:f[k].end_time,count:f[k].num,sold_num:parseInt(f[k].sold_num),original_price:parseFloat(f[k].original_price),groupbuy_price:parseFloat(f[k].groupbuy_price),discount:parseFloat(f[k].discount),ticket_address:f[k].ticket_address, ticket_tel:f[k].ticket_tel,photos:f[k].photos,url:f[k].url,provider:""})}if(d.discount)for(f=a.rich_content.discounts,h=f.length,0<h&&(e.discounts=[]),k=0;k<h;k+=1)e.discounts.push({title:f[k].title,detail:f[k].detail,start_time:f[k].start_time,end_time:f[k].end_time,sold_num:parseInt(f[k].sold_num),photos:f[k].photos,url:f[k].url,provider:""})}if(a.deep_info)switch(e.deep_type=a.deep_info.type,f=a.deep_info,e.deep_type){case "cinema":e.cinema={intro:f.intro,rating:f.rating,deep_src:"",parking:f.parking, opentime_GDF:f.opentime_GDF,opentime:f.opentime,photos:f.photos};e.deep_type="CINEMA";break;case "dining":e.dining={cuisines:f.cuisines,tag:f.tag,intro:f.intro,rating:f.rating,cp_rating:f.cp_rating,deep_src:"",taste_rating:f.taste_rating,environment_rating:f.environment_rating,service_rating:f.service_rating,cost:f.cost,recommend:f.recommend,atmosphere:f.atmosphere,ordering_wap_url:f.ordering_wap_url,ordering_web_url:f.ordering_web_url,ordering_app_url:f.ordering_app_url,opentime_GDF:f.opentime_GDF, opentime:f.opentime,addition:f.addition,photos:f.photos};e.deep_type="DINING";break;case "scenic":e.scenic={intro:f.intro,rating:f.rating,deep_src:"",level:f.level,price:f.price,season:f.season,recommend:f.recommend,theme:f.theme,ordering_wap_url:f.ordering_wap_url,ordering_web_url:f.ordering_web_url,opentime_GDF:f.opentime_GDF,opentime:f.opentime,photos:f.photos};e.deep_type="SCENIC";break;case "hotel":e.hotel={rating:f.rating,star:f.star,intro:f.intro,lowest_price:f.lowest_price,faci_rating:f.faci_rating, health_rating:f.health_rating,environment_rating:f.environment_rating,service_rating:f.service_rating,traffic:f.traffic,addition:f.addition,deep_src:"",photos:f.photos},e.deep_type="HOTEL"}var f={},l;for(l in c)c.hasOwnProperty(l)&&(f[l]=c[l]);if(this.M.extensions&&"base"!==this.M.extensions){for(var m in e)e.hasOwnProperty(m)&&e[m]&&(f[m]=e[m]);for(var n in d)d.hasOwnProperty(n)&&(f[n]=d[n]);if(a.lH)for(var p in a.lH)a.lH.hasOwnProperty(p)&&a.lH[p].length&&void 0===f[p]&&(f[p]=a.lH[p])}return f}, close:function(){g.c.add(this,"close");this.closed=!0},open:function(){g.c.add(this,"open");this.closed=!1},poiOnAMAP:function(a){g.c.add(this,"poiOnAMAP");var b={},c=g.a.Ha(a.location);b.id=a.id;c&&(b.y=c.P,b.x=c.Q);b.name=a.name;b.address=a.address;g.Qh.Ks(g.Qh.j3(b))},detailOnAMAP:function(a){g.c.add(this,"detailOnAMAP");var b={},c=g.a.Ha(a.location);b.id=a.id;c&&(b.y=c.P,b.x=c.Q);b.name=a.name;g.Qh.Ks(g.Qh.h3(b))},Fc:function(a,b,c,d){if(!this.closed){var e;if(parseInt(a.status,10)){e={info:a.info, poiList:{}};e.poiList={pois:[],count:parseInt(a.count,10),pageIndex:this.M.pageIndex,pageSize:this.M.pageSize};if(a.pois)for(var f=0;f<a.pois.length;f+=1)e.poiList.pois[f]=this.PN(a.pois[f]);a.suggestion&&a.suggestion.keywords.length&&(e.keywordList=a.suggestion.keywords,e.info="TIP_KEYWORDS");if(a.suggestion&&a.suggestion.cities.length){for(var f=a.suggestion.cities,h=[],k=0;k<f.length;k+=1){var l=f[k],m;for(m in l)l.hasOwnProperty(m)&&"num"===m&&(l.count=l[m],delete l[m]);l.count=parseInt(l.count); h.push(l)}e.info="TIP_CITIES";e.cityList=h}a.count&&0!==parseInt(a.count,10)||e.cityList||e.keywordList?(g.event.O(this,"complete",e),(this.M.map||this.M.panel)&&this.hA(e,c,d),b&&"function"===typeof b&&b("complete",e)):(e.info="ok"===a.info.toLowerCase()?"NO_DATA":a.info,g.event.O(this,"complete",e),(this.M.map||this.M.panel)&&this.hA(e,c,d),b&&"function"===typeof b&&(e.cityList||e.keywordList?b("complete",e):b("no_data",{})))}else e={info:a.info},z.event.O(this,"error",e),b&&"function"===typeof b&& b("error",a.info)}},hA:function(a,b,c){var d=this;g.qb.load("AMap."+this.lT,function(){d.N||(d.render=d.N=new window.AMap[d.lT](d.M.showCover));d.N.autoRender({data:a,eventTrigger:function(a,b){g.event.O(d,a,b)},methodName:{KEYWORD:"search",NEARBY:"searchNearBy",POLYGON:"searchInBounds",ROUTE:"searchNearRoute"}[b],placeSearchInstance:d,methodArgumments:c,renderStyle:d.M.renderStyle||"newpc",panel:d.M.panel,map:d.M.map,autoFitView:d.M.autoFitView});d.BG=d.N.searchCircle})},ec:function(a,b){z.event.O(this, "error",a);b&&"function"===typeof b&&b("error",a.info)}});window.AMap.PlaceSearch=g.VE; ')