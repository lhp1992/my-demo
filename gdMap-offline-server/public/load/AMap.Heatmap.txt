_jsload_('AMap.Heatmap', '(function(a){function b(a){a||(a={});Array.prototype.slice.call(arguments,1).forEach(function(b){if(b)for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})}var c={defaultRadius:30,defaultRenderer:"canvas2d",defaultGradient:{"0.25":"rgb(0,0,255)","0.55":"rgb(0,255,0)","0.85":"yellow",1:"rgb(255,0,0)"},defaultMaxOpacity:1,defaultMinOpacity:0,defaultBlur:0.85,defaultXField:"x",defaultYField:"y",defaultValueField:"value",plugins:{}},d=function(){function a(b){this._coordinator={};this._data=[];this._radi= [];this._min=0;this._max=1;this._xField=b.xField||b.defaultXField;this._yField=b.yField||b.defaultYField;this._valueField=b.valueField||b.defaultValueField;b.radius&&(this._cfgRadius=b.radius)}var d=c.defaultRadius;b(a.prototype,{_organiseData:function(a,b){var c=a[this._xField],e=a[this._yField],f=this._radi,h=this._data,k=this._max,l=this._min,t=a[this._valueField]||1,w=a.radius||this._cfgRadius||d;h[c]||(h[c]=[],f[c]=[]);h[c][e]?h[c][e]+=t:(h[c][e]=t,f[c][e]=w);return h[c][e]>k?(b?this.setDataMax(h[c][e]): this._max=h[c][e],!1):{x:c,y:e,value:t,radius:w,min:l,max:k}},_unOrganizeData:function(){var a=[],b=this._data,c=this._radi,d;for(d in b)if(b.hasOwnProperty(d))for(var e in b[d])b[d].hasOwnProperty(e)&&a.push({x:d,y:e,radius:c[d][e],value:b[d][e]});return{min:this._min,max:this._max,data:a}},_onExtremaChange:function(){this._coordinator.emit("extremachange",{min:this._min,max:this._max})},addData:function(a){if(0<a.length)for(var b=a.length;b;)b-=1,this.addData.call(this,a[b]);else(a=this._organiseData(a, !0))&&this._coordinator.emit("renderpartial",{min:this._min,max:this._max,data:[a]});return this},setData:function(a){var b=a.data,c=b.length;this._data=[];this._radi=[];for(var d=0;d<c;d+=1)this._organiseData(b[d],!1);this._max=a.max;this._min=a.min||0;this._onExtremaChange();this._coordinator.emit("renderall",this._getInternalData());return this},removeData:function(){},setDataMax:function(a){this._max=a;this._onExtremaChange();this._coordinator.emit("renderall",this._getInternalData());return this}, setDataMin:function(a){this._min=a;this._onExtremaChange();this._coordinator.emit("renderall",this._getInternalData());return this},setCoordinator:function(a){this._coordinator=a},_getInternalData:function(){return{max:this._max,min:this._min,data:this._data,radi:this._radi}},getData:function(){return this._unOrganizeData()}});return a}(),e=function(){function a(b){var c=[],d=b.min,f=b.max,h=b.radi;b=b.data;for(var k=Object.keys(b),l=k.length;1<=l;)for(var l=l-1,m=k[l],n=Object.keys(b[m]),E=n.length;1<= E;){var E=E-1,C=n[E],F=b[m][C],A=h[m][C];e&&(A=e);c.push({x:m,y:C,value:F,radius:A})}return{min:d,max:f,data:c}}function c(a){a=a.gradient||a.defaultGradient;var b=document.createElement("canvas"),d=b.getContext("2d");b.width=256;b.height=1;var b=d.createLinearGradient(0,0,256,1),e;for(e in a)a.hasOwnProperty(e)&&b.addColorStop(e,a[e]);d.fillStyle=b;d.fillRect(0,0,256,1);return d.getImageData(0,0,256,1).data}function d(a){var b=a.container,e=this.shadowCanvas=document.createElement("canvas"),f=this.canvas= a.canvas||document.createElement("canvas");this._renderBoundaries=[2E3,2E3,0,0];var h=getComputedStyle(a.container)||{};f.className="heatmap-canvas";this._width=f.width=e.width=+h.width.replace(/px/,"");this._height=f.height=e.height=+h.height.replace(/px/,"");this.shadowCtx=e.getContext("2d");this.ctx=f.getContext("2d");f.style.cssText=e.style.cssText="position:absolute;left:0;top:0;";b.appendChild(f);this.canvas=f;this.F7=e;this._palette=c(a);this._templates={};this._setStyles(a)}var e=null;b(d.prototype, {_resetSize:function(a,b){var c=this._sizeScale||1;a=Math.ceil(a*c);b=Math.ceil(b*c);this._width=this.canvas.width=this.F7.width=a;this._height=this.canvas.height=this.F7.height=b},renderPartial:function(a){this._drawAlpha(a);this._colorize()},renderAll:function(b){this._clear();this._drawAlpha(a(b));this._colorize()},_updateGradient:function(a){this._palette=c(a)},updateConfig:function(a){a.gradient&&this._updateGradient(a);this._setStyles(a)},setDimensions:function(a,b){this._width=a;this._height= b;this.canvas.width=this.shadowCanvas.width=a;this.canvas.height=this.shadowCanvas.height=b},_clear:function(){this.shadowCtx.clearRect(0,0,this._width,this._height);this.ctx.clearRect(0,0,this._width,this._height)},_setStyles:function(a){this._blur=0===a.blur?0:a.blur||a.defaultBlur;a.backgroundColor&&(this.canvas.style.backgroundColor=a.backgroundColor);this._opacity=255*(a.opacity||0);this._maxOpacity=0===a.maxOpacity?0:255*(a.maxOpacity||a.defaultMaxOpacity);this._minOpacity=255*(a.minOpacity|| a.defaultMinOpacity);this._useGradientOpacity=!!a.useGradientOpacity;a.radius&&(this._reSetRadius=a.radius);this._noColorize=a._noColorize;this._sizeScale=a._sizeScale},_drawAlpha:function(a){var b=this._min=a.min,c=this._max=a.max;a=a.data||[];for(var d=a.length,e=1-this._blur,f=this._sizeScale||1;1<=d;){var d=d-1,h=a[d],k=h.x,l=h.y,m=h.radius,h=Math.min(h.value,c),k=k-m,l=l-m,n=this.shadowCtx,p;if(this._templates[m])p=this._templates[m];else{p=this._templates;var A=m,B=m,G=e,H=document.createElement("canvas"), I=H.getContext("2d");H.width=H.height=2*B;1===G?(I.beginPath(),I.arc(B,B,B,0,2*Math.PI,!1),I.fillStyle="rgba(0,0,0,1)",I.fill()):(G=I.createRadialGradient(B,B,B*G,B,B,B),G.addColorStop(0,"rgba(0,0,0,1)"),G.addColorStop(1,"rgba(0,0,0,0)"),I.fillStyle=G,I.fillRect(0,0,2*B,2*B));p[A]=p=H}n.globalAlpha=(h-b)/(c-b);1!==f?(h=2*m*f,n.drawImage(p,k*f,l*f,h,h)):n.drawImage(p,k,l);k<this._renderBoundaries[0]&&(this._renderBoundaries[0]=k);l<this._renderBoundaries[1]&&(this._renderBoundaries[1]=l);k+2*m>this._renderBoundaries[2]&& (this._renderBoundaries[2]=k+2*m);l+2*m>this._renderBoundaries[3]&&(this._renderBoundaries[3]=l+2*m)}},getColorByAlpha:function(a){var b=4*a;if(!b)return[0,0,0,0];var c=this._opacity,d=this._maxOpacity,e=this._minOpacity,f=this._useGradientOpacity,h=this._palette;return[h[b],h[b+1],h[b+2],f?h[b+3]:0<c?c:a<d?a<e?e:a:d]},_colorize:function(){if(!this._noColorize){var a=this._renderBoundaries[0],b=this._renderBoundaries[1],c=this._renderBoundaries[2]-a,d=this._renderBoundaries[3]-b,e=this._width,f=this._height, h=this._opacity,k=this._maxOpacity,l=this._minOpacity,m=this._useGradientOpacity;0>a&&(a=0);0>b&&(b=0);a+c>e&&(c=e-a);b+d>f&&(d=f-b);for(var c=this.shadowCtx.getImageData(a,b,c,d),d=c.data,e=d.length,f=this._palette,n=3;n<e;n+=4){var p=d[n],A=4*p;A&&(p=0<h?h:p<k?p<l?l:p:k,d[n-3]=f[A],d[n-2]=f[A+1],d[n-1]=f[A+2],d[n]=m?f[A+3]:p)}c.data=d;this.ctx.putImageData(c,a,b);this._renderBoundaries=[1E3,1E3,0,0]}},getValueAt:function(a){a=this.shadowCtx.getImageData(a.x,a.y,1,1).data[3];return a/255*Math.abs(this._max- this._min)>>0},getDataURL:function(){return this.canvas.toDataURL()},resetRadius:function(a){e=a},resetSizeScale:function(a){this._sizeScale=a||1}});return d}(),f=function(){var a=!1;"canvas2d"===c.defaultRenderer&&(a=e);return a}(),h={merge:function(){for(var a={},b=arguments.length,c=0;c<b;c+=1){var d=arguments[c],e;for(e in d)d.hasOwnProperty(e)&&(a[e]=d[e])}return a}},k=function(){function a(b){var c=b._renderer,d=b._coordinator,e=b._store;d.on("renderpartial",c.renderPartial,c);d.on("renderall", c.renderAll,c);d.on("extremachange",function(a){if(b._config.onExtremaChange)b._config.onExtremaChange({min:a.min,max:a.max,gradient:b._config.gradient||b._config.defaultGradient})});e.setCoordinator(d)}function e(b){b=this._config=h.merge(c,b||{});this._coordinator=new k;if(b.plugin){var m=b.plugin;if(c.plugins[m])m=c.plugins[m],this._renderer=new m.renderer(b),this._store=new m.store(b);else throw Error("Plugin \'"+m+"\' not found. Maybe it was not registered.");}else this._renderer=new f(b),this._store= new d(b);a(this)}var k=function(){function a(){this.cStore={}}b(a.prototype,{on:function(a,b,c){var d=this.cStore;d[a]||(d[a]=[]);d[a].push(function(a){return b.call(c,a)})},emit:function(a,b){var c=this.cStore;if(c[a])for(var d=c[a].length,e=0;e<d;e+=1)(0,c[a][e])(b)}});return a}();b(e.prototype,{addData:function(){this._store.addData.apply(this._store,arguments);return this},removeData:function(){this._store.removeData&&this._store.removeData.apply(this._store,arguments);return this},setData:function(){this._store.setData.apply(this._store, arguments);return this},clear:function(){this._renderer._clear()},setDataMax:function(){this._store.setDataMax.apply(this._store,arguments);return this},setDataMin:function(){this._store.setDataMin.apply(this._store,arguments);return this},configure:function(a){this._config=h.merge(this._config,a);a.radius&&this._renderer.resetRadius(a.radius);this._renderer.updateConfig(this._config);this._coordinator.emit("renderall",this._store._getInternalData());return this},repaint:function(){this._coordinator.emit("renderall", this._store._getInternalData());return this},getData:function(){return this._store.getData()},getDataURL:function(){return this._renderer.getDataURL()},getValueAt:function(a){return this._store.getValueAt?this._store.getValueAt(a):this._renderer.getValueAt?this._renderer.getValueAt(a):null},resetSize:function(a,b){this._renderer._resetSize(a,b)}});return e}();a.h337={create:function(a){return new k(a)},register:function(a,b){c.plugins[a]=b}}})(window); g.d$=g.aa.extend({ja:[g.sa,g.Pe],r:function(a,b){this.CLASS_NAME="AMap.Heatmap";g.c.va(this,b);b=b||{};this.options={rejectMapMask:b.rejectMapMask,visible:b.visible||!0,radius:b.radius||30,radiusUnit:b.radiusUnit||"px",gradient:b.gradient||{"0.5":"blue","0.65":"rgb(117,211,248)","0.7":"rgb(0, 255, 0)","0.9":"#ffea00",1:"red"},blur:b.blur,opacity:b.opacity||[0,1],zooms:b.zooms||[3,20],zIndex:b.zIndex||17,renderOnZooming:b.renderOnZooming,"3d":g.extend({heightScale:1,heightBezier:[0.5,0,1,0.5],gridSize:2, drawGridLine:!1},b["3d"])};this.uf={radius:this.options.radius,blur:this.options.blur,maxOpacity:this.options.opacity[1],minOpacity:this.options.opacity[0],gradient:this.options.gradient};this.y3();if(this.isCanavs=this.Qba())this.Pz=JSON.stringify({data:[]}),this.setMap(a)},vAa:function(a,b,c){a=new AMap.LngLat(a,b);b=this.options.map.getZoom();a=this.options.map.lngLatToContainer(a,b);return{x:a.x,y:a.y,value:c}},Qba:function(){return document.createElement("canvas").getContext("2d")?!0:!1},KI:function(a){return(a= a||this.options.map)&&"3D"===a.getViewMode_()},MQ:function(){return!this.KI()&&this.options.map.map?this.options.map.map.Sa:null},iW:function(){if(!this.ed){var a=this.MQ(),b=this.options.map.getSize().getWidth(),c=this.options.map.getSize().getHeight();this.ed=document.createElement("div");this.ed.id="_amap_heatmap_div_";this.ed.className="amap-layer";this.ed.style.cssText="position:absolute;top:0;left:0;";this.ed.style.zIndex=this.options.zIndex;this.ed.style.width=b+"px";this.ed.style.height=c+ "px";this.uf.container=this.ed;this.options.visible&&(a&&a.o.appendChild(this.ed),this.Mk=window.h337.create(this.uf))}},XF:function(){var a=this.options.zooms[1],b=this.options.zooms[0],c=this.options.map.getZoom();return parseInt(c)>=parseInt(b)&&parseInt(c)<=parseInt(a)},FY:function(){return this.Mk&&this.cg&&this.cg.data&&this.cg.data.length&&this.options.map&&this.options.visible&&this.XF()},Jm:function(){if(!this.FY())this.sF();else if(this.options.map){var a=this.options.map.getSize();if(a.width&& a.height)if(this.Hi)this.Hi.$N();else return this.FF()}},FF:function(a){this.yp&&this.yp.length||this.Wma();this.LD=this.options.map.get("centerCoords");var b=this.options.map.get("zoom",null,!0);this.dva=b;var c={max:this.cg.max};void 0==c.max&&(c.max=this.cg.gA);var d=[],e,f,h=this.options.radius;if(this.Hi){if(!a||!a.kC){console.warn("Not dataState passed in!!");return}b=a.kC;e=b.size;f=b.bm.Zb;b=b.kq}else f=this.options.map.getBounds(),e=this.options.map.getSize(),f=this.options.map.Ab(f.Oj()), b=Math.pow(2,20-b);this.bva=e;this.Mk.resetSize(e.width,e.height);var k=!1;this.Hi&&!this.Hi.get("rejectMapMask")&&(k=this.get("map").map.J.hd,k.lv||(k=!1));for(var l=0;l<this.yp.length;l+=1){var m=this.yp[l];if(!k||!a.Kk||k.JS(m,a.Kk)){var n=(m.x-f.x)/b,p=(m.y-f.y)/b;n>-h&&n<e.width+h&&p>-h&&p<e.height+h&&d.push({x:(m.x-f.x)/b,y:(m.y-f.y)/b,value:m.count})}}this.Hi||this.i0();c.data=d;this.bua=d.length;this.Hi||(this.ed.style.top="0px",a=this.options.map.get("rotation"),this.ed.style[g.j.eg]=a?"rotate3d(0,0,1,"+ -a+"deg)":"",this.ed.style.left="0px",this.ed.style.zIndex=this.options.zIndex,(a=this.MQ())&&this.ed.parentNode!==a.o&&a.o.appendChild(this.ed));this.Mk.setData(c)},y3:function(){var a=this.uf.gradient,b=[],c=[],d;for(d in a)a.hasOwnProperty(d)&&b.push({stop:parseFloat(d),color:a[d]});b.sort(function(a,b){return a.stop-b.stop});for(d=0;d<b.length;d+=1)a=g.a.Tm(b[d].color),c.push(b[d].stop),c.push(a[0],a[1],a[2]);this.uf.Upa=c},Sda:function(){return this.options.radius},pja:function(a){this.Mk._renderer.resetSizeScale(a)}, gda:function(a,b){var c=this.Mk._renderer;if(a===c.shadowCanvas.width&&b===c.shadowCanvas.height)return c.shadowCtx.getImageData(0,0,a,b);console.warn("resize for AlphaImageData",c.shadowCanvas.width,a);c.canvas.width=a;c.canvas.height=b;c.ctx.drawImage(c.shadowCanvas,0,0,a,b);return c.ctx.getImageData(0,0,a,b)},Koa:function(a){return this.Mk._renderer.getColorByAlpha(a)},sF:function(){this.Mk.setData({data:[]});this.Mk.clear();this.yp=[];this.q("clear")},Jw:function(){if(this.Mk){var a=g.extend({}, this.uf,{_noColorize:!!this.Hi});this.Mk.configure(a);this.q("reConfigure")}},Jca:function(){return!!(this.Pz&&this.options.map&&this.options.visible&&this.isCanavs&&this.XF())},i0:function(){this.Mk&&this.options.map&&this.ed&&(this.D0?this.ed.style.visibility="hidden":!0===this.options.visible&&!0===this.XF()?"visible"!==this.ed.style.visibility&&(this.Jw(),this.ed.style.visibility="visible"):"hidden"!==this.ed.style.visibility&&(this.Jw(),this.ed.style.visibility="hidden"))},renderChanged:function(){if(this.options.map.map)if(this.options.map.map.Dk&& !this.options.renderOnZooming||!1===this.options.visible)this.ed.style.visibility="hidden";else if(this.options.map.map.zg&&this.LD)this.sv();else{var a=this.options.map;if(a){var b=a.get("centerCoords"),c=a.getSize();0!=c.width&&0!=c.height&&(b.cb(this.LD)&&this.dva===a.getZoom()&&c.cb(this.bva)||this.Jm())}}},sv:function(){var a=this.options.map;if(a){var b=a.get("centerCoords");if(!b.cb(this.LD)){var a=Math.pow(2,20-a.get("zoom",null,!0)),c=(this.LD.x-b.x)/a;this.ed.style.top=(this.LD.y-b.y)/a+ "px";this.ed.style.left=c+"px"}}},setOptions:function(a){g.c.add(this,"setOptions");if(this.isCanavs){a=a||{};var b=this.options;this.options.radius=a.radius||b.radius;this.options.radiusUnit=a.radiusUnit||b.radiusUnit;this.options.gradient=a.gradient||b.gradient;this.options.opacity=a.opacity||b.opacity;this.options.zooms=a.zooms||b.zooms;this.options.zIndex=a.zIndex||b.zIndex;this.options.visible="boolean"===typeof a.visible?a.visible:b.visible;this.options.rejectMapMask=a.rejectMapMask;this.options["3d"]= g.extend({},this.options["3d"],a["3d"]);this.uf={radius:this.options.radius,blur:this.options.blur,maxOpacity:this.options.opacity[1],minOpacity:this.options.opacity[0],gradient:this.options.gradient};this.y3();this.Mk&&this.Jca()&&(this.Jw(),this.Jm());this.i0()}},getOptions:function(){g.c.add(this,"getOptions");if(this.isCanavs){var a={},b;for(b in this.options)this.options.hasOwnProperty(b)&&"map"!==b&&"visible"!==b&&(a[b]=this.options[b]);return a}},setDataSet:function(a){g.c.add(this,"setDataSet"); if("string"===typeof a.data){var b=this;new g.fb.vb(a.data,{callback:"callback",callbackFunction:function(c){a.data="function"===typeof a.dataParser?a.dataParser(c):c;b.O_(a)}})}else this.O_(a)},O_:function(a){if(this.isCanavs)if(this.Pz=JSON.stringify({data:[]}),this.cg=null,a){this.cg=a;if(void 0==a.max){for(var b=0,c=0;c<a.data.length;c+=1)b=Math.max(a.data[c].count,b);a.gA=b}else delete a.gA;this.Pz=JSON.stringify(a);this.yp=null;this.Mk&&this.options.map&&(this.Jw(),this.Jm())}else this.sF()}, Wma:function(){this.yp=[];if(this.cg)for(var a=[Infinity,Infinity,-Infinity,-Infinity],b=0,c=this.cg.data.length;b<c;b+=1){var d=this.cg.data[b],d=this.a5(d.lng,d.lat,d.count);this.yp.push(d);g.I.SH(a,[d.x,d.y])}},a5:function(a,b,c){a=this.options.map.Ab([a,b]);a.count=c;return a},getDataSet:function(){g.c.add(this,"getDataSet");if(this.isCanavs)return this.cg},addDataPoint:function(a,b,c){g.c.add(this,"addDataPoint");if(this.isCanavs){c||isNaN(c)||(c=1);if(this.cg){var d=JSON.parse(this.Pz);d.data.push({lng:a, lat:b,count:c});this.cg=d}else this.cg={gA:0},this.cg.data=[],this.cg.data.push({lng:a,lat:b,count:c});void 0==this.cg.max&&(this.cg.gA=Math.max(this.cg.gA||0,c));this.yp&&this.yp.push(this.a5(a,b,c));this.Pz=JSON.stringify(this.cg);this.Jw();this.Jm()}},HO:function(){if(this.options.map){var a=this.MQ();a&&a.o.appendChild(this.ed)}},Q6:function(a){if(this.KI(a))this.options.map=null,this.Hi&&this.Hi.setMap(null);else{var b=this.ed;b&&b.parentNode&&b.parentNode.removeChild(b);a.G("complete",this.HO, this);this.hl("render",a);this.options.map=null}},Bka:function(a){this.KI(a)?(this.Hi||(this.Hi=new z.o.mV(this,this.options)),this.Hi&&(this.options.map=a,this.ed||this.iW(),this.Hi.setMap(a))):(this.options.map=a,this.ed||this.iW(),a.Ja?this.HO():a.g("complete",this.HO,this,!0),this.W("render",a))},setMap:function(a){g.c.add(this,"setMap");if(this.isCanavs){var b=this.options.map;a?a!==b&&(b&&this.Q6(b),this.Bka(a)):b&&this.Q6(b)}},hide:function(){g.c.add(this,"hide");this.isCanavs&&(this.options.visible= !1,this.q("reConfigure"),this.ed&&(this.D0=!0,this.ed.style.visibility="hidden"))},show:function(){g.c.add(this,"show");this.isCanavs&&(this.options.visible=!0,this.q("reConfigure"),this.ed&&this.XF()&&(this.D0=!1,this.ed.style.visibility="visible",this.Jw(),this.Jm()))},getMap:function(){g.c.add(this,"getMap");if(this.isCanavs)return this.options.map},setzIndex:function(a){g.c.add(this,"setzIndex");this.KI()?this.Hi&&this.Hi.setzIndex(a):this.ed&&(this.ed.style.zIndex=this.options.zIndex);this.options.zIndex= a},getzIndex:function(){g.c.add(this,"getzIndex");return this.options.zIndex}});window.AMap.Heatmap=g.d$;z.o.mV=window.AMap.GLCustomLayer.extend({B:{vertexShader:"precision mediump float;attribute highp vec3 a_position;varying vec4 v_color;uniform vec4 u_ceil;uniform highp vec4 u_params;uniform lowp int u_heightFuncType;uniform highp vec4 u_bezier;uniform highp mat4 u_modelViewMatrix;uniform highp mat4 u_projectionMatrix;uniform vec4 u_gradient[8];vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3){    float t2 = t * t;    float one_minus_t = 1.0 - t;    float one_minus_t2 = one_minus_t * one_minus_t;    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);}vec2 toBezier(float t, vec4 p){\\treturn toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));}float fade(float low, float high, float value) {\\tif(value<low||value>high){return 0.0;}\\treturn (value-low)/(high-low);}vec4 getColor(float intensity) { \\tint s=0;\\tvec3 color = vec3(0);\\tfor(int gn=0;gn<8;gn+=1){\\t\\tif(u_gradient[gn].x>=intensity){\\t\\t\\ts=gn;\\t\\t\\tbreak;\\t\\t}\\t}\\tif(s<8){\\t\\tif(s==0){\\t\\t\\tcolor = mix(vec3(0,0,1),u_gradient[0].yzw,fade(0.0, u_gradient[0].x, intensity));\\t\\t}else{\\t\\t\\tcolor = mix(u_gradient[s-1].yzw,u_gradient[s].yzw,fade(u_gradient[s-1].x, u_gradient[s].x, intensity));\\t\\t}\\t}\\treturn vec4(color.xyz,intensity);}void main(void) {   float alpha = a_position.z / 255.0;\\tfloat fh; \\tfh = toBezier(alpha,u_bezier).y; \\tfloat x = a_position.x*u_ceil.x+u_ceil.z;\\tfloat y = a_position.y*u_ceil.y+u_ceil.w;\\tvec4 pos =  vec4(x , y, fh * -50.0 * u_params.x, 1.0);\\tv_color = getColor(alpha);\\tgl_Position = u_projectionMatrix * u_modelViewMatrix *  pos;\\tgl_PointSize = 1.0;}", fragmentShader:"precision mediump float;varying vec4 v_color;void main(void) {\\tif(v_color.a==0.0){\\t\\tdiscard;\\t}\\tgl_FragColor = v_color;}",type:"heatMap3DLayer"},r:function(a,b){if(!g.l.Ok)return null;this.bh=this.Kqa=!0;this.fg=a;this.fg.g("clear",this.$N,this);this.fg.g("reConfigure",this.Jia,this);z.o.mV.Sc.r.call(this,null,b)},getWebGLVariableLoaction:function(a,b){b.GO=a.getAttribLocation(b,"a_position");b.GB=a.getAttribLocation(b,"a_color");b.wU=a.getUniformLocation(b,"u_params");b.jxa=a.getUniformLocation(b, "u_ceil");b.fxa=a.getUniformLocation(b,"u_bezier");b.oxa=a.getUniformLocation(b,"u_gradient");b.pxa=a.getUniformLocation(b,"u_heightFuncType")},qda:function(a,b){var c=this.fg.cg.data;if(!c||!c.length)return null;var d=a.get("zoom",null,!0),e=Math.pow(2,20-d),f=a.getBounds(),h=b*e,k=[Infinity,Infinity,-Infinity,-Infinity],l=!1,m,n=f.path,p=[],f=0;for(m=n.length;f<m;f++){var q=n[f][0];0>q&&(q=-80<q?0:170);p.push([q,n[f][1]])}f=0;for(m=c.length;f<m;f++)n=c[f],n=[parseFloat(n.lng),parseFloat(n.lat)], g.wd.Nd(n,p,!1)&&(g.I.SH(k,n),l=!0);if(!l)return null;c=a.Ab([k[0],k[3]]);f=a.Ab([k[2],k[1]]);k=c.x;c=c.y;l=f.x;f=f.y;k-=3*h;c-=3*h;l+=3*h;f+=3*h;h=new g.Gf(k,c,l,f);k=[Math.ceil((l-k)/e),Math.ceil((f-c)/e)];return{zoom:d,kq:e,size:new g.xd(k[0],k[1]),bm:h}},$N:function(){var a=this.get("map");a&&a.map&&a.map.set("display")},Jia:function(){this.vm=null;this.fY=!1;this.B_()},B_:function(){this.eO&&clearTimeout(this.eO);var a=this;this.eO=setTimeout(function(){a.eO=null;a.$N()},100)},hda:function(a, b,c){this.fg.pja(1/b.q9);this.fg.FF({kC:a,Kk:c});if(!(0>=this.fg.bua)){a=this.fg.gda(b.Fq,b.Zv);b=a.data;c=b.length/4;for(var d=new Uint8Array(c),e=0;e<c;e++)d[e]=b[4*e+3];return{width:a.width,height:a.height,n7:d}}},onRender:function(a,b,c){if(this.fg&&this.fg.FY()&&this.fg.options.visible){var d=this.fg.options["3d"].gridSize,e=this.get("map"),f=!1,h=e.view.wo(),k=this.qda(e,this.fg.Sda()+10,d,d);if(k){if(this.vm){var l=this.vm.kC,m=l.bm;l.kq===k.kq&&m.Zb.cb(k.bm.Zb)&&m.Fd.cb(k.bm.Fd)&&(f=!0);!e.map.Dk&& e.map.zg&&(f=!0)}if(!f){d=this.rba(k,d,d);c=this.hda(k,d,c);if(!c)return;this.Lba(d,c);c=this.lba(d);this.vm={kC:k,SB:c}}this.FF(a,b);h||this.B_()}else this.vm=null}},rba:function(a,b,c){var d=a.size.height,e=Math.ceil(a.size.width/b),d=Math.ceil(d/c);return{kq:a.kq,bm:a.bm,Fq:e,Zv:d,q9:b,vya:c,bK:null}},Cja:function(a,b,c){a.bK[b[1]*a.Fq+b[0]]=c},MX:function(a,b){return a.bK[b[1]*a.Fq+b[0]]},Yza:function(a){for(var b=[[0,0],[a.Fq,0],[a.Fq,a.Zv],[0,a.Zv]],c=[],d=a.bm.Zb.y,e=a.bm.Zb.x,f=a.q9,h=a.vya, k=0,l=b.length;k<l;k++){var m=b[k];c.push.apply(c,[m[0]*f*a.kq+e-g.a.ac.x,m[1]*h*a.kq+d-g.a.ac.y,0,1])}return{Y:new Float32Array(c),jE:new Uint16Array([0,1,2,0,2,3]),sra:[]}},lba:function(a){for(var b=[],c=a.bm.Zb.y,d=a.bm.Zb.x,e=Math.floor(a.Fq)||1,f=Math.floor(a.Zv)||1,h=e+1,k=f+1,l=(a.bm.Fd.x-d)/e,m=(a.bm.Fd.y-c)/f,b=new Float32Array(h*k*3),n=0,p=0;p<k;p++)for(var q=0;q<h;q++){b[n]=q;b[n+1]=p;var r=0,r=this.MX(a,[q,p])||0;b[n+2]=r;n+=3}n=0;a=new Uint32Array(e*f*6);for(p=0;p<f;p++)for(q=0;q<e;q++){var k= q+h*(p+1),r=q+1+h*(p+1),s=q+1+h*p;a[n]=q+h*p;a[n+1]=s;a[n+2]=k;a[n+3]=k;a[n+4]=s;a[n+5]=r;n+=6}a=new Uint32Array(a.buffer,0,n);return{Y:b,jE:a,yva:l,xva:m,nla:c-g.a.ac.y,mla:d-g.a.ac.x}},jba:function(a,b,c,d){a.bindBuffer(a.ARRAY_BUFFER,d);a.bufferData(a.ARRAY_BUFFER,c,a.STATIC_DRAW);return d},kba:function(a,b,c,d){a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,d);a.bufferData(a.ELEMENT_ARRAY_BUFFER,c,a.STATIC_DRAW);return d},zia:function(a,b){this.xm||(this.xm=a.createBuffer());this.rca||(this.rca=a.createBuffer()); this.iM||(this.iM=a.createBuffer());this.sca||(this.sca=a.createBuffer());var c=this.get("map").get("zoom",null,!0),d=Math.abs(c-this.vm.kC.zoom),e=this.fg.options["3d"];a.uniform4fv(b.wU,[Math.pow(2,20-c)*this.fg.options["3d"].heightScale,1,1,1]);a.uniform4fv(b.jxa,[this.vm.SB.yva,this.vm.SB.xva,this.vm.SB.mla,this.vm.SB.nla]);a.uniform1f(b.oE,Math.max(0.3,0.9-d*d/4));c=e.heatToHeight;a.uniform1i(b.pxa,c?1:0);a.uniform4fv(b.fxa,e.heightBezier||[0,0,0,0]);a.uniform4fv(b.oxa,this.fg.uf.Upa);if(!this.fY){for(e= 0;256>e;e++)this.fg.Koa(e);if(c)for(e=0;256>e;e++)c(e/256);this.fY=!0}},iba:function(a,b,c){this.jba(a,b,c.Y,this.xm);this.kba(a,b,c.jE,this.iM)},HAa:function(a,b){for(var c=[],d=0;d<a;)c.push(d),d+=b;c.push(a);return c},Lba:function(a,b){if(a.Fq===b.width&&a.Zv===b.height)a.bK=b.n7;else{console.warn("Repos score!!",a,b);var c=Math.min(a.Fq,b.width),d=Math.min(a.Zv,b.height),e=b.width,f=b.n7;a.bK=new Uint8Array(a.Fq*a.Zv);for(var h=0;h<c;h+=1)for(var k=0;k<d;k+=1){var l=k*e+h;0<f[l]&&this.Cja(a,[h, k],f[l])}}},Xza:function(a,b,c,d,e){function f(){l.length&&m.push({Y:l,jE:r,sra:u});l=[];q={};r=[];s={};u=[];n=0}function h(a,b){var c=a+"_"+b,d=q[c];if(0<=d)return d;d=n++;l[d]=[a,b];return q[c]=d}function k(a,b){n+4>=p&&f();var c=[h(a,b),h(a+1,b),h(a+1,b+1),h(a,b+1)];r.push.apply(r,[c[0],c[1],c[2],c[0],c[2],c[3]]);if(v)for(var d=0,e=c.length;d<e;d++){var k=[c[d],d<e-1?c[d+1]:c[0]];k[0]>k[1]&&(k=[k[1],k[0]]);var l=k[0]+"_"+k[1];s[l]||(u.push.apply(u,k),s[l]=1)}}for(var l=[],m=[],n=0,p=65E3,q={}, r=[],s={},u=[],v=this.fg.options["3d"].drawGridLine;b<c;b+=1)for(var x=d;x<e;x+=1)this.MX(a,[b,x])&&k(b,x);q=s=null;f();return m.length?m:null},FF:function(a,b){this.vm&&(a.getExtension("OES_element_index_uint"),a.enable(a.BLEND),a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA),a.enable(a.DEPTH_TEST),a.clear(a.DEPTH_BUFFER_BIT),this.zia(a,b),a.enableVertexAttribArray(b.GO),a.bindBuffer(a.ARRAY_BUFFER,this.xm),a.vertexAttribPointer(b.GO,3,a.FLOAT,!1,0,0),this.Pca(a, b),a.disableVertexAttribArray(b.GO),a.disable(a.DEPTH_TEST),a.disable(a.BLEND))},Pca:function(a,b){var c=this.vm.SB;this.iba(a,b,c);c.jE.length&&(a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.iM),a.drawElements(a.TRIANGLES,c.jE.length,a.UNSIGNED_INT,0))}}); ')