_jsload_('AMap.PolyEditor', 'g.G$=g.aa.extend({ja:[g.sa],r:function(a,b){this.e=a;this.Jd=b;this.yb=g.A.yb;this.CLASS_NAME="AMap.PolyEditor";g.c.va(this)},P1:function(){this.hb||this.ut();for(var a=0;a<this.hb.length;a+=1)for(var b=this.hb[a],c=0;c<b.length;c+=1)b[c].setMap(this.e),b[c].Pn&&b[c].Pn.setMap(this.e)},S6:function(){if(this.hb){for(var a=0;a<this.hb.length;a+=1)for(var b=this.hb[a],c=0;c<b.length;c+=1)b[c].setMap(null),b[c].hi(),b[c].Pn&&(b[c].Pn.setMap(null),b[c].Pn.hi());delete this.hb}},open:function(){g.c.add(this, "open");this.P1();this.Jd.g("setPath",this.m6,this)},m6:function(){this.S6();this.P1()},close:function(){g.c.add(this,"close");this.S6();this.Jd.G("setPath",this.m6,this);g.event.O(this,"end",{type:"end",target:this.Jd})},ut:function(){this.hb=[];var a=this.Jd.getPath();if(a.length){a[0]instanceof g.T&&(a=[a]);this.xt=a;for(var b=0;b<a.length;b+=1){var c=a[b];this.hb[b]=[];for(var d=0,e=0,f=0,d=0,f=c.length;d<f;d+=1)e=this.Xh(c[d],d,b),e.g("click",this.GN,this),this.hb[b].push(e);d=0;for(e=f-1;d< f;e=d,d+=1)if(0!==d||z.w.yc&&this.Jd instanceof z.w.yc)c=this.hb[b][e],e=this.hb[b][d],this.xF(c,e,b),this.UG(c,e)}}},Xh:function(a,b,c){var d=new z.w.rb({position:a,draggable:!0,icon:new z.w.Th({size:new g.xd(11,11),imageOffset:new g.H(0,0),image:this.yb+"/images/dd-via.png",innerOverlay:!0}),offset:new g.H(-6,-6),cursor:"pointer",zIndex:this.Jd.get("zIndex")+1E3,innerOverlay:!0});d.za=!0;d.AAa=a;d.uh=b;d.xl=c;d.g("dragging",this.Fm,this);d.g("dragend",function(a){this.Gn(a);var b={target:this.Jd}; b.lnglat=a.target.getPosition();a=this.e.lngLatToContainer(b.lnglat);b.pixel=new g.H(a.x,a.y,1);g.event.O(this,"adjust",b)},this);return d},tG:function(a){var b=a.uh;a.setMap(null);this.hb[a.xl].splice(b,1);this.xt[a.xl].splice(b,1);this.xv(this.xt,!0);this.s0(this.hb[a.xl]);a.G("dragging",this.Fm,this).G("dragend",this.Gn,this).G("click",this.GN,this)},Gn:function(){this.Jd.Qna=!0;this.Jd.q("edit")},Fm:function(a){a=a.target;a.Pd=!0;a.YA&&a.YA.setPosition(this.MM(a.jx,a));a.Pn&&a.Pn.setPosition(this.MM(a, a.cx));this.xt[a.xl][a.uh]=a.getPosition();this.xv(this.xt,!0)},GN:function(a){if(a.target.Pd||this.xt[a.target.xl].length<=(this.Jd instanceof z.w.Xb?2:3))a.target.Pd=!1;else{var b=a.target;this.tG(b);var c={target:this.Jd};c.lnglat=a.target.getPosition();a=this.e.lngLatToContainer(c.lnglat);c.pixel=new g.H(a.x,a.y,1);g.event.O(this,"removenode",c);this.UG(b.jx,b.cx);b.YA&&b.YA.setMap(null);b.Pn&&b.Pn.setMap(null);b.jx&&b.cx?this.xF(b.jx,b.cx,b.xl):b.jx?b.cx||(b.jx.Pn=null):b.cx.YA=null;this.Gn()}}, s0:function(a){for(var b=0,c=a.length;b<c;b+=1)a[b].uh=b},xv:function(a){this.Jd&&(this.Jd instanceof z.w.Xb?a=a[0]:1!==a.length||a[0]instanceof g.T||(a=a[0]),this.Jd.setPath(a,!0))},xF:function(a,b,c){var d=this.MM(a,b),e=this.Xh(d),f,h,k;e.setOpacity(0.5);e.xl=c;a.Pn=b.YA=e;h=function(){var c=b.uh;e.uh=c;e.Pd=!0;e.G("click",f,this).g("click",this.GN,this);d=e.getPosition();this.xt[e.xl].splice(c,0,d);this.xv(this.xt,!0);this.hb[e.xl].splice(c,0,e);e.setOpacity(1);this.s0(this.hb[e.xl]);this.UG(a, e);this.UG(e,b)};k=function(c){e.Pd=!1;e.G("dragstart",h,this);e.G("dragend",k,this);if(e.getMap()){var d={target:this.Jd};d.lnglat=c.target.getPosition();c=this.e.lngLatToContainer(d.lnglat);d.pixel=new g.H(c.x,c.y,1);g.event.O(this,"addnode",d);this.xF(a,e,e.xl);this.xF(e,b,e.xl)}};f=function(a){h.call(this);k.call(this,a);this.Gn()};e.g("click",f,this).g("dragstart",h,this).g("dragend",k,this);e.setMap(this.e)},UG:function(a,b){a&&(a.cx=b);b&&(b.jx=a)},MM:function(a,b){var c=this.e,d=c.hc(a.getPosition()), e=c.hc(b.getPosition());return c.Mh(d.add(e).dd(2))}});window.AMap.PolyEditor=g.G$; ')