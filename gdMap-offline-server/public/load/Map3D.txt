_jsload_('Map3D', 'g.dF=function(a,b,c){this.path=a;this.r7=b;this.height=c};g.dF.prototype={jb:function(){return new g.dF(this.path,this.r7,this.height)}};g.Kb.zb({EZ:function(a){this.cS(a);this.Kt();this.Xg=!0;a.Na&&(this.V.Yx=a.Na.x,this.V.qC=a.Na.y);this.V.JH=a.tb.x;this.V.KH=a.tb.y;this.ve&&(this.ve.stop(),this.Jr(!0));this.na("dragstart");this.na("movestart");this.q("movestart",a)},AZ:function(){var a=this.V.Mj;if(2!=a.button&&!a.ctrlKey&&!a.shiftKey||this.Sga(a)){var b=this.V;if(void 0!==b.Yx){if(!a.Na)return;var c=a.Na.x-b.Yx,a=a.Na.y-b.qC;this.P_(c,a);b=this.get("centerCoords").$a(new g.H(c,a)).toFixed(3);this.set("centerCoords",b);this.Pu&& (this.Yg?(b=new Date,this.Xw=100<b-this.Yg?new g.H(0,0):new g.H(c,a),this.Yg=b):this.Yg=new Date)}else a.Na&&(this.V.Yx=a.Na.x,this.V.qC=a.Na.y);this.na("dragging");this.na("mapmove")}},CZ:function(){this.Qv();this.Kt();100<new Date-this.Yg&&(this.Xw=null);this.V.Tf=null;this.Xg=!1;this.na("dragend");if(this.Pu&&this.Xw)if(this.V.zg){var a=this.Xw,b=new g.H(0,0);a.x>=g.a.Ca?a.x-=g.a.Ca:a.x<=-g.a.Ca&&(a.x+=g.a.Ca);this.ve=new g.vj(a,b,function(a,b,e){if(600<=e)return b;b=1-Math.pow(e/600,1.5);a.x*= b;a.y*=b;return a},1);this.ve.$p=function(a){2>Math.abs(a.x)&&2>Math.abs(a.y)?(this.ve.stop(),this.q("moveend"),this.Jr(),this.Xw=this.Yg=null):(a=this.get("centerCoords").$a(a).toFixed(3),this.set("centerCoords",a),this.na("mapmove"))};this.ve.sn(this)}else this.q("moveend"),this.Jr(!0),this.Xw=this.Yg=null;else this.q("moveend"),this.Jr(),this.Xw=this.Yg=null},Sga:function(a){var b=this.get("rotateEnable"),c=this.get("pitchEnable");if(b||c){var d=this.get("size"),e=a.tb.y-this.V.KH;if(Math.abs(a.tb.x- this.V.JH)<Math.abs(e)&&c)this.set("pitch",90*e/d.height+this.get("pitch"));else if(b){var b=this.V.JH-d.width/2,c=this.V.KH-d.height/2,e=a.tb.x-d.width/2,d=a.tb.y-d.height/2,f=Math.acos((b*e+c*d)/(Math.sqrt(b*b+c*c)*Math.sqrt(e*e+d*d)));0>b*d-e*c&&(f=-f);this.set("rotation",(f/Math.PI*180+this.get("rotation"))%360)}else return this.V.JH=a.tb.x,this.V.KH=a.tb.y,!0;this.V.JH=a.tb.x;this.V.KH=a.tb.y}else return!0}});g.p$={oFa:g.l.Z?1:2,ZFa:g.l.Z?44:22,WCa:g.l.Z?22:11,T0:g.l.Z?15:7,RI:g.l.Mc?1024:512,Dta:function(a,b,c,d){a.yi||(a.yi={});var e=c;this.RI=b.length&&b[0].Ym?g.l.Mc?1024:512:g.l.Mc?512:256;for(var f=0;f<b.length;f+=1)e=b[f].lj?"roadlabel":c,"break"==this.Eta(a,b[f],d,e)&&b.splice(f);return b},Eta:function(a,b,c,d){var e=g.l.Iy&&g.l.QD?"800":"400";b.tEa=!0;if("roadlabel"===d)if(b.dj){var f=b.name.split("");d=0;for(var h=f.length;d<h;d+=1){var k=f[d],l=k+"_"+b.zIndex,m=a.yi[l];if(m)k=a.gn,m=a.yi[l]; else{k=this.XQ(a,k,null,b.tq,b.nz,b.qy,e,null,null,c.ia);if(null==k)return"break";m=k.Pc;a.yi[l]=m}b.Da.push(k);var l=m[0],n=m[1],p=m[2],q=m[3],m=m[4];b.Le=m;b.Ta.push([-p/2,-q/2,p,q,l,n,p,q])}}else{if(b.ld&&b.ld.length){f=b.ld[0];l=f[0]+"_"+(b.c8||b.zIndex);if(m=a.yi[l])k=a.gn,m=a.yi[l];else{k=this.XQ(a,f[0],f[1],f[2],f[3],f[4],e,f[5],null,c.ia);if(null==k)return"break";m=k.Pc;a.yi[l]=m}b.Da.push(k);l=m[0];n=m[1];p=m[2];q=m[3];m=m[4];b.Le=m;m=1<f[0].length||f[6]?1:0;b.Ta[m][0]-=(p-b.Ta[m][2])/2; b.Ta[m][1]-=(q-b.Ta[m][3])/2;b.Ta[m][2]=p;b.Ta[m][3]=q;b.Ta[m][4]=l;b.Ta[m][5]=n;b.Ta[m][6]=p;b.Ta[m][7]=q}}else{if(g.A.Csa)return null;b.$l=1;if(b.ld&&b.ld.length)for(e=b.Da.length,d=0;d<b.ld.length;d+=1){f=b.ld[d];l=f[0]+"_"+(b.c8||b.zIndex);if(m=a.yi[l])k=a.gn,m=a.yi[l];else{k=this.XQ(a,f[0],f[1],f[2],f[3],f[4],null,f[5],f[7],c.ia);if(null==k)return"break";m=k.Pc;a.yi[l]=m}l=m[0];n=m[1];p=m[2];q=m[3];m=m[4];b.Le=m;m=e+d;b.Ta[m][0]-=(p-b.Ta[m][2])/2;b.Ta[m][1]-=(q-b.Ta[m][3])/2;b.Ta[m][2]=p;b.Ta[m][3]= q;b.Ta[m][4]=l;b.Ta[m][5]=n;b.Ta[m][6]=p;b.Ta[m][7]=q;b.Da.push(k)}}return b},vBa:function(){return document.createElement("img")},Qpa:function(a){return Math.min(Math.max(100*(a-this.T0),400),500)+""},XQ:function(a,b,c,d,e,f,h,k,l,m){c=a.gn;c||(a.yi={},c=g.j.create("canvas"),a.gn=c,c.width=c.height=this.RI,c.uJ=c.vJ=0,c.Re=c.getContext("2d"),c.Re.lineWidth=2,c.Re.textBaseline="alphabetic",c.Re.textAlign="left");k=c.Re;k.font="400 "+d+\'px sans-serif,-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,"Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei",SimSun, sans-serif\'; d=parseInt(k.font);if(100<d||!d)d=parseInt(k.font.split(" ")[1]);var n=m?2:1;a=d+2*n;h=Math.ceil(k.measureText(b).width);var p=0;l&&(p=n,h+=2*n,a+=n);var n=c.uJ,q=c.vJ;if(n+h>this.RI&&(n=0,q+=c.maxHeight,c.maxHeight=0,q+a>this.RI))return null;c.maxHeight=Math.max(c.maxHeight||0,a);l&&(k.fillStyle!==l&&(k.fillStyle=l),k.fillRect(n,q,h,a));f&&(l=m?3:2,k.lineWidth!==l&&(k.lineWidth=l),k.strokeStyle!==f&&(k.strokeStyle=f),k.strokeText(b,n+p,q+d));k.fillStyle!==e&&(k.fillStyle=e);k.fillText(b,n+p,q+d); b=c;c.uJ=n+h;c.vJ=q;b.Pc=[n,q+1,h,a,d];return b}};g.o.ll.zb({Hl:function(a){return new g.Ba.ll(this,a)}});g.o.ob.zb({Hl:function(a){return new g.Ba.Gi(this,a)}});g.o.md.zb({Hl:function(a){var b=this;if(!this.e.od||this.e.od&&g.qb.WC(["wgl2"]))return new g.Ba.md(b,a);g.qb.load("wgl2",function(){b.set("display")})}}); g.o.Bj.zb({Hl:function(a){var b=this,c;if(this.xR())return this.zz=!0,g.N.canvas.uL&&(this.f1(),c=new g.Ba.n$(this,a),c.g("afterLabelRender",this.fA,this)),c;b.zz=!1;if(g.N.canvas.tL)return c=new g.Ba.XK(this,a),c.g("afterLabelRender",this.fA,this),c;g.qb.Lg(["labelcanvas"],function(){b.set("display")})}});g.Ba={ye:{}}; g.Ba.RE=g.aa.extend({ja:[g.sa,g.Pe],r:function(a){this.type="3D";this.fk=g.a.nc(a.get("zoom"),1);this.VS=new g.nL;this.iC={};this.kd={};this.e=a;this.ul=a.ul;this.K=a.Sa.o;this.W("display",a);this.W("rotateEnable",a);this.W("hightlight",a);this.Vi=20;this.Za=Math.min(2,window.devicePixelRatio||1);this.Yp=1;this.Qa=document.createElement("canvas");this.Qa.className="amap-layer";a.Sa.o.appendChild(this.Qa);this.HI();this.Rm=256*Math.pow(2,18);this.Ko={};this.nq=new g.Ba.GV(this);this.Cv=new g.Ba.XE(this); this.hd=new g.Ba.w$(this);this.et=new g.Ba.et(this);this.ia=a.D.ia;this.W("style",a);this.W("zoom",a)},Of:function(){for(var a=0;a<this.Kl.length;a+=1)this.ga.deleteTexture(this.Kl[a]);this.Kl=null;this.hd&&(this.hd.Of(),this.hd=null);this.Cv.Of();this.Cv=null;this.nq.Of();this.nq=null;this.et.Of();this.et=null;for(a in this.Ko)this.Ko.hasOwnProperty(a)&&this.deleteProgram(this.Ko[a]);this.ga=this.Ko=null},deleteProgram:function(a){for(var b in a)a.hasOwnProperty(b)&&delete a[b];this.ga.deleteProgram(a)}, HI:function(){var a=this.ga=this.Qa.getContext(g.l.e9,g.l.f9);if(a)g.F.g(this.Qa,"webglcontextlost",this.nD,this),g.F.g(this.Qa,"webglcontextrestored",this.Msa,this);else return console.error("create webgl failed!"),!1;window.CGa=a.getExtension("WEBGL_lose_context");a.ywa=a.getSupportedExtensions();(g.l.chrome||g.l.QD)&&-1!==a.ywa.indexOf("OES_vertex_array_object")&&(a.ji=a.getExtension("OES_vertex_array_object"));a.enable(a.CULL_FACE);a.frontFace(a.CW);a.cullFace(a.BACK);a.clearColor(0,0,0,0);this.Kl|| (this.Kl=[this.N1()]);return!0},n4:function(a,b){var c=this.VS,d=b.Zc;if(d){d.Ue||(d.Ue=d.Ig());var e=new g.Oa(d.Ue.mh(a)),d=new g.Oa(d.Ue.mh(new g.nl(0,0,0,1))),e=e.sub(d).normalize();c.origin.copy(d);c.direction.copy(e);for(var e=b.Y,d=b.Vb,f=new g.Oa,h=new g.Oa,k=new g.Oa,l=0,m=d.length;l<m;l+=3){var n=3*d[l],p=3*d[l+1],q=3*d[l+2];f.set(e[n],e[n+1],e[n+2]);h.set(e[p],e[p+1],e[p+2]);k.set(e[q],e[q+1],e[q+2]);if(c.vy(f,h,k))return b}}},Xta:function(a){var b=[],c=this.e.get("zoom");if(this.nq.wI(c)){var d= this.n4(a,this.nq);if(d){var e={type:d.cE,color:g.RGBA.toString(d.yd)};d.Ua&&(e.texture=d.Ua);b.push(e)}}this.Cv.wI(c)&&(a=this.n4(a,this.Cv))&&(e={type:a.cE,color:g.RGBA.toString(a.yd)},a.Ua&&(e.texture=a.Ua),b.push(e));return b},qS:function(a,b,c,d){this.pe=a||g.a.As(this.e.pe.slice(1));this.YG=b||g.a.As(this.e.YG.slice(1));this.wB=c||g.a.As(this.e.wB.slice(1));this.yja=d[0]||g.a.Ek(this.e.lF[0]);this.fka=d[1]||g.a.Ek(this.e.lF[1])},Ol:function(a){"function"===typeof a&&(a=a(this.fk));return a}, EH:function(a){a.J=null;a.e=null;a.il()},Msa:function(){this.Vra=!0;for(var a=this.e.ya,b=0;b<a.length;b+=1)a[b].$f&&(a[b].$f.Lj(),a[b].$f=null);this.nq=this.EH(this.nq);this.Cv=this.EH(this.Cv);this.hd=this.EH(this.hd);this.et=this.EH(this.et);g.Aj.clear();this.e.set("display",1);this.e=null;this.il();g.j.remove(this.Qa);this.Qa=null},nD:function(a){a.preventDefault();g.N.Ne.md.yr+=1;this.set("reload");new g.fb.vb(g.A.Cc+"://webapi.amap.com/count?"+["type=glfail","c="+g.N.Ne.md.yr,"crd="+g.l.bR, "k="+g.A.key,"u="+g.A.Wt,"m="+(g.l.Z?1:0),"pf="+g.l.Uy,"mode=3d","dpr="+window.devicePixelRatio,"scale="+(g.l.IK||0),"detect="+this.ia].join("&"))},rJ:function(){g.l.m1=!1;g.l.rq=!1;this.h&&this.h.e.D&&(this.h.e.set("baseRender",g.l.QBa?"dv":"d"),this.h.e.D.eS(),this.h.N=null,this.h.U.ys(),this.h=null);this.Qa=this.J=null},Bu:function(a,b,c,d,e){function f(a,d){a.length&&(k[g.a.indexOf(b,d)]=a);l-=1;0>=l&&(c(k),l=0)}for(var h=b.length,k=[],l=0,m,n=[],p=0;p<h;p+=1)if(m=b[p],m instanceof g.o.$c&&m.get("visible")&& !m.lD&&(m=this.Du(m)))n.push(m),l+=1;for(h=0;h<n.length;h+=1)n[h].Bu(a,f,d,e)},kc:function(a){var b=this.e.H2();b&&this.bT!==b&&this.e.D.oi&&(this.e.u7(b),this.bT=b);var b=this.ga,c=this.ia?this.Za:this.Yp,d=a.size.width*c,e=a.size.height*c;a.cva=d;a.Rua=e;a.Kc=this.Kc=c;this.fk=g.a.nc(a.R.zoom,1);if(d&&e){c=this.e.D;c.DirectionLight&&(this.X4=(new g.Oa(c.DirectionLight.direction)).normalize().Lf(c.view.Bs).Lf(c.view.Yta));this.Qa.width!==d&&(this.Qa.width=d,this.Qa.style.width=a.size.width+"px"); this.Qa.height!==e&&(this.Qa.height=e,this.Qa.style.height=a.size.height+"px");b.viewport(0,0,this.Qa.width,this.Qa.height);b.clear(b.COLOR_BUFFER_BIT);var e=a.R,c=a.ya,f=this.e.D.get("features");11>e.zoom&&this.et.kc(b,a);a.hd&&this.hd.kc(b,a);for(var h=0,k=c.length;h<k;h++){var l=c[h].te(),d=c[h];if(!l.visible||d.lD||l.lb[0]>e.zoom||l.lb[1]<e.zoom)d.Pk&&d.get("container").parentNode===this.K&&this.K.removeChild(d.get("container"));else{var m=this.Du(d);m&&(d.Pk&&d.get("container").parentNode!== this.K&&this.K.appendChild(d.get("container")),this.LR(d,f)&&(l.hd&&!m.bJ?b.enable(b.STENCIL_TEST):b.disable(b.STENCIL_TEST),m.kc(b,a,l)),m.en&&(a.Qf=m.Qf))}}0<e.pitch&&(this.Cv.kc(b,a),this.nq.kc(b,a));a=this.e.Sa.qr;d=this.e.Sa.o;b=this.e.Sa.w;a.style.cssText&&(a.style.cssText="");b.style.cssText&&(b.style.cssText="");"transform: translateZ(0px);"!==d.style.cssText&&(d.style.cssText="transform: translateZ(0px);");this.e.Av=!1}},LR:function(a,b){if("all"===b||void 0===a.Dl)return!0;for(var c=0,d= a.Dl.length;c<d;c++)if(g.a.ja(b,"region"===a.Dl[c]?"bg":a.Dl[c]))return!0;return a.Jja=!1},Du:function(a){if(!a.$f&&a.Hl){var b=a.Hl(this);b&&!b.Ima&&(a.$f=b)}return a.$f},N1:function(){var a=this.ga,b=a.createTexture();a.bindTexture(a.TEXTURE_2D,b);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,new Uint8Array([0,0,0,255]));var c=a.RGB,d=a.RGB,e=a.UNSIGNED_BYTE,f=new Uint8Array([0,0,0]);a.texImage2D(a.TEXTURE_2D,0,c,1,1,0,d,e,f);return b},DC:function(a){if((a=this.iC[a])&&a.Ua){if("object"=== typeof a.Ua)return a;var b=a.Ua(this.fk);return a.hash[b]}return null},W8:function(a){var b=this,c=!1,d=this;this.Kl||(this.Kl=[this.N1()]);var e=this.iC={},f;for(f in a)a.hasOwnProperty(f)&&a[f].Ua&&(a[f].kd&&a[f].kd.length?function(){var h=a[f].kd.length;e[f]={hash:{}};c=!0;for(var k=0;k<h;k++)b.aS(f,a[f].kd[k],function(b,c,f,k,q){e[b].hash[q]={Ua:c,width:f,height:k,url:q};0===--h&&(e[b].Ua=a[b].Ua,d.set("display"))},function(b){0===--h&&g.a.keys(a[b].kd).length&&(e[b].Ua=a[b].Ua,d.set("display"))})}(): this.iC[f]&&this.iC[f].url===a[f].Ua&&this.iC[f].Ua||(c=!0,e[f]={url:a[f].Ua},this.aS(f,a[f].Ua,function(a,b,c,f,n){e[a].Ua=b;e[a].width=c;e[a].height=f;e[a].url=n;d.set("display")},function(a){delete e[a]})));c||this.set("display")},QI:function(a){for(var b=2;b!==a&&b<a;)b*=2;return b==a?!0:!1},aS:function(a,b,c,d,e){var f=document.createElement("img");f.crossOrigin="anonymous";f.src=b;var h=this;f.onload=function(){if(16>f.width||16>f.height||!h.QI(f.width)||!h.QI(f.height))d(a);else{var k=h.createTexture(f, e);c(a,k,f.width,f.height,b)}};f.onerror=f.onabort=function(){d(a)}},createTexture:function(a,b){var c=this.ga,d=c.createTexture();c.bindTexture(c.TEXTURE_2D,d);c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,a);c.generateMipmap(c.TEXTURE_2D);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,b?c.MIRRORED_REPEAT:c.REPEAT);c.texParameteri(c.TEXTURE_2D, c.TEXTURE_WRAP_T,b?c.MIRRORED_REPEAT:c.REPEAT);return d},zoomChanged:function(){this.fk=g.a.nc(this.e.get("zoom"),1);this.ii&&this.CU(this.fk)}});g.Ba.RE.zb(g.S1);g.Ba.Tb=g.aa.extend({ja:[g.sa,g.Pe],o4:!0,r:function(a,b){this.h=a;this.J=b;this.e=b.e;this.kj=a.U.kj;this.W("display",a);this.ara||this.createProgram()},Lj:function(){this.hv&&this.hv();this.xm&&(this.J.ga.deleteBuffer(this.xm),this.xm=null);this.il();this.Dc&&this.Exa();this.pa=this.e=this.J=this.h=null},roa:"varying highp float w;",soa:"w = gl_Position.w;",poa:"varying highp float w;uniform vec2 fog;uniform vec4 fogColor;uniform float _opacity;",qoa:"float depth = gl_FragCoord.z * w;highp float fogFactor = smoothstep( fog.x, fog.y, depth );gl_FragColor.w*=(1.0-fogFactor)*_opacity;", ata:"uniform float _opacity;",bta:"gl_FragColor=vec4(gl_FragColor.rgb,gl_FragColor.a*_opacity);",G0:function(a,b,c,d){var e="",f="",h=this.ata,k=this.bta;d&&(k=h="");(c||this).bh&&(e=this.roa,f=this.soa,h=this.poa,k=this.qoa,a=a.replace("void main",e+"void main"),a=a.substr(0,a.lastIndexOf("}"))+f+"}");b=b.replace("void main",h+"void main");b=b.substr(0,b.lastIndexOf("}"))+k+"}";return[a,b]},createProgram:function(){var a;a="custom"===this.type?this.h.U.get("type"):this.type;if(!this.J.Ko[a]){var b= this.J.ga,c=this.Nh||this.h.U.get("vertexShader"),d=this.Wd||this.h.U.get("fragmentShader");if(c&&d&&(c=this.G0(c,d),c=g.om.createProgram(b,c[0],c[1]))){this.J.Ko[a]=c;c.qE=b.getUniformLocation(c,"u_projectionMatrix");c.N8=b.getUniformLocation(c,"u_mvpMatrix");c.pE=b.getUniformLocation(c,"u_modelViewMatrix");var e,f;this.h&&this.h.U.getWebGLVariableLoaction?(f=this.h.U,e=f.getWebGLVariableLoaction):this.Ch&&(f=this,e=this.Ch);this.bh&&(c.qU=b.getUniformLocation(c,"fog"),c.xK=b.getUniformLocation(c, "fogColor"));c.oE=b.getUniformLocation(c,"_opacity");e&&(b=this.J.ga,e.call(f,b,c))}}this.pa=this.J.Ko[a]},kc:function(a,b,c){var d=this.pa;if(!d)return!1;a.useProgram(d);b=b.R;this.Ga=b.Ga;d.qE&&a.uniformMatrix4fv(d.qE,!1,b.Xf.elements);d.pE&&a.uniformMatrix4fv(d.pE,!1,b.Zc.elements);d.N8&&a.uniformMatrix4fv(d.N8,!1,g.Ec.multiply(b.Xf,b.Zc).elements);c=parseFloat((c||{}).opacity);isNaN(c)&&(c=1);a.uniform1f(d.oE,c);if(0>=c)return!1;a.bindTexture(a.TEXTURE_2D,this.J.Kl[0]);1>c&&(a.enable(a.BLEND), a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA));this.bh&&(c=this.e.D.view.Rm*(1+1.1*Math.cos(b.pitch*Math.PI/180)),a.uniform2f(d.qU,0.9*c,1.5*c),d.xK&&(c=this.J.nq.UD,a.uniform4f(d.xK,c[0],c[1],c[2],1)));return!0},ppa:function(a){var b=-Infinity,c=Infinity,d=-Infinity,e=Infinity;a.forEach(function(a){a[0]>b&&(b=a[0]);a[1]>d&&(d=a[1]);a[0]<c&&(c=a[0]);a[1]<e&&(e=a[1])});return[c,e,b,d]},Bu:function(a,b){var c=[],d=this.h;if(this.Ga&&a){var e=[a.x,a.y],f=this.h.e.D.view.Ae(a); if(d.Tl){for(var h=d.Ng,k=!0,l=[],m=0;m<h.length;m+=1){var n=h[m].Cg;if(n)if(n.parentNode&&n.parentNode.parentNode&&this.J&&n.parentNode.parentNode!==this.J.ul&&"none"!==n.parentNode.style.display){var p=g.j.jo(n),n=p[0],p=p[1];n&&p?(Math.max(Math.abs(h[m].get("offset").x),Math.abs(h[m].get("offset").y)),Math.max(n,p),d.mf=Math.max(d.mf,n),d.Yf=Math.max(d.Yf,p),h[m].width=n,h[m].height=p):(k=!1,l.push(h[m]))}else k=!1,l.push(h[m])}k?(d.Tl=!1,d.Ng=[]):d.Ng=l}h=this.ppa(this.Ga.path);if(h=d.$m(h)){for(var q in h)if(h.hasOwnProperty(q)&& (k=h[q],k.get("visible")&&!k.get("noSelect")))if(l=k.cc(),l instanceof g.Aa.vg)if(this.kj){m=this.h.hm;m instanceof Array&&(m="number"===typeof k.eb.style&&m[k.eb.style]?m[k.eb.style]:m[0]);var r=m.size.width*this.S,s=m.size.height*this.S,u=m.anchor.x*this.S,v=m.anchor.y*this.S,m=g.I.VO([[e[0]-r+u,e[1]-s+v],[e[0]+u,e[1]+v]]);g.I.Nd(m,l.wa)&&c.push(k)}else"undefined"!==typeof l.get("radius")?(m=l.wa,n=k.get("deltaPos")||[0,0],p={x:m[0],y:m[1]},k.Ru?(p.x+=n[0],p.y+=n[1],this.e.D.Ae(p).re(f)<l.get("radius")+ l.get("strokeWeight")&&c.push(k)):(p=this.e.D.Qd(p),l=l.get("radius")/this.e.D.getResolution(p,20),Math.sqrt(Math.pow(m[0]-a.x+n[0],2)+Math.pow(m[1]-a.y+n[1],2))<=l&&c.push(k))):(m=k.get("params"),m.visible&&(l=l.wa,n=new g.H(l[0],l[1]),n=this.h.e.D.view.Ae(n),r=k.width,s=k.height,u=m.offset.x,v=m.offset.y,p=null,p=function(a,b){var c=Math.round(a.x+u),d=Math.round(a.x+u+r),e=Math.round(a.y+v+s),f=Math.round(a.y+v),h=Math.round(b.x),k=Math.round(b.y);return h<=d&&h>=c&&k<=e&&k>=f?!0:!1},p=m.shape? this.UC(k,f,n):p(n,f),l[0]instanceof Array||(l=[l]),p&&c.push(k)));else l.Nd?(n=k.get("deltaPos")||[0,0],l.Nd([a.x-n[0],a.y-n[1]])&&c.push(k)):l.Wx&&(n=k.get("deltaPos")||[0,0],1.8*l.Wx([a.x-n[0],a.y-n[1]])<=k.get("strokeWeight")*this.S&&c.push(k));this.kj?c.sort(function(a,b){return a.Ml>b.Ml?-1:1}):c.sort(function(a,b){return a.get("isTop")?-1:b.get("isTop")?1:a.get("zIndex")>b.get("zIndex")||a.get("zIndex")===b.get("zIndex")&&a.Ml>b.Ml?-1:1});b(c,d)}else b([],d)}else b(c,d)},UC:function(a,b,c){var d= a.get("params").shape,e=a.Cg.children[0].clientWidth;a=a.Cg.children[0].clientHeight;if("circle"===d.B.type){if(e=c.x-e/2+d.B.coords[0],c=c.y-a+d.B.coords[1],Math.sqrt((b.x-e)*(b.x-e)+(b.y-c)*(b.y-c))<=d.B.coords[2])return!0}else{if("poly"===d.B.type)return b=[b.x,b.y],d=d.B.coords,d=this.sH(d),g.wd.Nd(b,d);if("rect"===d.B.type){d=d.B.coords;c=d[0];e=d[1];a=d[3];var f=b.x;b=b.y;if(f<d[2]&&f>c&&b>a&&b<e)return!0}}return!1},sH:function(a){for(var b=[],c=0;c/2<a.length/2;c+=2)b.push([a[c],a[c+1]]);return b}});g.Ba.ll=g.Ba.Tb.extend({r:function(a,b){arguments.callee.ka.apply(this,arguments);a.Lb=a.get("container")},kc:function(a,b,c){if(this.h){var d=b.R.nb;if(!this.Ka||this.h.U.Yv||!this.Ka.cb(d)||this.nf!==b.R.zoom||this.Lua!==b.R.rotation||this.Kua!==b.R.pitch||this.e.Av){var e=this.h.m3();e&&e.call(this.h.U,b,a);this.h.Ja||(this.h.Ja=!0,g.a.Qc(function(){this.h&&(this.h.Dd?this.h.na("renderComplete"):(this.h.Dd=!0,this.h.na("complete")))},this));this.Ka=d;this.nf=b.R.zoom;this.Lua=b.R.rotation;this.Kua= b.R.pitch;c.K.style.zIndex=c.zIndex;c.K.style.top="";c.K.style.left="";c.K.style.height="";c.K.style.display=c.visible?"":"none";g.j.lq(c.K,c.opacity);this.e.Sa.o.appendChild(c.K)}}}});g.Ba.kw=g.Ba.Tb.extend({ja:[g.sa,g.Pe],r:function(a,b){this.type="custom";arguments.callee.ka.apply(this,arguments)},kc:function(a,b){arguments.callee.ka.apply(this,arguments);if(this.h.U.onRender)this.h.U.onRender(a,this.pa,b);this.h.U.renderAgain&&(this.set("display"),this.h.U.renderAgain=!1);this.h.Ja||(this.h.Ja=!0,g.a.Qc(function(){this.h&&(this.h.Dd?this.h.na("renderComplete"):(this.h.Dd=!0,this.h.na("complete")))},this))}});g.Ba.lw=g.Ba.Tb.extend({r:function(a,b){arguments.callee.ka.apply(this,arguments);this.W("reload",a,!0);var c=this.aE||g.l.size;if(this.e&&this.e.D){var d=this.e.D.get("tileCacheSize");d&&0<d&&(c=d)}this.ta=new g.dg(c);"AMap.Buildings"===a.U.CLASS_NAME&&this.W("customStyle",a.U);var e=this;this.ta.sJ.F0(function(a){e.uA(a)});this.ta.PB=function(a){return a.Sb?(a.Sb.Wi-=1,0==a.Sb.Wi&&(a.Uu=!1),delete a.Sb,!0):a.Uu?a.Wi?!1:!0:!0};this.ad=1;this.Cn=50;this.oW=!0;this.h.ta=this.ta;this.Xl=new g.LE(6, null,a.bQ);this.We=a.We;this.Ao=a.Ao;this.state={nm:"",el:{}}},hv:function(){this.ta.forEach(function(a){this.Of&&this.Of(a)},this);if(this.Bq)for(var a in this.Bq)this.Bq.hasOwnProperty(a)&&(this.J.ga.deleteTexture(this.Bq[a]),this.Bq[a]=null);this.jn=null;this.clear();this.Tg=null;this.ta.clear();this.sl=null},reloadChanged:function(){this.h&&(this.h.Ja=!1);this.ta.clear();this.reload=!0;this.set("display")},ly:function(a,b){var c=a+"";return(b?this.ta.zJ(c):this.ta.get(c))||new g.ob(a.jb())},iK:function(a, b){return this.zd*Math.pow(2,a-b)},uA:function(a){a.Zr&&this.Xl.n1(a.Zr);a.VJ=!1;a.loaded=!1;a.xa=!1;a.status=null;this.Of&&this.Of(a)},Kx:function(a,b){for(var c=this.iK(20,b),d=0,e=0,f=Infinity,h=Infinity,k=[],l=0;l<a.length;l+=1){var m=a[l],n=m[0]/c,m=m[1]/c;k.push([n,m]);d=Math.max(d,n);e=Math.max(e,m);f=Math.min(f,n);h=Math.min(h,m)}k.push(k[0]);d=Math.floor(d);e=Math.min(Math.pow(2,b)-1,Math.floor(e));f=Math.floor(f);h=Math.max(0,Math.floor(h));c=[];for(l=f;l<=d;l+=1)for(n=h;n<=e;n+=1)(m=g.wd.v6(k, [[l,n],[l+1,n],[l+1,n+1],[l,n+1],[l,n]]))&&m.length&&c.push({x:l,y:n,z:b});c.z=b;c.oy=Math.ceil(d-f)/2;c.GD=d-f+1;c.HJ=e-h+1;return c},Ou:function(a,b,c){return b<a.Jc||b>a.Hc||c<a.fc||c>a.vc?!1:!0},Bv:function(a,b){if(a.length){var c=this.nb.dd(this.zd<<20-a[0].ra.z),d=Math.floor(c.x),e=Math.floor(c.y);a.sort(function(a,c){var k=a.ra,l=c.ra,m=k.x-d,k=k.y-e,n=l.x-d,l=l.y-e;return(b?-1:1)*(n*n+l*l-(m*m+k*k))})}},clear:function(){this.Xl.clear()},Lpa:function(){return this.zoom+"-"+this.zd},uma:function(){"AMap.MapBox"== this.h.U.CLASS_NAME?this.bb=Math.max(10,this.ze-1):(this.bb=!1===this.pi&&!this.h.vR&&this.h.ia?this.ze+1:this.ze,this.h.loa&&(this.bb=this.h.loa(this.bb)));this.We&&this.bb>this.We&&(this.bb=this.We);this.Ao&&this.bb<this.Ao&&(this.bb=this.Ao)},WH:function(a,b){var c=this,d=this;if(this.h.JG){var e,f,h,k,l,m,n,p,q=function(){e=0;for(f=a.length-1;0<=f;f-=1)h=a[f],e+=h.length;if(0==e)return b.call(c,a),{CK:void 0};d.iU=a;for(f=a.length-1;0<=f;f-=1)for(h=a[f],k=[],l=[],h.cT=k,h.fv=l,m=h.length-1;0<= m;m-=1)n=h[m],p=n.ra,c.h.e.th.pz(p.x,p.y,p.z,function(){var c=m;return function(f){f?k.push(h[c]):l.push(h[c]);e-=1;if(0==e){for(f=a.length-1;0<=f;f-=1){var m=a[f];a[f]=m.cT;if(m.fv)for(var n=m.fv.length-1;0<=n;n-=1){var p=m.fv[n];d.ta.set(p.key,p);p.loaded=!0;p.status="loaded";p.xa=!0}}b.call(d,a)}}}())}();if("object"===typeof q)return q.CK}else b.call(this,a)},Mv:function(a,b,c){if(a=this.ta.get(a+"/"+b+"/"+c)){if(a.Uu)return a;if(a.Sb)return a.Sb;a.Uu=!0;a.Wi=0;return a}},sI:function(a){var b= a.ra;a=b.x;var c=b.y,b=b.z,d=Math.pow(2,b),e=(a+d)%d,f=e+d,d=e-d,h=null;e!==a&&(h=this.Mv(b,e,c));h||d===a||(h=this.Mv(b,d,c));h||f===a||(h=this.Mv(b,f,c));return h},Ho:function(a,b){this.ig=!1;b.qo!==this.qo&&(this.qo=b.qo,this.ta.clear());this.clear();this.Mi=b.Mi;this.Li=b.Li;this.zd=b.zd;var c=a.R;this.yf=b.yf||a.R.yf;this.eh=c.eh;this.size=a.size;this.rotation=c.rotation;this.nb=c.nb;this.Ga=a.R.Ga;this.zoom&&(c.zoom>this.zoom?this.Ff="zoomIn":c.zoom<this.zoom?this.Ff="zoomOut":a.Ze||(this.Ff= "stable"));this.Ze=a.Ze;this.Mg=a.Mg;this.zoom=c.zoom;this.ze=this.IU?c.W5:c.ze;this.uma();this.S=c.S;this.sg=this.IU?c.kta:c.sg;var d=this.Lpa();this.state.nm===c.key&&this.state.el[d]||(this.state.el[d]=this.Kx(c.Ga.path,this.bb));var e=this.Yj=this.state.el[d],f=this.Ga.i8,d=[],h=[],k,l=[],m=[],n=[],p=new g.Gq(0,0,0),q,r=this.zoom,r=this.sl||[],s={},u={},v,x,t,w,y,E,C;this.Xd=1E6*Math.random()<<0;for(q=r.length-1;0<=q;q-=1)if(k=r[q],!(k.Ew<b.opacity))if(p.z=k.ra.z,p.x=k.ra.x,p.y=k.ra.y,p.z===this.bb)s[p+ ""]|=16;else if(p.z<this.bb){if(s[p+""]|=64,this.Mi)for(C=this.bb-p.z,v=Math.max(e.Jc,p.x<<C),x=Math.min(e.Hc,(p.x+1<<C)-1),t=Math.max(e.fc,p.y<<C),w=Math.min(e.vc,(p.y+1<<C)-1),p.z=this.bb,y=v;y<=x;y+=1)for(p.x=y,E=t;E<=w;E+=1)p.y=E,C=p+"",s[C]|=32,u[C]=u[C]?Math.max(k.ra.z,u[C]):k.ra.z}else if(this.Li)for(C=1;p.z>=this.bb;){s[p+""]|=C;v=p.x>>1;t=p.y>>1;x=v<<1;w=t<<1;C=0;for(y=2;0<y;y-=1)for(p.x=x+y,E=2;0<E;E-=1)p.y=w+E,s[p+""]&5&&(C+=1);p.z-=1;p.x=v;p.y=t;C=4===C?4:2}p.z=this.bb;q=!0;this.ta.z1(); for(r=0;r<e.length;r+=1)p.x=e[r].x,p.y=e[r].y,C=p.toString(),k=this.ly(p,!1,c.xq),this.yt(k),v=!1,k.xa?(k.Xd=this.Xd,this.Ou(e,y,E)&&(m.push(k),this.rk&&(k.ad!==this.ad||1>k.Ew)&&(v=!0))):(q=!1,this.Ou(e,y,E)&&(v=!0),k.status&&("loading"!==k.status||!k.we)||"3D"!=this.J.type&&this.ze!==f||this.aw&&!this.Ou(this.aw,y,E)||l.push(k)),v&&n.push(k);q?this.xC||(this.xC=!0,this.h.Ja||(E={key:"rb",index:1,id:this.e.D.id},this.h.Jg&&(E.key="rl"),this.h.U.ak||(g.oe.$e.end(E),g.oe.$e.push({key:"ftc",rf:m.length, id:this.e.D.id})))):this.h.Ja=!1;this.ig=q;m.length&&this.xC&&(d.push(m),m.ig=q);h.push(l);l=!1;if(n.length){if(this.Li){n=n.slice(0);x=[];for(q=n.length-1;0<=q;q-=1)k=n[q],s[k.key]&4||x.push(k);k=b.lb[1];for(r=this.bb+1;n.length&&r<=k;r+=1){m=[];f=n;n=[];p.z=r;for(q=f.length-1;0<=q;q-=1)if(E=f[q],C=s[E.key],C&7)for(v=E.ra.x<<1,t=E.ra.y<<1,y=1;0<=y;y-=1)for(p.x=v+y,E=1;0<=E;E-=1)p.y=t+E,C=p+"",w=this.ta.zJ(C),s[C]&5&&w&&w.xa?(w.$A=!0,w.Xd=this.Xd,m.push(w),this.yt(w)):n.push(new g.ob(p.jb(),"")); m.length&&(l=!0,d.push(m))}n=x}if(!l&&this.Mi)for(E=!d.length||this.mj?b.lb[0]:Math.max(b.lb[0],this.bb-2),y=Math.max(E,this.bb-this.Efa),r=this.bb-1;n.length&&r>=E;r-=1){t=r>=y;l=[];m=[];x={};f=n;n=[];for(q=f.length-1;0<=q;q-=1)C=f[q],p.z=r,p.x=C.ra.x>>1,p.y=C.ra.y>>1,k=this.ly(p,!t,c.xq),x[k.key]||(x[k.key]=1,v=!1,k.xa&&(!this.Gha||s[k.key]&64)?(p.x=Math.min(e.Hc,Math.max(e.Jc,p.x<<this.bb-r)),p.y=Math.min(e.vc,Math.max(e.fc,p.y<<this.bb-r)),p.z=this.bb,C=p+"","number"===typeof u[C]&&k.ra.z>u[C]? v=!0:k.$A=!0,k.Xd=this.Xd,m.push(k),this.yt(k)):v=!0,v&&n.push(k));m.length&&d.push(m);t&&l.length&&h.push(l)}}this.iU=h;this.$u=this.Sp=0;e=a.R.wo;(a.Ze||this.Jg&&(a.Pd||a.Mg))&&!e||1===h.length&&0===h[0].length||this.kn(h);this.SL(c,a)&&this.h&&(this.Jg||this.mj)&&this.nv(a,b);1<d.length&&d.sort(function(a,b){return a[0].ra.z>b[0].ra.z?-1:1});this.Tg=d;this.h&&this.h.set("tiles",d);this.state.nm=c.key},SQ:function(a){var b=a.Nwa,c=[];a=this.e.D.getCoordsBoundByZoomIn3D(a.k8);b=this.Kx(a.path,b); a=0;for(var d=b.length;a<d;a++){var e=b[a],f=[e.z,e.x,e.y].join("/");this.ta.Wc(f)||c.push(new g.ob(new g.Gq(e.z,e.x,e.y),!0))}return c},SL:function(a){var b=this.e.D;return!!(b.B6&&b.Ge.preloadMode&&0===a.pitch&&200<=this.ta.gp&&this.h.U.Su())&&this.gEa&&this.zoom!==this.bb&&this.ux&&this.ux()},yt:function(a){this.ta.g5(a.key)},nv:function(){var a=[],b=[],b=this.SQ({Nwa:this.bb,k8:this.bb});b.length&&a.push(b);a.length&&this.kn(a,!0)}});g.Ba.Sya=g.Ba.lw.extend({type:"GridNet",Nh:"precision highp float;attribute vec2 a_Position;uniform mat4 u_modelViewMatrix;uniform mat4 u_projectionMatrix;void main(void) {\\tvec4 pos = vec4(a_Position.x,a_Position.y, 0.0, 1.0);\\tgl_Position = u_projectionMatrix * u_modelViewMatrix * pos;}",Wd:"precision mediump float;void main(void) {\\tgl_FragColor =  vec4(0.0,0.7,1.0,1.0);}",Ch:function(a,b){b.Sd=a.getAttribLocation(b,"a_Position")},r:function(a){this.J=a;this.e=a.e;this.createProgram();a=g.l.size; if(this.e&&this.e.D){var b=this.e.D.get("tileCacheSize");b&&0<b&&(a=b)}this.ta=new g.dg(a);this.zd=256;this.h=new g.o.Tb(new z.o.Tb,this.e)},clear:function(){},CP:function(a){var b=this.J.ga,c=a.ra,d=256*Math.pow(2,20-c.z),e=c.x*d-g.a.ac.x,c=c.y*d-g.a.ac.y,d=[e,c,e+d,c,e+d,c+d,e,c+d],e=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,e);b.bufferData(b.ARRAY_BUFFER,new Float32Array(d),b.STATIC_DRAW);a.ug=e},kh:function(a){a.xa=!0;a.status="loaded";this.CP(a);a.loaded=!0;this.ta.set(a.key,a);a.xa=!0;a.Zr= null},kn:function(a){for(var b=a.length-1;0<=b;b-=1){var c=a[b];if(c.length)for(var d=c.length-1;0<=d;d-=1)this.kh(c[d])}},Md:function(){},kc:function(a,b){var c=this.pa;arguments.callee.ka.apply(this,arguments);a.enableVertexAttribArray(c.Sd);this.Zs=b.Zs;this.Mg=b.Mg;this.Ho(b,{zd:256});for(var d=this.Tg,e=d.length-1;0<=e;e-=1){var f=d[e];if(f.length)for(var h=f.length-1;0<=h;h-=1)a.bindBuffer(a.ARRAY_BUFFER,f[h].ug),a.vertexAttribPointer(c.Sd,2,a.FLOAT,!1,0,0),a.drawArrays(a.LINE_LOOP,0,4)}this.Md()}});g.Ba.Gi=g.Ba.lw.extend({type:"tile",Nh:"precision highp float;attribute vec4 a_Position;uniform mat4 u_mvpMatrix;varying vec2 vTextureCoord;void main(void) {\\tvTextureCoord = a_Position.zw;\\tvec4 pos = vec4(a_Position.x,a_Position.y, 0.0, 1.0);\\tgl_Position = u_mvpMatrix * pos;}",Wd:"precision mediump float;uniform sampler2D texture;varying vec2 vTextureCoord;void main(void) {\\tvec4 smpColor = texture2D(texture, vTextureCoord);\\tgl_FragColor =  smpColor;}",Ch:function(a,b){b.Sd=a.getAttribLocation(b, "a_Position");b.Fv=a.getUniformLocation(b,"texture")},r:function(a,b){this.bh=!0;arguments.callee.ka.apply(this,arguments);this.Cn=120;this.pi=!1;this.We=a.We},CP:function(a){var b=this.J.ga,c=a.ra,d=Math.pow(2,20-c.z)*this.zd,e=c.x*d-g.a.ac.x,c=c.y*d-g.a.ac.y,d=[e,c,0,0,e+d,c,1,0,e+d,c+d,1,1,e,c,0,0,e+d,c+d,1,1,e,c+d,0,1],e=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,e);b.bufferData(b.ARRAY_BUFFER,new Float32Array(d),b.STATIC_DRAW);a.ug=e;d=b.createTexture();b.bindTexture(b.TEXTURE_2D,d);b.texImage2D(b.TEXTURE_2D, 0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,a.Ke);b.generateMipmap(b.TEXTURE_2D);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.MIRRORED_REPEAT);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.MIRRORED_REPEAT);a.bE=d},Of:function(a){a.bE&&(this.J.ga.deleteTexture(a.bE),a.bE=null);a.ug&&(this.J.ga.deleteBuffer(a.ug),a.ug=null)},kh:function(a,b,c){function d(b){a.loaded=!0;if(e.h){a.status="loaded"; var d=a.xa=!0;"IMG"===b.tagName&&b&&0!==b.src.indexOf(window.location.origin)&&"anonymous"!==b.crossOrigin&&(console.warn&&console.warn("JSAPI warning - Image at "+b.src+\' should be load with property crossOrigin="anonymous" under viewMode 3D!\'),d=!1);d&&(a.Ke=b,e.CP(a),e.set("display",0));"function"===typeof c&&c()}}var e=this;a.status="loading";e.ta.set(a.key,a);this.h&&this.h.ao&&this.h.ao.call(this,a,d,function(){a.loaded=!0;e.h&&(a.status="loaded",a.xa=!0,e.set("display",0),"function"===typeof c&& c())})},kn:function(a){for(var b=a.length-1;0<=b;b-=1){var c=a[b];if(c.length){var d=this,e=function(){var a=c.length;return function(){if(0===--a){var b={key:"rb",index:0,id:d.J.e.D.id};d.h.U.ak||(g.oe.$e.end(b),g.oe.$e.end(g.extend(b,{index:1})))}}}();this.Bv(c);this.Sp+=c.length;for(var f=c.length-1;0<=f;f-=1)this.kh(c[f],this.Xl,e)}}},Md:function(){if(this.ig&&!this.h.Ja){var a=this.h;this.h.U.ak||g.oe.$e.end({id:this.J.e.D.id,key:"rb",index:2});a.Ja=!0;a.Dd?a.na("renderComplete"):(a.Dd=!0,a.na("complete"))}}, kc:function(a,b,c){var d=this.pa;this.zd=c.zd;arguments.callee.ka.apply(this,arguments);a.enableVertexAttribArray(d.Sd);a.activeTexture(a.TEXTURE0);this.Ho(b,c);if(this.bh||"overlayer"===this.h.get("type"))a.enable(a.BLEND),a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA);for(var e=this.Tg,f=[],h=e.length-1;0<=h;h-=1){var k=e[h];if(k.length)for(var l=k.length-1;0<=l;l-=1){var m=k[l];m.bE&&(f.push(m),a.bindTexture(a.TEXTURE_2D,m.bE),a.uniform1i(d.Fv,0),a.bindBuffer(a.ARRAY_BUFFER, m.ug),a.vertexAttribPointer(d.Sd,4,a.FLOAT,!1,0,0),a.drawArrays(a.TRIANGLES,0,6))}}a.disable(a.BLEND);a.disableVertexAttribArray(d.Sd);this.Md();this.sl=f}});g.Ba.md=g.Ba.lw.extend({ja:[g.ww],type:"wbase",Nh:"precision highp float;attribute vec4 a_Position;attribute vec2 a_uvs;varying vec2 vTextureCoord;attribute vec3 a_op,a_Next,a_Previous;uniform float u_xDelta,u_width;uniform lowp int u_type;uniform mat4 u_mvpMatrix;uniform float u_scale;uniform float u_heightPercent;varying float v_distance;varying vec4 v_color;uniform vec3 u_ambient;uniform vec3 u_light;uniform vec3 u_lightDirection;uniform mat3 u_normalMatrix;uniform vec4 u_FragColor,u_FragColor2; uniform lowp int useTexture;varying vec2 v_op;varying float v_TB;varying highp float v_cap;void main() {vec4 position=a_Position;position.x+=u_xDelta;if (u_type==0) {\\tgl_Position=u_mvpMatrix*position;\\tvTextureCoord = a_uvs;}else if(u_type>1) {\\tv_op=a_op.xy;\\tv_TB=a_op.z;\\tvec3 curPos=position.xyz;\\tv_distance=a_Next.z;\\tfloat ddis=0.0;\\tvec3 previous=vec3(a_Previous.x+u_xDelta,a_Previous.y,0);\\tvec3 next=vec3(a_Next.x+u_xDelta,a_Next.y,0);\\tvec4 up,dir;\\tv_distance *= u_scale;\\tif(previous==curPos){ \\t\\tdir= vec4(normalize(next-curPos).xy,0,0);\\t}else if(next==curPos){\\t\\tdir= -vec4(normalize(previous-curPos).xy,0,0);\\t}else {\\t\\tvec3 dir0=previous-curPos;\\t\\tvec3 dir1=next-curPos;\\t\\tvec3 dir2=normalize(dir0);\\t\\tvec3 dir3=normalize(dir1);\\t\\tfloat f0=dir0.x*dir1.y-dir1.x*dir0.y;\\t\\tdir = vec4(0); \\t\\tv_cap=1.0;\\t\\tif(f0==0.0){\\t\\t\\tup = vec4(dir3.y,-dir3.x,0,0); \\t\\t}else{\\t\\t\\tvec3 dir4=normalize(dir2+dir3);\\t\\t\\tfloat sinA=length(cross(dir4,dir2));\\t\\t\\tfloat cosA=dot(dir4,dir2);\\t\\t\\tif(sinA<0.5){\\t\\t\\t\\tsinA=0.5;\\t\\t\\t}\\t\\t\\tup= vec4(dir4,0)/sinA;\\t\\t\\tddis=abs(length(up)*cosA*u_width*0.5);\\t\\t\\tif(f0<0.0){\\t\\t\\t\\tup=-up;\\t\\t\\t\\tddis=-ddis;\\t\\t\\t}\\t\\t\\tv_distance += v_TB*a_Previous.z*ddis;\\t\\t}\\t}\\tif(previous==curPos||next==curPos){ \\t\\tup = vec4(dir.y,-dir.x,0,0); \\t\\tif(u_type==4){\\t\\t\\tv_cap=sqrt(v_TB*v_TB+a_Previous.z*a_Previous.z);\\t\\t}else if(u_type==3){\\t\\t\\tv_cap=1.0;\\t\\t}else{dir = vec4(0);}\\t}\\tposition=position+(up*v_TB-dir*a_Previous.z)*u_width*0.5/u_scale;\\tgl_Position=u_mvpMatrix*position;}else if (u_type==1) {\\tfloat xielv = position.w;\\tvec4 c;\\tvec3 n;\\tbool BLC = true;\\tif (xielv <= 0.0) { \\t\\tc = xielv == 0.0 ? u_FragColor2 : u_FragColor;\\t\\tn = vec3(0, 0, -1);\\t\\tif (position.z == 0.0) {\\t\\t\\tBLC = false;\\t\\t}\\t} else {\\t\\tc = (u_FragColor2 + (u_FragColor - u_FragColor2) * (position.z == 0.0 ? 0.9 : 0.4));\\t\\tfloat dx = 5000.0 - float(xielv);\\t\\tfloat dy = 5000.0 - fract(xielv) * 10000.0;\\t\\tn = vec3(dy, -dx, 0);\\t}\\tif (BLC) {\\t\\tvec3 normal = normalize(u_normalMatrix * n);\\t\\tfloat nDotL = dot(u_lightDirection, -normal);\\t\\tvec3 diffuse = u_light * nDotL;\\t\\tvec3 ll = (u_ambient + diffuse);\\t\\tv_color = vec4(ll * c.rgb, c.a);\\t} else v_color = c;\\tposition=vec4(position.xy,position.z*u_heightPercent,1.0);\\tgl_Position=u_mvpMatrix*position;\\tvTextureCoord = a_uvs;}}", Wd:"#define BASE 1\\nprecision highp float;uniform vec4 u_FragColor;uniform sampler2D texture;uniform vec2 textureScale;varying vec2 vTextureCoord;varying lowp float v_distance,v_TB;varying vec4 v_color;varying vec2 v_op;varying highp float v_cap;uniform lowp int u_type;uniform int u_isDash,u_onlyBorder;uniform vec4 u_dash;uniform float pitch;uniform lowp int useTexture;void main() {vec4 color;if (u_type==0) {\\tcolor = u_FragColor;\\tif (useTexture==1) {\\t\\tvec4 smpColor = texture2D(texture, vec2(vTextureCoord.x/textureScale.x,vTextureCoord.y/textureScale.y));\\t\\tcolor= vec4(smpColor.rgb*smpColor.a+color.rgb*(1.0-smpColor.a),color.a);\\t}}else if(u_type>1) {\\tif(v_op.x<-0.2||v_op.x>256.2||v_op.y<-0.2||v_op.y>256.2){discard;}\\tif(v_cap>1.0001){discard;}\\tif(u_isDash==1){\\t\\tfloat all = u_dash[0] + u_dash[1] + u_dash[2] + u_dash[3];\\t\\tfloat off = mod(v_distance*sqrt(pitch) - u_dash[0], all);\\t\\tif(off> u_dash[0]&&off<=(u_dash[0]+u_dash[1])||off>(all-u_dash[3])){discard;}}\\tif(u_onlyBorder==1&&v_TB<=0.7&&v_TB>=-0.7){discard;}\\tcolor = u_FragColor;}else if(u_type==1) {\\tcolor = v_color;\\tif(useTexture==1&&vTextureCoord.x>-0.0) {\\t\\tvec4 smpColor = texture2D(texture, vec2(vTextureCoord.x*textureScale.x,vTextureCoord.y*textureScale.y));"+ (g.l.Z?"color= vec4(smpColor.rgb,color.a);":"color= vec4(smpColor.rgb*smpColor.a+color.rgb*(1.0-smpColor.a),color.a);")+"\\t}}gl_FragColor=color;}",Ch:function(a,b){b.BU=a.getUniformLocation(b,"u_xDelta");b.O8=a.getUniformLocation(b,"u_othMatrix");b.S8=a.getUniformLocation(b,"u_zoomMatrix");b.M8=a.getUniformLocation(b,"u_modelMatrix");b.Ld=a.getAttribLocation(b,"a_Position");b.bi=a.getAttribLocation(b,"a_uvs");b.Ui=a.getAttribLocation(b,"a_op");b.Ti=a.getAttribLocation(b,"a_Previous");b.Ag=a.getAttribLocation(b, "a_Next");b.txa=a.getUniformLocation(b,"u_normalMatrix");b.sxa=a.getUniformLocation(b,"u_lightDirection");b.rxa=a.getUniformLocation(b,"u_light");b.exa=a.getUniformLocation(b,"u_ambient");b.tj=a.getUniformLocation(b,"u_FragColor");b.tz=a.getUniformLocation(b,"u_FragColor2");b.uz=a.getUniformLocation(b,"texture");b.vz=a.getUniformLocation(b,"textureScale");b.hk=a.getUniformLocation(b,"u_type");b.Pv=a.getUniformLocation(b,"u_width");b.rU=a.getUniformLocation(b,"u_isDash");b.tU=a.getUniformLocation(b, "u_onlyBorder");b.oU=a.getUniformLocation(b,"u_dash");b.yU=a.getUniformLocation(b,"u_scale");b.Ov=a.getUniformLocation(b,"useTexture");b.xU=a.getUniformLocation(b,"pitch");b.L8=a.getUniformLocation(b,"u_heightPercent")},r:function(a,b){this.aE=this.aE||500;this.bh=!0;this.Pm=[];arguments.callee.ka.apply(this,arguments);this.pa.XM=void 0;this.pa.lM=[];this.pa.MN=void 0;this.pa.lka=0;this.Vi=20;this.Za=Math.min(2,window.devicePixelRatio||1);this.Yp=1;this.W("mapStyle",a.e);this.W("style",a.e);this.mj= this.pi=!0;a.e.D.Qp&&this.RB(a,b);this.Cn=0;this.Bk={};this.uE=!1;this.nm="";this.zG=null;"building"===a.ha[0]&&(this.bJ=this.TC=!0)},kn:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:!1;if(!this.J.e.wz&&a.length)if(this.QJ)this.jJ=!0;else{for(var c=a.length-1;0<=c;c-=1){var d=a[c];if(d.length)for(var e=Math.pow(2,20-d[0].ra.z),c=d.length-1;0<=c;c--){var f=d[c],h=f.ra;h.S=e;f.qa={};f.Vm=0;if(10>h.z){var k=this.sI(f);k&&(f.Sb=k,f.status="loaded",f.xa=!0,k.Wi+=1,f.Vm=(h.x- k.ra.x)/Math.pow(2,h.z),d.splice(c,1),this.set("display",0))}this.ta.set(f.key,f);!b&&f.we?f.we=!1:f.status="loading"}}this.WH(a,function(a){for(var c=a.length-1;0<=c;c-=1){var d=a[c];if(d.length){var e=d[0].ra.z;this.Bv(d,1);for(var f=0,h=0;f<d.length;)this.bS(d.slice(200*h,200*h+200),e,b),f+=200,h+=1}}})}},customStyleChanged:function(){this.Zla();var a=this.get("customStyle");!a||a instanceof Array||(a.areas.cqa=a.hideWithoutStyle,a=a.areas);if(!a||!a.length&&this.Pm.length)this.Pm=[],this.e.set("display"); else{for(var b=0;b<a.length;b+=1){var c=a[b];c.Eb=[];c.visible=void 0==c.visible?!0:c.visible;c.NJ=c.rejectTexture||!1;c.G1=g.a.Ek(c.color1);c.color2&&(c.nma=g.a.Ek(c.color2));if(c.path){c.IS=[];for(var d=[],e=[],f=0;f<c.path.length;f+=1){var h=this.e.Ab(c.path[f]),k=h.$a(g.a.ac);d.push(Math.floor(h.x/2048));e.push(Math.floor(h.y/2048));c.IS[f]=[k.x,k.y]}k=Math.max.apply(d,d);h=Math.min.apply(d,d);d=Math.max.apply(e,e);for(e=Math.min.apply(e,e);h<=k;h+=1)for(f=e;f<=d;f+=1){var l=2048*h-g.a.ac.x,m= 2048*f-g.a.ac.y;g.zj.doesPolygonPolygonIntersect(c.IS,[[l,m],[l,m+2048],[l+2048,m+2048],[l+2048,m]])&&c.Eb.push("17/"+h+"/"+f)}}else h=this.e.Ab(c.position),k=h.$a(g.a.ac),f=h.x/2048,h=h.y/2048,d=Math.floor(f),e=Math.floor(h),c.uua=c.radius/this.e.D.getResolution(c.position,20),f%=1,h%=1,c.Eb.push("17/"+d+"/"+e),0.5<f?(c.Eb.push("17/"+(d+1)+"/"+e),0.5<h?(c.Eb.push("17/"+(d+1)+"/"+(e+1)),c.Eb.push("17/"+d+"/"+(e+1))):(c.Eb.push("17/"+(d+1)+"/"+(e-1)),c.Eb.push("17/"+d+"/"+(e-1)))):(c.Eb.push("17/"+ (d-1)+"/"+e),0.5<h?(c.Eb.push("17/"+(d-1)+"/"+(e+1)),c.Eb.push("17/"+d+"/"+(e+1))):(c.Eb.push("17/"+(d-1)+"/"+(e-1)),c.Eb.push("17/"+d+"/"+(e-1)))),c.eua=[k.x,k.y]}this.Pm=a;this.V8()}},Zla:function(){if(this.Pm)for(var a=0;a<this.Pm.length;a+=1)for(var b=this.Pm[a].Eb,c=0;c<b.length;c+=1){var d=this.ta.get(b[c]);if(d&&d.qa)for(var d=d.qa.building,e=0,f=d.length;e<f;e+=1){var h=d[e];h[3][3]=null;h[3][4]=null;h.visible=void 0;h.NJ=void 0}}},V8:function(a){if(this.Pm){for(var b=0;b<this.Pm.length;b+= 1)for(var c=this.Pm[b],d=c.Eb,e=0;e<d.length;e+=1){var f;if(a){if(d[e]!==a.key)continue;f=a}else f=this.ta.get(d[e]);if(f&&f.qa){f=f.qa.building;for(var h=0,k=f.length;h<k;h+=1){var l=f[h],m=c.IS;if(l[7]){var n=!1;m?g.zj.isRingInRing(l[7],m)&&(n=!0):g.zj.distanceToPolygon(c.eua,l[7])<c.uua&&(n=!0);n&&(l.visible=c.visible,l.NJ=c.NJ,l[3][3]=c.G1,l[3][4]=c.nma||c.G1)}}}}this.e.set("display")}},reloadChanged:function(){this.h&&(this.h.Ja=!1);this.ta.clear();this.Qa&&this.Qa.parentNode&&this.Qa.parentNode.removeChild(this.Qa); this.nm="";this.uE=!1;this.zG=null;this.set("display")},fT:function(a,b){for(var c=this.J.ga,d=a.buffer,e=0,f=a.length;e<f;e+=1){var h=a[e];this.e.gm&&h[3]&&!this.e.od&&(h[2]=this.J.Or(h[2],h[3],!1,b),d.le[e][0]=h[2])}d.kk=this.Hd(c.ARRAY_BUFFER,d.kk);c.ji?(e=this.pa,f=c.ji,h=f.createVertexArrayOES(),f.bindVertexArrayOES(h),d.Y=this.Hd(c.ARRAY_BUFFER,d.Y),d.Vb=this.Hd(c.ELEMENT_ARRAY_BUFFER,d.Vb),c.vertexAttribPointer(e.Ld,2,c.FLOAT,!1,8,0),c.enableVertexAttribArray(e.Ld),d.LU=h,f.bindVertexArrayOES(null), c.disableVertexAttribArray(e.Ld)):(d.Y=this.Hd(c.ARRAY_BUFFER,d.Y),d.Vb=this.Hd(c.ELEMENT_ARRAY_BUFFER,d.Vb))},AT:function(a,b){var c=this.J.ga,d=a.buffer;if(c.ji){var e=this.pa,f=c.ji,h=null;d.Az=[];for(var k=0,l=a.buffer.Y.length;k<l;k++)h=f.createVertexArrayOES(),f.bindVertexArrayOES(h),d.Y[k]=this.Hd(c.ARRAY_BUFFER,d.Y[k]),d.Vb[k]=this.Hd(c.ELEMENT_ARRAY_BUFFER,d.Vb[k]),c.vertexAttribPointer(e.Ld,2,c.FLOAT,!1,44,0),c.vertexAttribPointer(e.Ui,3,c.FLOAT,!1,44,8),c.vertexAttribPointer(e.Ti,3,c.FLOAT, !1,44,20),c.vertexAttribPointer(e.Ag,3,c.FLOAT,!1,44,32),c.enableVertexAttribArray(e.Ld),c.enableVertexAttribArray(e.Ui),c.enableVertexAttribArray(e.Ti),c.enableVertexAttribArray(e.Ag),d.Az[k]=h;f.bindVertexArrayOES(null);c.disableVertexAttribArray(e.Ld);c.disableVertexAttribArray(e.Ui);c.disableVertexAttribArray(e.Ti);c.disableVertexAttribArray(e.Ag)}else for(e=0,f=a.buffer.Y.length;e<f;e++)d.Y[e]=this.Hd(c.ARRAY_BUFFER,d.Y[e]),d.Vb[e]=this.Hd(c.ELEMENT_ARRAY_BUFFER,d.Vb[e]);if(this.e.gm&&!this.e.od){var c= d.hash,d=null,m;for(m in c)if(c.hasOwnProperty(m))for(e=0,f=a[m].length;e<f;e++)d=a[m][e],d[10]&&(d[1]=this.J.Pl(d[1],d[10],1,!1,b),d[4]=this.J.Pl(d[4],d[10],0,!1,b))}},Of:function(a){if(a.qa){if(a.qa.region&&a.qa.region.length){for(var b=a.qa.region.buffer,c=0,d=a.qa.region.length;c<d;c+=1){var e=a.qa.region[c];e[2]=null;e[4]=null}if(b){this.J.ga.deleteBuffer(b.kk);this.J.ga.deleteBuffer(b.Y);this.J.ga.deleteBuffer(b.Vb);b.LU&&this.J.ga.ji.deleteVertexArrayOES(b.LU);for(var f in b)b.hasOwnProperty(f)&& (b[f]=null);a.qa.region.buffer=null}delete a.qa.region}if(a.qa.road){for(c in a.qa.road)if(a.qa.road.hasOwnProperty(c))if("buffer"!==c)delete a.qa.road[c];else if(b=a.qa.road.buffer){if(b.Y&&b.Y.length)for(d=0,e=b.Y.length;d<e;d++)this.J.ga.deleteBuffer(b.Y[d]),this.J.ga.deleteBuffer(b.Vb[d]),b.Az&&b.Az[d]&&this.J.ga.ji.deleteVertexArrayOES(b.Az[d]);for(f in b)b.hasOwnProperty(f)&&(b[f]=null);a.qa.road.buffer=null}delete a.qa.road}if(a.qa.building){c=0;for(d=a.qa.building.length;c<d;c+=1)e=a.qa.building[c], this.J.ga.deleteBuffer(e[0]),e[0]=null,e[1]&&this.J.ga.deleteBuffer(e[1]),e[1]=null,this.J.ga.deleteBuffer(e[2]),e[2]=null,e[3]=null,e[4]=null,e[5]=null;delete a.qa.building}delete a.qa}},cP:function(a,b){for(var c=this.J.ga,d=0,e=a.length;d<e;d+=1){var f=a[d];f[4]&&(f[7]=f[4]);this.e.od&&(f[4]=f[0],f[6]=new g.Mz,pd(f[6],f[0],4));f.gD=f[0].length/4;f[0]=this.Hd(c.ARRAY_BUFFER,f[0]);f[1].length?(f.fJ=f[1].length/2,f[1]=this.Hd(c.ARRAY_BUFFER,f[1])):f[1]=null;f.hD=f[2].length/4;f[2]=this.Hd(c.ARRAY_BUFFER, f[2]);if(this.e.gm&&f[3][2]&&!this.e.od){var h=this.J.gy(f[3][0],f[3][1],f[3][2],!1,b);f[3][0]=h[0];f[3][1]=h[1]}f.Rj=0}},Hd:function(a,b){if(b.length){var c=this.J.ga,d=c.createBuffer();c.bindBuffer(a,d);c.bufferData(a,b,c.STATIC_DRAW);return d}},Ry:function(a){if(this.h&&a.VR===this.h.dc)for(var b=0,c=a.Ic.length;b<c;b+=1)this.sD(a.Ic[b],a.Ey,a.gq,a.Z)},sD:function(a){var b=a.vd,c=this.ta.get(a.Ai);if(c){var d=a.tg.z;c.qa[b]=a.Ma;switch(b){case "region":this.fT(a.Ma,d);break;case "road":this.AT(a.Ma, d);break;case "building":this.cP(a.Ma,d),a.dn&&a.dn.length&&!c.ae&&(c.ae={},c.ae.ff=a.dn,g.wj&&g.wj.q("vecTileParsed.buildings",{Qo:c})),this.V8(c)}b===this.h.ha[this.h.ha.length-1]&&(c.xa=!0,this.set("display"))}},Md:function(){if(this.ig&&!this.h.Ja){var a=this.h;g.oe.$e.end({key:"rb",index:2,id:this.e.D.id});a.Ja=!0;a.Dd?a.na("renderComplete"):(a.Dd=!0,a.U.get("innerLayer")&&a.e?a.e.Uq():a.na("complete"))}},kc:function(a,b,c){var d=b.R;this.he=!1;arguments.callee.ka.apply(this,arguments);if(this.zoom&& this.jn&&this.jn.length&&0.49<Math.abs(this.zoom-d.zoom)){for(var e=0,f=this.jn.length;e<f;e+=1)this.jn[e].Rj=0;this.jn=null}(this.uE=this.nm===d.key&&this.ig)||this.Ho(b,c);this.Md();b.AI||(b.Tka=this.ig,this.ysa=c.hd&&this.bJ,this.Kk=b,this.zs(a,this.Tg,b),this.Zc=d.Zc,a.disableVertexAttribArray(this.pa.Ld),a.disableVertexAttribArray(this.pa.bi),a.disableVertexAttribArray(this.pa.Ui),a.disableVertexAttribArray(this.pa.Ti),a.disableVertexAttribArray(this.pa.Ag),this.he&&this.set("display"),this.nm= d.key)},zs:function(a,b,c){if(b.length){var d=this.pa,e=g.om,f=c.R;this.ad+=1;if(this.X8)for(var h=b.length-1;0<=h;h--){c=b[h];for(var k=0,l=c.length;k<l;k++){var m=c[k];this.X8(m)}}a.uniform1f(d.yU,Math.pow(2,this.zoom-this.Vi)*(this.h.ia?this.Za:1));a.enableVertexAttribArray(d.Ld);d.wK&&a.uniform1f(d.wK,this.e.D.view.Rm);a.uniform1f(d.xU,Math.cos(f.pitch*Math.PI/180));this.sl=[];a.disable(a.DEPTH_TEST);a.enable(a.BLEND);a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA); var n,p;if("building"!==this.h.ha[0]){this.up(0,void 0,void 0);a.uniform1i(d.hk,0);for(e=b.length-1;0<=e;e--){c=b[e];f=!1;this.en&&c.ig&&c[0].ra.z==this.bb&&(n=[],p=[],f=!0);k=0;for(l=c.length;k<l;k++)if(m=c[k],f&&m.ha&&(!m.ha.length||m.ha.Jwa)&&(n.push.apply(n,m.ha),p.push(m.ra+"")),m.Sb?m.Sb.qa:m.qa)m.ad=this.ad,this.sl.push(m);this.SP(a,c);a.enableVertexAttribArray(d.Ui);a.enableVertexAttribArray(d.Ag);a.enableVertexAttribArray(d.Ti);this.TP(a,c);a.disableVertexAttribArray(d.Ui);a.disableVertexAttribArray(d.Ag); a.disableVertexAttribArray(d.Ti)}this.en&&n&&(a=p.sort().join(";"),n.QR=a,a!==this.Qf.QR&&(this.Qf=n))}else{a.disableVertexAttribArray(this.pa.Ui);a.disableVertexAttribArray(this.pa.Ti);a.disableVertexAttribArray(this.pa.Ag);for(n=b.length-1;0<=n;n--)for(c=b[n],k=0,l=c.length;k<l;k++)if(m=c[k],m.Sb?m.Sb.qa:m.qa)m.ad=this.ad,this.sl.push(m);if(this.Ga.eP){k=g.a.find(this.e.get("layers"),function(a){if(a instanceof z.o.dt&&a.get("visible"))return!0});a.clear(a.DEPTH_BUFFER_BIT);a.enable(a.DEPTH_TEST); this.up(0,void 0,void 0);a.uniform1i(d.hk,1);var q=this.Ga.eP.x,r=this.Ga.eP.y,l=this.h.get("sort");e.aC([d.tj,d.tz,d.Ov]);for(n=b.length-1;0<=n;n-=1){c=b[n];d=c[0].Ed;e=[];p=0;for(f=c.length;p<f;p+=1)m=c[p],e.push.apply(e,m.qa.building);l&&e.sort(function(a,b){return Math.abs(a[5][0]-q)+Math.abs(a[5][1]-r)>Math.abs(b[5][0]-q)+Math.abs(b[5][1]-r)?1:-1});e.Ed=d;this.MH(a,e,k)}17>this.bb&&this.jn&&(this.MH(a,this.jn,k),this.he||(this.jn=null));a.disable(a.BLEND);a.disable(a.DEPTH_TEST)}}}},oq:256*Math.pow(2, 20),SP:function(a,b){var c=g.om,d=this.pa;c.aC([d.Ov,d.uz,d.vz]);for(var e=this.J.ii,f=0,h=b.length;f<h;f++){var k=b[f],l=(k.Sb?k.Sb.qa:k.qa).region;if(l&&l.length){this.rr(k.Vm*this.oq);var k=l.buffer,m=a.ji;m?m.bindVertexArrayOES(k.LU):(a.bindBuffer(a.ARRAY_BUFFER,k.Y),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,k.Vb));for(var n=0,p=k.To.length;n<p;n++){var q=k.le[n],r=q[0],s=q[1],q=!1;s&&e&&(r=this.J.Or(r,s),l[n].yd=r);r&&(s&&e?(s=this.J.DC(s))?(a.activeTexture(a.TEXTURE0),c.qf(a,"1i",d.Ov,1),c.qf(a,"1i", d.uz,0),l[n].Ua={url:s.url,width:s.width,height:s.height},c.qf(a,"2f",d.vz,[s.width/512,s.height/512]),a.bindTexture(a.TEXTURE_2D,s.Ua),a.enableVertexAttribArray(d.bi),a.bindBuffer(a.ARRAY_BUFFER,k.kk),a.vertexAttribPointer(d.bi,2,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,k.Y),a.vertexAttribPointer(d.Ld,2,a.FLOAT,!1,8,0),q=!0):(c.qf(a,"1i",d.Ov,0),a.bindTexture(a.TEXTURE_2D,this.J.Kl[0]),l[n].Ua=null):(c.qf(a,"1i",d.Ov,0),a.bindTexture(a.TEXTURE_2D,this.J.Kl[0]),l[n].Ua=null),a.uniform4f(d.tj,r[0], r[1],r[2],r[3]),a.ji||a.vertexAttribPointer(d.Ld,2,a.FLOAT,!1,8,0),a.drawElements(a.TRIANGLES,k.To[n][0],a.UNSIGNED_SHORT,k.To[n][1]),q&&a.disableVertexAttribArray(this.pa.bi))}m&&m.bindVertexArrayOES(null)}}},TP:function(a,b){var c=g.om,d=this.pa,e=this.J.ia?this.Za:this.Yp;c.aC([d.tj,d.hk,d.Pv]);var f=null;if(this.uE)f=this.zG;else for(var f=this.zG={},h=0,k=b.length;h<k;h++){var l=b[h];if(l=(l.Sb?l.Sb.qa:l.qa).road)for(var l=g.a.keys(l.buffer.hash),m=null,n=0,p=l.length;n<p;n++)m=l[n],f[m]?f[m].push(h): f[m]=[h]}h=g.a.keys(f);k="";l=this.J.ii;m=0;for(n=h.length;m<n;m++)for(var k=h[m],p=f[k],q=0,r=p.length;q<r;q++){for(var s=b[p[q]],u=(s.Sb?s.Sb.qa:s.qa).road,v=u.buffer,x=v.hash[k],u=u[k],t=null,w=0,y=u.length;w<y;w++){var E=u[w],C=E,F=x[w],A=C[4],B=C[10];B&&l&&(A=this.J.Pl(A,B,0),E.yd=A);E=this.NM(C,e)[1];A&&E&&(c.qf(a,"1i",d.hk,"square"===C[9]?3:"round"===C[9]?4:2),this.rr(s.Vm*this.oq),t!==F[0]&&(a.ji?a.ji.bindVertexArrayOES(v.Az[F[0]]):(a.bindBuffer(a.ARRAY_BUFFER,v.Y[F[0]]),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER, v.Vb[F[0]])),t=F[0]),a.ji||(a.vertexAttribPointer(d.Ld,2,a.FLOAT,!1,44,0),a.vertexAttribPointer(d.Ui,3,a.FLOAT,!1,44,8),a.vertexAttribPointer(d.Ti,3,a.FLOAT,!1,44,20),a.vertexAttribPointer(d.Ag,3,a.FLOAT,!1,44,32)),c.qf(a,"1f",d.Pv,E),c.qf(a,"4f",d.tj,A),this.up(C[5]?1:0,C[5],0),a.drawElements(a.TRIANGLES,F[1],a.UNSIGNED_SHORT,F[2]))}t=null;w=0;for(y=u.length;w<y;w++){var F=C=u[w],A=x[w],E=F[1],B=F[10],G=void 0,G=F.rh?F.rh.rf[0]:F[0];B&&l&&(E=this.J.Pl(E,B,1),C.yd=E);G&&E&&(c.qf(a,"1i",d.hk,"square"=== F[8]?3:"round"===F[8]?4:2),this.rr(s.Vm*this.oq),t!==A[0]&&(a.ji?a.ji.bindVertexArrayOES(v.Az[A[0]]):(a.bindBuffer(a.ARRAY_BUFFER,v.Y[A[0]]),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,v.Vb[A[0]])),t=A[0]),a.ji||(a.vertexAttribPointer(d.Ld,2,a.FLOAT,!1,44,0),a.vertexAttribPointer(d.Ui,3,a.FLOAT,!1,44,8),a.vertexAttribPointer(d.Ti,3,a.FLOAT,!1,44,20),a.vertexAttribPointer(d.Ag,3,a.FLOAT,!1,44,32)),c.qf(a,"1f",d.Pv,G),c.qf(a,"4f",d.tj,E),this.up(F[2]?1:0,F[2],F[6]?1:0),a.drawElements(a.TRIANGLES,A[1],a.UNSIGNED_SHORT, A[2]))}}a.ji&&a.ji.bindVertexArrayOES(null)},MH:function(a,b,c){function d(b){b?n||(a.enableVertexAttribArray(e.bi),f.qf(a,"1i",e.Ov,1),n=!0):n&&(a.disableVertexAttribArray(e.bi),f.qf(a,"1i",e.Ov,0),n=!1)}var e=this.pa,f=g.om;if(b.length&&this.Zc){this.e.D.AmbientLight&&a.uniform3fv(e.exa,this.e.D.AmbientLight.color);this.e.D.DirectionLight&&(a.uniform3fv(e.rxa,this.e.D.DirectionLight.color),a.uniform3fv(e.sxa,this.J.X4.elements));var h=new g.xV(this.Zc.Ig().iE());a.uniformMatrix3fv(e.txa,!1,h.elements); h=!0;17>this.bb?h=!1:this.jn=b;var k=this.h.Qu?!1:this.h.e.D.get("buildingAnimation");17>b.Ed&&(k=!1);var l=this.J.DC("buildings");a.uniform1f(e.L8,1);var m=100;a.activeTexture(a.TEXTURE0);var n=!1,p=!(!l||!l.Ua);if(p){var q=Math.max(l.width,l.height),q=128/q;a.bindTexture(a.TEXTURE_2D,l.Ua);a.uniform2f(e.vz,e.vz,128/l.width/q,128/l.height/q)}else a.bindTexture(a.TEXTURE_2D,this.J.Kl[0]);d(p);var q=this.J.Ol(this.J.yja),r=this.J.Ol(this.J.fka);a.uniform4f(e.tz,q[0],q[1],q[2],q[3]);a.uniform4f(e.tj, r[0],r[1],r[2],r[3]);for(var s=!1,u=this.Pm.cqa,v=0,x=b.length;v<x;v+=1){var t=b[v];t.Ua=null;if(!(t.$pa&&17<=this.zoom&&c||!t||!1===t.visible||void 0==t.visible&&u||t[7]&&this.ysa&&!this.J.hd.wla(t[7],this.Kk))){t.NJ?d(!1):(d(p),p&&(t.Ua={url:l.url,width:l.width,height:l.height}));t.yd=q;t[3][3]&&t[3][4]?(s=t[3][4],f.qf(a,"4f",e.tz,t[3][3]),f.qf(a,"4f",e.tj,s),s=!0):s&&(s=!1,f.qf(a,"4f",e.tz,q),f.qf(a,"4f",e.tj,r));if(k){if(h?100>t.Rj&&(t.Rj+=20):0<t.Rj&&(t.Rj-=20),100>t.Rj&&h?this.he=1:0<t.Rj&& !h&&(this.he=1),!t.Rj)continue}else t.Rj=100;m!==t.Rj&&(a.uniform1f(e.L8,t.Rj/100),m=t.Rj);t.gD&&(t.fJ&&l&&l.Ua?(a.bindBuffer(a.ARRAY_BUFFER,t[1]),a.vertexAttribPointer(e.bi,2,a.FLOAT,!1,0,0)):a.disableVertexAttribArray(e.bi),a.bindBuffer(a.ARRAY_BUFFER,t[0]),a.vertexAttribPointer(e.Ld,4,a.FLOAT,!1,0,0),a.drawArrays(a.TRIANGLES,0,t.gD));t.hD&&(a.bindBuffer(a.ARRAY_BUFFER,t[2]),a.vertexAttribPointer(e.Ld,4,a.FLOAT,!1,0,0),a.drawArrays(a.LINES,0,t.hD))}}}},up:function(a,b,c){var d=this.pa,e=this.J.ga; a!==d.XM&&(e.uniform1i(d.rU,a),d.XM=a);a&&b&&b.toString()!==d.lM.toString()&&(d.lM=b,e.uniform4f(d.oU,b[0],b[1],b[2]||0,b[3]||0));c!==d.MN&&(e.uniform1i(d.tU,c),d.MN=c)},rr:function(a){if(a!==this.pa.Hz){var b=this.pa;this.J.ga.uniform1f(b.BU,a);b.Hz=a}},CO:function(a){var b=[],c=[];a&&a[0]&&(c=a[0].split("&"));(a=c[2])&&0===a.indexOf("railway")?(b[0]=1,b[3]=3):b[0]=parseInt(c[0])||0;c[3]&&c[4]&&3<c.length?(b[3]=b[0]+parseInt(c[3]),0===g.a.indexOf(c[5],"dash")&&(b[3]+=1)):b[3]=0;return b},NM:function(a, b){var c=this.zoom;if(a.rh&&a.rh.zoom===c)return a.rh.rf;if(this.h.U.le)return void 0!==a[12]&&this.h.U.le.fI[a[12]]?(a.rh={zoom:c,rf:[this.h.U.le.fI[a[12]](c-1),a[3]]},a.rh.rf):[a[0],a[3]];var d=a[11].browserStyle,e=a[11].levelStyleMapping;if(!d||!e){if(18<c){var f=Math.pow(2,c-18);return[a[0]*f*b,a[3]*f*b]}return[a[0]*b,a[3]*b]}if(18<c)d=this.vk(a,18,d,e),f=Math.pow(2,c-18),a.rh={zoom:c,rf:[d[0]*f*b,d[3]*f*b]};else if(g.a.w4(c))f=this.vk(a,c,d,e),a.rh={zoom:c,rf:[f[0]*b,f[3]*b]};else{var f=this.vk(a, Math.floor(c),d,e),e=this.vk(a,Math.ceil(c),d,e),h=function(a,b,c){var d;a&&b?d=a+c%1*(b-a):0===a&&b?d=Math.max(0,c%1-0.5)/0.5*b:0===a&&0===b?d=0:0!==a&&0===b&&(d=0);return d},d=h(f[0],e[0],c),f=h(f[3],e[3],c);a.rh={zoom:c,rf:[d*b,f*b]}}return a.rh.rf},vk:function(a,b,c,d){a=a[11].id+"-"+b;if(!this.Bk[a]){if(!d[b]){var e=g.a.keys(d);b>e[e.length-1]&&(d[b]=d[e[e.length-1]])}this.Bk[a]=this.CO(c[d[b]])}return this.Bk[a]}});g.Ba.GV=g.Ba.Tb.extend({type:"sky",Nh:"precision highp float;attribute vec3 a_Position;attribute vec2 a_uvs;uniform mat4 u_scaleMatrix;uniform mat4 u_scaleMatrix2;uniform mat4 u_panMatrix;uniform int u_fh;uniform mat4 u_modelViewMatrix;uniform mat4 u_projectionMatrix;varying vec2 v_uvs;varying float z;void main(void) {\\tv_uvs = a_uvs;\\tz = -a_Position.z/3000.0;\\tvec4 pos = u_scaleMatrix2*u_modelViewMatrix* u_panMatrix* u_scaleMatrix * vec4(a_Position,1.0);\\tgl_Position = u_projectionMatrix * pos;}", Wd:"precision mediump float;uniform vec4 color;uniform sampler2D texture;uniform int ok;uniform float opacity;varying vec2 v_uvs;varying float z;void main(void) {\\tif(ok==1){\\t\\tvec4 smpColor = texture2D(texture, v_uvs);\\t\\tgl_FragColor = vec4(smpColor.xyz,color.w*opacity*z);\\t}else{\\t\\tgl_FragColor = vec4(color.xyz,color.w*opacity*z);\\t}}",Of:function(){this.J.ga.deleteBuffer(this.ug);this.ug=null;this.J.ga.deleteBuffer(this.Ts);this.Ts=null;this.J.ga.deleteBuffer(this.kE);this.kE=null;this.J.deleteProgram(this.pa); this.pa=null},Ch:function(a,b){b.vU=a.getUniformLocation(b,"u_panMatrix");b.Sd=a.getAttribLocation(b,"a_Position");b.bi=a.getAttribLocation(b,"a_uvs");b.uz=a.getUniformLocation(b,"texture");b.P8=a.getUniformLocation(b,"ok");b.uU=a.getUniformLocation(b,"opacity");b.Nv=a.getUniformLocation(b,"color");b.K8=a.getUniformLocation(b,"aspect");b.wK=a.getUniformLocation(b,"u_cameraheight");b.mxa=a.getUniformLocation(b,"u_fh");b.wxa=a.getUniformLocation(b,"u_scaleMatrix");b.xxa=a.getUniformLocation(b,"u_scaleMatrix2")}, r:function(a){this.cE="sky";this.lb=[11,20];this.bh=!1;this.J=a;this.e=a.e;this.W("display",this.e);this.createProgram();this.e.D.get("skyColor")?this.UD=g.a.Ek("ff"+this.e.D.get("skyColor").substr(1)):this.UD=g.a.Ek("ffcce0ff");this.fC()},fC:function(){for(var a=void 0!==a?a:0,b=void 0!==b?b:2*Math.PI,c=void 0!==c?c:Math.PI/4,d=void 0!==d?d:Math.PI/4,e=c+d,f=new Float32Array(1887),h=new Float32Array(1258),k=0,l=[],m=0;16>=m;m++){for(var n=[],p=m/16,q=0;36>=q;q++){var r=q/36,s=-1*Math.cos(a+r*b)* Math.sin(c+p*d),u=1*Math.cos(c+p*d),v=1*Math.sin(a+r*b)*Math.sin(c+p*d);f[3*k]=1E4*s;f[3*k+1]=1E4*v;f[3*k+2]=1E4*-u;h[2*k]=r;h[2*k+1]=p;n.push(k);k++}l.push(n)}a=[];for(m=0;16>m;m++)for(q=0;36>q;q++)b=l[m][q+1],d=l[m][q],k=l[m+1][q],n=l[m+1][q+1],(0!==m||0<c)&&a.push(b,d,n),(15!==m||e<Math.PI)&&a.push(d,k,n);c=this.J.ga;e=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,e);c.bufferData(c.ARRAY_BUFFER,new Float32Array(f),c.STATIC_DRAW);this.ug=e;this.MU=a.length;e=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER, e);c.bufferData(c.ARRAY_BUFFER,new Float32Array(h),c.STATIC_DRAW);this.Ts=e;h=c.createBuffer();c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,h);c.bufferData(c.ELEMENT_ARRAY_BUFFER,new Uint16Array(a),c.STATIC_DRAW);this.kE=h;this.Y=f;this.Vb=a},Md:function(){},kc:function(a,b,c){if(this.wI(b.R.zoom)){a.disable(a.DEPTH_TEST);a.enable(a.BLEND);a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA);var d=this.pa;arguments.callee.ka.apply(this,arguments);a.enableVertexAttribArray(d.bi); a.enableVertexAttribArray(d.Sd);var e=this.J.Ol(this.J.wB);this.e.od&&(this.yd=e=this.J.Or(e,this.cE));a.uniform4f(d.Nv,e[0],e[1],e[2],e[3]);a.uniform1f(d.uU,this.d3(b.R.zoom));a.uniform1i(d.mxa,120*b.R.zoom);e=this.e.D.view.toa;a.uniformMatrix4fv(d.vU,!1,e.elements);var f=1.1*this.e.D.view.Rm/1E4,h=Math.max(1,b.R.MB),f=(new g.Ec).yv(f,f,f);a.uniformMatrix4fv(d.wxa,!1,f.elements);h=(new g.Ec).yv(h,1,1);a.uniformMatrix4fv(d.xxa,!1,h.elements);var k=this.J.DC(this.cE);k&&k.Ua?(a.activeTexture(a.TEXTURE0), a.bindTexture(a.TEXTURE_2D,k.Ua),a.uniform1i(this.pa.uz,0),a.uniform1i(this.pa.P8,1),this.Ua={url:k.url,width:k.width,height:k.height}):(this.Ua=null,a.uniform1i(this.pa.P8,0),a.bindTexture(a.TEXTURE_2D,this.J.Kl[0]));a.bindBuffer(a.ARRAY_BUFFER,this.ug);a.vertexAttribPointer(d.Sd,3,a.FLOAT,!1,0,0);a.bindBuffer(a.ARRAY_BUFFER,this.Ts);a.vertexAttribPointer(d.bi,2,a.FLOAT,!1,0,0);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.kE);a.drawElements(a.TRIANGLES,this.MU,a.UNSIGNED_SHORT,0);a.disableVertexAttribArray(d.bi); a.disableVertexAttribArray(d.Sd);a.disable(a.BLEND);this.Zc=h.multiply((new g.Ec).set(b.R.Zc).multiply((new g.Ec).set(e).multiply(f)));this.Md()}},d3:function(a){return 12<a?1:a-11},wI:function(a){return 11<a?!0:!1}});g.Ba.XE=g.Ba.GV.extend({r:function(){this.lb=[3,11];arguments.callee.ka.apply(this,arguments);this.cE="atmosphere"},d3:function(){return 1},wI:function(a){return 12>a?!0:!1}});g.Ba.Qya=g.Ba.Tb.extend({type:"fog",Nh:"precision highp float;attribute vec3 a_Position;uniform float u_cameraheight;uniform float pitch;uniform float aspect;uniform mat4 u_panMatrix;uniform mat4 u_modelViewMatrix;uniform mat4 u_projectionMatrix;varying float z;void main(void) {\\tz = a_Position.z;\\tvec3 pos_ = vec3(a_Position.xy,a_Position.z*pitch);\\tvec4 pos = u_modelViewMatrix* u_panMatrix * vec4(pos_*u_cameraheight,1.0);\\tpos.x *= aspect;\\tgl_Position = u_projectionMatrix * pos;}",Wd:"precision mediump float;uniform vec4 color;varying float z;uniform float factor;void main(void) {\\tfloat a = color.a*(1.0-pow(abs(z)/(z>0.0?(0.08-factor):(0.04+factor)),2.0));\\tgl_FragColor =  vec4(color.rgb,a);}", Ch:function(a,b){b.vU=a.getUniformLocation(b,"u_panMatrix");b.Sd=a.getAttribLocation(b,"a_Position");b.Nv=a.getUniformLocation(b,"color");b.xU=a.getUniformLocation(b,"pitch");b.K8=a.getUniformLocation(b,"aspect");b.lxa=a.getUniformLocation(b,"factor");b.wK=a.getUniformLocation(b,"u_cameraheight")},r:function(a){this.bh=!1;this.J=a;this.e=a.e;this.W("display",this.e);this.createProgram();this.e.D.get("skyColor")?this.UD=g.a.Ek("ff"+this.e.D.get("skyColor").substr(1)):this.UD=g.a.Ek("ffcce0ff");this.fC()}, fC:function(){for(var a=void 0!==a?a:0,b=void 0!==b?b:2*Math.PI,c=void 0!==c?c:30*Math.PI/100,d=void 0!==d?d:35*Math.PI/100,e=c+d,f=new Float32Array(666),h=new Float32Array(444),k=0,l=[],m=0;5>=m;m++){for(var n=[],p=m/5,q=0;36>=q;q++){var r=q/36,s=-1*Math.cos(a+r*b)*Math.sin(c+p*d),u=1*Math.cos(c+p*d),v=1*Math.sin(a+r*b)*Math.sin(c+p*d);f[3*k]=s;f[3*k+1]=v;f[3*k+2]=-u/3;h[2*k]=r;h[2*k+1]=p;n.push(k);k++}l.push(n)}a=[];for(m=0;5>m;m++)for(q=0;36>q;q++)b=l[m][q+1],d=l[m][q],k=l[m+1][q],n=l[m+1][q+1], (0!==m||0<c)&&a.push(b,d,n),(4!==m||e<Math.PI)&&a.push(d,k,n);c=this.J.ga;e=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,e);c.bufferData(c.ARRAY_BUFFER,new Float32Array(f),c.STATIC_DRAW);this.ug=e;this.MU=a.length;this.Y=f;this.Vb=a;f=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,f);c.bufferData(c.ARRAY_BUFFER,new Float32Array(h),c.STATIC_DRAW);this.Ts=f;h=c.createBuffer();c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,h);c.bufferData(c.ELEMENT_ARRAY_BUFFER,new Uint16Array(a),c.STATIC_DRAW);this.kE=h},Md:function(){}, kc:function(a,b,c){a.disable(a.DEPTH_TEST);a.enable(a.BLEND);a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA);var d=this.pa;arguments.callee.ka.apply(this,arguments);a.enableVertexAttribArray(d.Sd);var e=b.R.zoom;a.uniform1f(d.oE,1-0.015*(e-3));a.uniform1f(d.lxa,11>e?0:0.008*(e-11));a.uniform1f(d.K8,b.R.MB);a.uniform1f(d.xU,b.R.pitch/65*(1-0.5*Math.abs(e-11)/(11<e?6:9)));e=this.J.Ol(this.J.wB);this.e.od&&(e=this.J.Or(e,"sky"));a.uniform4f(d.Nv,e[0],e[1],e[2],e[3]); a.uniform1f(d.wK,this.e.D.view.Rm*(1.3+0.03*(12-Math.min(12,b.R.zoom))));a.uniformMatrix4fv(d.vU,!1,this.e.D.view.oEa.Ig().elements);a.bindBuffer(a.ARRAY_BUFFER,this.ug);a.vertexAttribPointer(d.Sd,3,a.FLOAT,!1,0,0);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.kE);a.drawElements(a.TRIANGLES,this.MU,a.UNSIGNED_SHORT,0);a.disableVertexAttribArray(d.Sd);a.disable(a.BLEND);this.Md()}});g.Ba.et=g.Ba.Tb.extend({type:"land",Nh:"precision highp float;attribute vec3 a_Position;attribute vec2 a_uvs;varying vec2 v_uvs;uniform mat4 u_modelViewMatrix;uniform mat4 u_projectionMatrix;varying  float z;void main(void) {\\tv_uvs = a_uvs;\\tvec4 pos = u_projectionMatrix*u_modelViewMatrix * vec4(a_Position.xy,0.0,1.0);\\tgl_Position = pos;\\tz = a_Position.z;}",Wd:"precision mediump float;uniform sampler2D textureL;uniform sampler2D textureW;uniform highp vec4 textureScale;varying highp vec2 v_uvs;uniform vec4 color;uniform vec4 color2;varying highp float z;void main(void) {if(z==0.0){\\tif(textureScale.z!=0.0){\\t\\tvec4 smpColor = texture2D(textureW, vec2(v_uvs.x/textureScale.z,v_uvs.y/textureScale.w));\\t\\tgl_FragColor= vec4(smpColor.rgb*smpColor.a+color2.rgb*(1.0-smpColor.a),color2.a);\\t}else{\\t\\tgl_FragColor = color2;\\t}}else{\\tif(textureScale.x!=0.0){\\t\\thighp float u  = v_uvs.x/textureScale.x;\\t\\thighp float v  = v_uvs.y/textureScale.y;\\t\\tvec4 smpColor = texture2D(textureL, vec2(u,v));\\t\\tgl_FragColor= vec4(smpColor.rgb*smpColor.a+color.rgb*(1.0-smpColor.a),color.a);\\t}else{\\t\\tgl_FragColor = color;\\t}}}", Ch:function(a,b){b.Sd=a.getAttribLocation(b,"a_Position");b.bi=a.getAttribLocation(b,"a_uvs");b.zxa=a.getUniformLocation(b,"textureL");b.Bxa=a.getUniformLocation(b,"textureW");b.Nv=a.getUniformLocation(b,"color");b.kxa=a.getUniformLocation(b,"color2");b.vz=a.getUniformLocation(b,"textureScale")},r:function(a){this.bh=!0;this.J=a;this.e=a.e;this.W("display",this.e);this.createProgram();this.fC()},Of:function(){this.J.ga.deleteBuffer(this.ug);this.ug=null;this.J.ga.deleteBuffer(this.Ts);this.Ts=null; this.J.deleteProgram(this.pa);this.pa=null},fC:function(){for(var a=this.J.ga,b=g.a.Ca,c=[-b,-b,0,2*b,-b,0,2*b,0,0,-b,-b,0,2*b,0,0,-b,0,0,-b,b,1,2*b,b,1,2*b,2*b,1,-b,b,1,2*b,2*b,1,-b,2*b,1],d=[],e=0;e<c.length;e+=3)d.push(c[e]+b,c[e+1]+b),c[e]-=g.a.ac.x,c[e+1]-=g.a.ac.y;b=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,b);a.bufferData(a.ARRAY_BUFFER,new Float32Array(c),a.STATIC_DRAW);this.ug=b;c=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,c);a.bufferData(a.ARRAY_BUFFER,new Float32Array(d),a.STATIC_DRAW); this.Ts=c},Md:function(){},kc:function(a,b,c){a.enable(a.BLEND);a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ZERO);a.disable(a.DEPTH_TEST);var d=this.pa,e=b.R.zoom;arguments.callee.ka.apply(this,arguments);a.enableVertexAttribArray(d.Sd);a.enableVertexAttribArray(d.bi);var f=this.J.Ol(this.J.pe);a.uniform4f(d.Nv,f[0],f[1],f[2],f[3]);f=this.J.Ol(this.J.YG);a.uniform4f(d.kxa,f[0],f[1],f[2],f[3]);var f=this.J.DC("regions:land"),h=this.J.DC("water"),k=b.R.sg,l=0,m=0,n=0,p=0;a.activeTexture(a.TEXTURE1); 11>e&&f&&f.Ua&&(l=f.width*k,m=f.height*k,a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,f.Ua),a.uniform1i(this.pa.zxa,0));11>e&&h&&h.Ua&&(n=h.width*k,p=h.height*k,a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,h.Ua),a.uniform1i(this.pa.Bxa,1));a.uniform4f(this.pa.vz,l,m,n,p);a.bindBuffer(a.ARRAY_BUFFER,this.ug);a.vertexAttribPointer(d.Sd,3,a.FLOAT,!1,0,0);a.bindBuffer(a.ARRAY_BUFFER,this.Ts);a.vertexAttribPointer(d.bi,2,a.FLOAT,!1,0,0);a.drawArrays(a.TRIANGLES,0,12);a.disableVertexAttribArray(d.bi); this.Md()}});g.Ba.w$=g.Ba.Tb.extend({type:"mask",Nh:"\\n\\t\\t\\t\\tprecision highp float;\\n\\t\\t\\t\\tattribute highp vec2 a_Position;\\n\\n\\t\\t\\t\\tuniform vec2 u_DeltaPos;\\n\\t\\t\\t\\tuniform mat4 u_mvpMatrix;\\n\\n\\t\\t\\t\\tvoid main() {\\n\\t\\t\\t\\t\\thighp vec4 position = vec4(a_Position, 0, 1);\\n\\t\\t\\t\\t\\tgl_Position=u_mvpMatrix*position;\\n\\t\\t\\t\\t}\\n\\t\\t",Wd:"\\n\\t\\t\\t\\tprecision highp float;\\n\\t\\t\\t\\tvoid main() {\\n\\t\\t\\t\\t\\tgl_FragColor=vec4(1.0,0,0,1.0);\\n\\t\\t\\t\\t}\\n\\t\\t",r:function(a){this.bh=!1;this.J=a;this.e=a.e;this.createProgram(); this.Vi=20;this.HK=0},Of:function(){this.Nr&&(this.J.ga.deleteFramebuffer(this.Nr),this.J.ga.deleteRenderbuffer(this.Nr.uP),this.Nr=this.Nr.uP=null);this.J.deleteProgram(this.pa);this.pa=null},Ana:function(a,b){var c=b.size.width,d=b.size.height;if(this.Nr){var e=this.Nr.uP;if(c!==e.Dz||d!==e.Ul)a.bindRenderbuffer(a.RENDERBUFFER,e),a.renderbufferStorage(a.RENDERBUFFER,a.RGBA4,c,d)}else this.Nr=this.Dqa(a,b);a.bindFramebuffer(a.FRAMEBUFFER,this.Nr);a.viewport(0,0,c,d);a.disable(a.DEPTH_TEST);a.disable(a.BLEND); a.clear(a.COLOR_BUFFER_BIT);this.mX(a,b);e=c*d*4;this.lv&&e===this.lv.length||(this.lv=new Uint8Array(e));a.readPixels(0,0,c,d,a.RGBA,a.UNSIGNED_BYTE,this.lv);this.canvas||(this.canvas=document.createElement("canvas"));a.bindFramebuffer(a.FRAMEBUFFER,null)},JS:function(a,b){var c=this.J.e.Ae(a),d=Math.round(c.x),c=Math.round(c.y);return 0>d||0>c||d>=b.size.width||c>=b.size.height?!1:this.lv[4*((b.size.height-c)*b.size.width+d)+3]?!0:!1},wla:function(a,b){for(var c=Array(2),d=0;d<a.length;d+=1){c[0]= a[d][0]+g.a.ac.x;c[1]=a[d][1]+g.a.ac.y;var e=this.J.e.Ae(c),f=Math.round(e.x),e=Math.round(e.y);if(!(0>f||0>e||f>=b.size.width||e>=b.size.height)&&this.lv[4*((b.size.height-e)*b.size.width+f)+3])return!0}},u2:function(a,b){if(this.lv){var c;if("label"==a.type){c=[];for(var d=0,e=a.length;d<e;d+=1){var f=a[d].wa;this.JS(f,b)&&c.push(a[d])}c.opacity=a.opacity;c.zoom=a.zoom;c.type=a.type;c.el=a.el;c.eva=a.eva}else{for(d in a)a.hasOwnProperty(d)&&(f=a[d].da.wa,this.JS(f,b)||delete a[d]);c=a}return c}}, Dqa:function(a,b){var c=a.createFramebuffer(),d=b.size.width,e=b.size.height,f=a.createRenderbuffer();c.uP=f;f.Dz=d;f.Ul=e;a.bindRenderbuffer(a.RENDERBUFFER,f);a.renderbufferStorage(a.RENDERBUFFER,a.RGBA4,d,e);a.bindFramebuffer(a.FRAMEBUFFER,c);a.framebufferRenderbuffer(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.RENDERBUFFER,f);d=a.checkFramebufferStatus(a.FRAMEBUFFER);if(a.FRAMEBUFFER_COMPLETE!==d)console.log("Frame buffer object is incomplete: "+d.toString());else return a.bindFramebuffer(a.FRAMEBUFFER, null),a.bindRenderbuffer(a.RENDERBUFFER,null),c},Eo:[215440491,106744817],Ch:function(a,b){b.Ld=a.getAttribLocation(b,"a_Position");this.Hz=0},oq:256*Math.pow(2,20),kc:function(a,b){arguments.callee.ka.apply(this,arguments);a.enableVertexAttribArray(this.pa.Ld);this.Ana(a,b);this.Bna(a,b);a.disableVertexAttribArray(this.pa.Ld)},Bna:function(a,b){a.viewport(0,0,b.cva,b.Rua);a.enable(a.STENCIL_TEST);a.clearStencil(0);this.ga=a;a.clear(a.STENCIL_BUFFER_BIT);a.stencilFunc(a.ALWAYS,1,255);a.stencilOp(a.KEEP, a.KEEP,a.REPLACE);a.stencilMask(255);a.colorMask(0,0,0,0);this.mX(a,b);a.stencilFunc(a.EQUAL,1,255);a.colorMask(1,1,1,1)},mX:function(a,b){var c=b.hd;if(!c.buffer){var d=this.e.Z4(c);c[0]instanceof g.T?d=[[d]]:c[0][0]instanceof g.T&&(d=[d]);for(var e=[],f=[],h=0,k=d.length;h<k;h+=1){var l=d[h],m=l[0],n=l.slice(1),m=g.Bn.Lh(m,n);if(m.length){for(var n=e.length/2,p=0,q=m.length;p<q;p+=1)f.push(m[p]+n);m=0;for(n=l.length;m<n;m+=1)for(p=0,q=l[m].length;p<q;p+=1)e.push(l[m][p][0],l[m][p][1])}}if(e.length/ 3<Math.pow(2,16))c.buffer={Y:this.Hd(a.ARRAY_BUFFER,new Float32Array(e)),Vb:this.Hd(a.ELEMENT_ARRAY_BUFFER,new Uint16Array(f)),ui:f.length};else if(a.getExtension("OES_element_index_uint"))c.buffer={Xqa:!0,Y:this.Hd(a.ARRAY_BUFFER,new Float32Array(e)),Vb:this.Hd(a.ELEMENT_ARRAY_BUFFER,new Uint32Array(f)),ui:f.length};else{d=[];for(h in f)f.hasOwnProperty(h)&&(k=2*h,d.push(e[k],e[k+1]));c.buffer={Y:this.Hd(a.ARRAY_BUFFER,new Float32Array(d)),ui:d.length/2}}}e=this.pa;a.bindBuffer(a.ARRAY_BUFFER,c.buffer.Y); a.vertexAttribPointer(e.Ld,2,a.FLOAT,!1,0,0);c.buffer.Vb?(a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,c.buffer.Vb),a.drawElements(a.TRIANGLES,c.buffer.ui,c.buffer.Xqa?a.UNSIGNED_INT:a.UNSIGNED_SHORT,0)):a.drawArrays(a.TRIANGLES,0,c.buffer.ui)},Hd:function(a,b){if(b.length){var c=this.J.ga,d=c.createBuffer();c.bindBuffer(a,d);c.bufferData(a,b,c.STATIC_DRAW);return d}}});g.Ba.YK=g.Ba.lw.extend({ja:[g.ww],RO:1,cU:[1,0,1,1,0,0,1,1,0,1,0,0],Of:function(a){var b=a.ha;if(b){for(var c=0,d=b.length;c<d;c+=1)for(var e=0,f=b[c].Da.length;e<f;e+=1){var h=b[c].Da[e];h.Qi&&h.Qi.Ua&&(this.J.ga.deleteTexture(h.Qi.Ua),h.Qi.DBa=!0,b[c].Iwa=!0,h.Qi.Ua=null)}delete a.ha;this.hh=this.labels=this.tT=this.sq=null;this.Gh&&this.Gh.clear&&this.Gh.clear()}},Nh:"precision highp float;attribute vec4 a_Position;varying vec4 v_texcoord;varying lowp float f_texIndex;uniform lowp int u_type;uniform vec3 u_hlColorFactor;uniform vec2 u_texVertices[6];uniform mat4 u_mvpMatrix;uniform mat4 u_poiPrjMatrix;uniform mat4 u_textureMatrix[_ElemBatchNum_];uniform mat4 u_transMatrix[_ElemBatchNum_];uniform vec4 u_params[_ElemBatchNum_];void main(void) {\\tif(u_type == 2){\\t\\tgl_Position = u_poiPrjMatrix * vec4(a_Position.xyz, 1.0); \\t\\treturn;\\t}\\tint pointIdx = int(a_Position.z); \\tint elemIdx = int(a_Position.w); \\tvec4 param = u_params[elemIdx]; \\tf_texIndex  = param.z;   v_texcoord = vec4((u_textureMatrix[elemIdx] * vec4(u_texVertices[pointIdx].xy, 0.0, 1.0)).xy, param.xy);\\tvec4 pos =  vec4(a_Position.xy, 0.0, 1.0);\\tif(u_type == 0 ){ \\t\\tpos.z = param.w;\\t\\tgl_Position = u_mvpMatrix * u_transMatrix[elemIdx] * pos;\\t} else if(u_type == 1){\\t\\tgl_Position = u_poiPrjMatrix * pos;\\t\\tgl_Position.z = param.w;\\t} }", Wd:"precision mediump float;uniform sampler2D texture[_TexBatchNum_];uniform lowp int u_type;uniform highp vec3 u_hlColorFactor;varying vec4 v_texcoord;varying lowp float f_texIndex;void main(void) {\\tif(u_type == 2){\\t\\tgl_FragColor = normalize(vec4(0, 0, 0, 1)); return;\\t}\\tint style = int(v_texcoord.w); \\tif(style < 0){ gl_FragColor = vec4(0, 0, 0, 1); return; }\\tint texIdx = int(floor(f_texIndex+0.1)); \\tfloat opacity = v_texcoord.z; \\tvec4 smpColor; \\t__SmpColorLoop__\\tif(smpColor.a < 0.07) { discard; }\\tif( style > 0 ) {\\t\\tfloat r = u_hlColorFactor.x > 0.0 ? smpColor.r * u_hlColorFactor.x : -u_hlColorFactor.x; \\t\\tfloat g = u_hlColorFactor.y > 0.0 ? smpColor.g * u_hlColorFactor.y : -u_hlColorFactor.y; \\t\\tfloat b = u_hlColorFactor.z > 0.0 ? smpColor.b * u_hlColorFactor.z : -u_hlColorFactor.z; \\t\\tsmpColor = vec4(r, g, b, smpColor.a);\\t\\tif(style > 1){ smpColor = vec4(smpColor.rgb * 0.9, smpColor.a); }\\t} \\tsmpColor *= opacity;\\tgl_FragColor =  smpColor;}", Ch:function(a,b){b.Sd=a.getAttribLocation(b,"a_Position");b.Fv=a.getUniformLocation(b,"texture");b.zU=a.getUniformLocation(b,"u_texVertices");b.AU=a.getUniformLocation(b,"u_textureMatrix");b.uxa=a.getUniformLocation(b,"u_poiPrjMatrix");b.Cxa=a.getUniformLocation(b,"u_transMatrix");b.wU=a.getUniformLocation(b,"u_params");b.qxa=a.getUniformLocation(b,"u_hlColorFactor");b.hk=a.getUniformLocation(b,"u_type")},r:function(a,b){this.aE=500;this.bJ=this.Lqa=!0;var c=b.ga;this.ay=Math.max(1,Math.min(Math.floor((c.getParameter(c.MAX_VERTEX_UNIFORM_VECTORS)- 20)/4/4),128));this.Nh=this.Nh.replace(/_ElemBatchNum_/g,this.ay);this.tn=Math.min(this.ay,c.getParameter(c.MAX_TEXTURE_IMAGE_UNITS),16);for(var d=[],e=0;e<this.tn;e++)d.push((0<e?"else ":" ")+"if(texIdx=="+e+"){ smpColor = texture2D(texture["+e+"], v_texcoord.xy); }");this.Wd=this.Wd.replace(/_TexBatchNum_/g,this.tn).replace(/__SmpColorLoop__/g,d.join("\\n"));arguments.callee.ka.apply(this,arguments);this.W("reload",a,!0);this.W("style",b);this.Za=Math.min(2,window.devicePixelRatio||1);this.IU=this.Jg= this.pi=!0;this.DI=[];this.gM=[];this.hM=[];this.labels=[];this.rva=[];this.$ta=[];this.nm="";this.UP=null;this.Io=this.BI=this.MR=!1;this.tT=[];this.sq={};this.Bq={};this.A6=this.z6=0;this.C2=!1;this.aua=new g.Ec;this.tE=[];this.YR(a);this.xm=c.createBuffer()},styleChanged:function(){var a=this;this.J.e.od?a.rO||(a.rO=setTimeout(function(){a.rO=null;a.reloadChanged()},100)):a.reloadChanged()},reloadChanged:function(){this.h&&(this.h.Ja=!1);this.ta.count&&(this.ta.clear(),g.Aj&&g.Aj.clear());this.jva(); this.DI=[];this.sq={};this.gM=[];this.hM=[];this.UP=this.nm="";this.set("display")},YR:function(a){function b(a,b){g.Tj.am(a,function(c,h){b.tE.push({url:a,FI:h.FI})})}a=g.l.Z||a.ia?"big":"small";var c=g.A.Cc+"://vdata.amap.com/style_icon/icon-biz-"+a+".png";b(g.A.Cc+"://vdata.amap.com/style_icon/icon-normal-"+a+".png",this);b(c,this)},kn:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:!1;if(!this.rO&&!this.e.Bc.NN&&!this.J.e.wz&&a.length)if(this.QJ)this.jJ=!0;else{for(var c= a.length-1;0<=c;c-=1){var d=a[c];if(d.length)for(var e=Math.pow(2,20-d[0].ra.z),c=d.length-1;0<=c;c--){var f=d[c],h=f.ra;h.S=e;if(10>h.z){var k=this.sI(f);k&&(f.Sb=k,f.status="loaded",f.xa=!0,k.Wi+=1,f.Vm=(h.x-k.ra.x)/Math.pow(2,h.z),d.splice(c,1),this.set("display",0))}this.ta.set(f.key,f);!b&&f.we?f.we=!1:f.status="loading"}}this.WH(a,function(a){for(var c=a.length-1;0<=c;c-=1){var d=a[c];if(d.length){if(this.e.wz)break;var e=d[0].ra.z;this.Bv(d,1);for(var f=0,h=0;f<d.length;)this.bS(d.slice(100* h,100*h+100),e,b),f+=100,h+=1}}})}},Md:function(){if(this.ig&&!this.h.Ja){var a=this.h;g.oe.$e.end({key:"rl",index:2,id:this.J.e.D.id});a.Ja=!0;a.Dd?a.na("renderComplete"):(a.Dd=!0,a.na("complete"))}},mpa:function(a){var b=a.wa,c=b[0];a.reverse&&(c>g.a.Ca/2?c-=g.a.Ca:c<-g.a.Ca/2&&(c+=g.a.Ca));return[c,b[1]]},cX:function(a,b){var c=a.createTexture();a.bindTexture(a.TEXTURE_2D,c);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,b);a.texParameteri(a.TEXTURE_2D, a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);return c},oH:function(a,b){var c=null,d="IMG"===b.tagName&&0<b.src.indexOf("/style_icon/");d&&this.Bq[b.src]?c=this.Bq[b.src]:(c=this.cX(a,b),d&&(this.Bq[b.src]=c));return{width:b.width,height:b.height,Ua:c,lz:this.RO++}},OL:function(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];if(0===c.length)for(var d=0,e=b.length;d<e;d++){var f= b[d].Ud,h=f[0],k=f[1],l=f[2],f=f[3];c.push.apply(c,[l,k,0,d,l,f,1,d,h,k,2,d,l,f,3,d,h,f,4,d,h,k,5,d])}this.BI||a.bindBuffer(a.ARRAY_BUFFER,this.xm);a.bufferData(a.ARRAY_BUFFER,new Float32Array(c),a.STATIC_DRAW)},aba:function(a,b,c){for(var d=[],e=0,f=b.length;e<f;e++){var h=b[e][0],k=b[e][1];d.push.apply(d,[h[0],h[1],h[2],e,k[0],k[1],k[2],e])}a.bindBuffer(a.ARRAY_BUFFER,c);a.bufferData(a.ARRAY_BUFFER,new Float32Array(d),a.STATIC_DRAW);return c},g1:function(a,b,c,d,e,f){if(!a.z5&&!1===a.visible)return!1; var h=this.lo(d);if(!h||!h.width||!h.height)return!1;d=!a.cra&&"string"===typeof d&&0<d.indexOf("/style_icon/");f=f||0;h.Qi&&h.Qi.dc===this.dc&&a.floor===h.HF||(h.Qi=this.oH(b,h),h.Qi.dc=this.dc,a.nDa&&void 0!==a.floor&&(h.HF=a.floor));var k=this.h.ia?d&&!a.Ym?1.75:2:1;b=this.S;var h=h.Qi,l=e[2]/k,m=e[3]/k,n=e[0]/k,k=e[1]/k,p=e[4],q=e[5],r=e[6],s=e[7];e=null;a.lj&&a.yG&&(e=a.yG.q8,e={Ud:e?[e[0],e[1],e[0]+e[2],e[1]+e[3]]:null,dir:a.yG.dir});var u=c[0]+n*b,v=c[1]+k*b,p=[p,q,p+r,q+s],q=[u,v,u+l*b,v+ m*b];d&&(a.hka=!0);return{nj:a,xy:d,lz:h.lz,Bwa:h.Ua,r8:h.width,m8:h.height,P7:p,PD:e,i2:q,width:l,height:m,w6:c,offset:[n,k],NEa:b,rotation:f}},rI:function(a,b,c,d){var e=c[0],f=c[1],h=c[2]-e;c=c[3]-f;var k=new g.Ec;k.yv(1/a,1/b,1);0!==d&&(a=[e+h/2,f+c/2],k.translate(a[0],a[1],0),k.rotate(d,0,0,1),k.translate(-a[0],-a[1],0));k.translate(e,f,0);k.scale(h,c,1);return k},Npa:function(a,b,c,d){var e=new g.Ec;if(b||c||1!==d){var f=a[0],h=a[1];a=[f+(a[2]-f)/2,h+(a[3]-h)/2];e.translate(a[0],a[1],0);b&& e.rotate(b,0,0,1);c&&e.rotate(c,1,0,0);1!==d&&e.scale(d,d,1);e.translate(-a[0],-a[1],0)}return e},a6:function(a){for(var b=a.length;b<this.tn;b++)a[b]=0;return a},Ina:function(a,b,c){var d=[],e,f;e=0;for(f=c.mz.length;e<f;e++)b.activeTexture(b.TEXTURE0+e),b.bindTexture(b.TEXTURE_2D,c.mz[e]),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR),d[e]=e;b.uniform1iv(a.Fv,this.a6(d));var h=c.list,k=[],l=this.zF.R,d={p8:!0,E8:!0},m=l.rotation% 360;0>m&&(m+=360);if(this.Io&&c.sp)for(e=0,f=c.sp.length;e<f;e++)this.LH(a,b,c.sp[e],d);else for(c.sp=[],e=0,f=h.length;e<f;e++){var n=h[e],p=!1,q=-n.rotation,r=0,s=n.nj.hka;n.nj.$l?r=-m:45<=m&&315>=m&&n.PD&&(r=n.PD.dir,0===r?45<=m&&225>=m&&(p=!0):1===r&&135<=m&&315>=m&&(p=!0),r=90*-Math.round(m/90));var p=this.rI(n.r8,n.m8,p&&n.PD&&n.PD.Ud?n.PD.Ud:n.P7,0),u=this.vO(n.i2),q=this.Npa(u,q+r,s?l.pitch:0,s?1:this.xja);k.push([p.elements,q.elements,{nj:n.nj,Ud:u,opacity:n.nj.wS,o8:n.e0,x6:n.xy?-1:-2,d8:0}]); if(e===f-1||k.length>=this.ay)this.LH(a,b,k,d),this.Io&&c.sp.push(k),k=[]}},vO:function(a){var b=g.a.ac,c=b.x,b=b.y;return[a[0]-c,a[1]-b,a[2]-c,a[3]-b]},Fna:function(a,b,c){var d=[],e,f;e=0;for(f=c.mz.length;e<f;e++)b.activeTexture(b.TEXTURE0+e),b.bindTexture(b.TEXTURE_2D,c.mz[e]),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST),d[e]=e;b.uniform1iv(a.Fv,this.a6(d));var h=c.list,k=[],l,m;e=!1;d={p8:!0,E8:!1};this.rl&&(l=this.rl.L, m="active"===this.rl.ro?2:1);if(this.nfa!==l||this.ofa!==m)e=!0,this.nfa=l,this.ofa=m;if(!e&&this.Io&&c.sp)for(l=0,m=c.sp.length;l<m;l++)this.LH(a,b,c.sp[l],d);else for(c.sp=[],e=0,f=h.length;e<f;e++){var n=h[e],p=this.rI(n.r8,n.m8,this.mI(n,n.P7),0),q=null,r=n.nj===l,q=this.mI(n,n.GJ);k.push([p.elements,null,{nj:n.nj,Ud:q,opacity:n.nj.wS,o8:n.e0,x6:n.MS.z,d8:r?m:0}]);if(e===f-1||k.length>=this.ay)this.LH(a,b,k,d),this.Io&&c.sp.push(k),k=[]}},LH:function(a,b,c,d){var e=c.length;if(e){var f=null,h= null,k=null,l=null,m=d.p8,n=d.E8;if(this.Io&&c.G4)f=c.G4,l=c.vD,h=c.Cwa,k=c.Wwa;else{for(var f=[],h=[],k=[],l=[],p=0;p<e;p++)m&&h.push.apply(h,c[p][0]),n&&k.push.apply(k,c[p][1]),d=c[p][2],f.push(d),l.push(d.opacity,d.d8,d.o8,d.x6||0);this.Io&&(c.G4=f,c.vD=l,c.Cwa=h,c.Wwa=k,c.Y=[])}m&&b.uniformMatrix4fv(a.AU,!1,h);n&&b.uniformMatrix4fv(a.Cxa,!1,k);h=l.slice(0);b.uniform4fv(a.wU,h);this.OL(b,f,c.Y);this.BI||(b.vertexAttribPointer(a.Sd,4,b.FLOAT,!1,0,0),this.BI=!0);b.drawArrays(b.TRIANGLES,0,6*e)}}, fua:function(a,b){var c=!1;b.sc&&(this.J.Tr===b.sc?c=!0:void 0!==b.ou&&this.J.Tr===b.sc+"-"+b.ou&&(c=!0),b.z5=c);var c=b.z5||void 0===b.ek?!0:b.ek,d=b.wa;b.reverse&&!b.lva&&(d=this.mpa(b),b.lva=!0);var e=b.Da,f=b.Ta,h,k;b.Wp=[];if(!b.dj)for(h=0,k=e.length;h<k;h+=1)if(c||"CANVAS"===e[h].tagName){var l=this.g1(b,a,d,e[h],f[h],b.jq);l&&b.Wp.push(l)}return b.OS=!0},Np:function(a){if(a.dj){var b=Math.pow(2,20-this.zoom),c=30*b,d=[],e=!0,f={x:0,y:0},h=[],k=(this.rotation+720)%360,l=a.wa;for(90<k&&270>k&& (l=a.wa.slice(0).reverse());e;){for(var m=[],n=!0,k=0;k<a.name.length;k+=1){var p=a.Ta[k][2]/this.Za*b,q=g.zj.JO(l,p/2+c);if(!q){e=n=!1;break}c+=p;f.x=q[0];f.y=q[1];p=this.e.D.view.Ae(f);p=[p.x,p.y,q[2],q[0],q[1]];if(this.wR(p,a.Ta[k][2]/4))m.push(p);else{n=!1;break}}c+=360*b;n&&(d.push.apply(d,m),e=!1)}a.Wp=[];if(d.length){b=a.Da;c=a.Ta;for(k=0;k<d.length;k+=1)if(p=d[k][2],e=(new g.H(l[p+1][0]-l[p][0],l[p+1][1]-l[p][1])).direction(),f=k%b.length,p=c[f],f=b[f],h[0]=d[k][3],h[1]=d[k][4],p=this.g1(a, this.ga,h,f,p,360-e))p.SS=[0,0,0,0],p.GJ=[d[k][0],d[k][1],d[k][0],d[k][1]],p.lR=this.mI(p),a.Wp.push(p);return!0}return!1}if(!a.lj||a.Tu||a.Ym){d=a.Wp;if(!d.length)return!1;h=d[0].gQ;return a.si>this.zoom||11>(d[0].nj.Le||13)*h||0.75>h?!1:this.koa(d)}d=this.zF.R.pitch;return 60<d||45<d&&!a.Tu?!1:!0},koa:function(a){if(this.C2)return!0;var b,c;b=0;for(c=a.length;b<c;b++)if(!this.era(a[b]))return!1;return!0},Xoa:function(a){var b=a.lR;a=2*a.nj.margin;return{Jc:b[0]-a,fc:b[1]-a,Hc:b[2]+a,vc:b[3]+a}}, mI:function(a,b){b||(b=a.GJ);var c=a.SS||[0,0,0,0];return[b[0]-c[3],b[1]-c[0],b[2]+c[1],b[3]+c[2]]},dra:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,c=b,d=a[2]-a[0],e=a[3]-a[1];1>this.Mw&&(c+=Math.min(10,d)*(1-this.Mw),b+=Math.min(10,e)*(1-this.Mw));return!this.Gh.F1({Jc:a[0]-c,fc:a[1]-b,Hc:a[2]+c,vc:a[3]+b})},wR:function(a,b){return!this.Gh.F1({Jc:a[0]-b,fc:a[1]-b,Hc:a[0]+b,vc:a[1]+b})},era:function(a){return this.xsa&&!this.dra(a.lR,2*a.nj.margin)?!1:!0},Hsa:function(a){for(var b= 0,c=a.length;b<c;b++){var d=this.Xoa(a[b]);d.label=a[b].nj;this.Gh.Xr(d)}},rCa:function(a,b,c,d){var e=a[0],f=[],h,k=0,l;a=a[1];if(d){d=0;for(h=b.length;d<h;d++)0<d&&(k+=c),k+=b[d].height;a-=k}d=0;for(h=b.length;d<h;d++)k=b[d].width,l=b[d].height,f[d]=[e-k/2,a],f[d][2]=f[d][0]+k,f[d][3]=f[d][1]+l,a+=l+c;return f},qCa:function(a,b,c,d){var e=a[0],f=a[1];a=[];var h,k,l=0;h=0;for(k=b.length;h<k;h++)0<h&&(l+=c),l+=b[h].height;var m=f-l/2;h=0;for(k=b.length;h<k;h++)f=b[h].width,l=b[h].height,a[h]=[e+(d? -f:0),m],a[h][2]=a[h][0]+f,a[h][3]=a[h][1]+l,m+=l+c;return a},Fpa:function(a){var b=a.nj;if(b.Ym)return[0,0,0,0];if(a.xy)if(a=b.Rf,0===b.Ku){if(0===a)return[-5,0,-4,0];if(2===a)return[-7,-7,-7,-7];if(3===a||4===a||5===a||160<=a&&164>=a)return[-8,-8,-8,-8];if(6<=a&&8>=a)return[-5,0,-5,0];if(9===a)return[-7,0,-7,0];if(10<=a&&139>=a&&120!==a||142<=a&&144>=a||150<=a&&159>=a||164<=a&&169>=a)return[-3,-3,-3,-3]}else{if(1===b.Ku)return[-3,-3,-3,-3]}else if(13<=b.Le)return[-1,-1,-1,-1];return null},qla:function(a){var b= a.MS,c=1;a.gQ=1;if(1>this.Mw){var d=this.sA.height,e=b.y/d;0.5>e&&(d=Math.min(1,0<this.Mw?(0.5-e)*d/this.Mw*this.tca/3E3:1),a.gQ=1-0.4*d)}var c=c*a.gQ,d=b.x+a.offset[0]*c,b=b.y+a.offset[1]*c,e=d+a.width*c,f=b+a.height*c;a.GJ=a.kEa=[d,b,e,f];b=a.nj;b.lj&&!b.Tu&&(d=Math.pow(2,20-this.zoom),e=Math.min(1,Math.pow(2,this.zoom-b.zoom)),b.Fwa=e,c=c*d*e,d=a.w6[0]+a.offset[0]*c,b=a.w6[1]+a.offset[1]*c,e=d+a.width*c,f=b+a.height*c,a.i2=[d,b,e,f]);return!0},z3:function(a){function b(a,b,c){if(!e[c])for(var h= 0,k=d.length;h<k;h++)if(d[h].mz.length<f){d[h].n8.push(c);d[h].mz.push(b);e[c]=[h,d[h].n8.length-1];break}e[c]||(d.push({mz:[b],n8:[c],list:[]}),e[c]=[d.length-1,0]);a.e0=e[c][1];b=d[e[c][0]];a.xy&&(b.m9=!0);b.list.push(a)}function c(a,b){var c=a.xy?1:2,d=b.xy?1:2;return c!==d?c-d:b.lz-a.lz}var d=[],e={},f=this.tn;if(!a||!a.length)return d;var h,k;h=0;for(k=a.length;h<k;h++){var l=a[h];b(l,l.Bwa,l.lz)}h=0;for(k=d.length;h<k;h++)d[h].list.sort(c);d.sort(function(a,b){return(a.m9?1:2)-(b.m9?1:2)}); return d},NBa:function(a,b,c){for(var d=[],e=0,f=c.length;e<f;e++)for(var h=c[e],k=0,l=h.length;k<l;k++)if(h[k].xy){l=h[k].GJ;h=h[k].HDa;d.push([[(l[0]+l[2])/2,l[3],h.z],[h.x,h.y,h.z]]);break}d.length&&(this.aba(b,d,this.xm),b.vertexAttribPointer(a.Sd,4,b.FLOAT,!1,0,0),b.drawArrays(b.LINES,0,2*d.length))},Hna:function(a,b,c){var d=null,e=this.Io&&0===this.DI.length;e&&this.sq.road?d=this.sq.road:(d=this.z3(c),e&&(this.sq.road=d));c=0;for(e=d.length;c<e;c++)this.Ina(a,b,d[c])},Ena:function(a,b,c){var d= null,e=this.Io&&0===this.DI.length;e&&this.sq.poi?d=this.sq.poi:(d=this.z3(c),e&&(this.sq.poi=d));c=0;for(e=d.length;c<e;c++)this.Fna(a,b,d[c])},gua:function(a,b){var c=0,d;Math.round(this.zoom);for(d=b.length;c<d;c+=1){var e=b[c];e.OS||this.fua(a,e)}},ula:function(a){if(a.length){for(var b,c=[],d=0,e=a.length;d<e;d++)if(b=a[d].wa,a[d].dj)for(var f=0,h=b.length;f<h;f+=1)c.push({x:b[f][0],y:b[f][1]});else c.push({x:b[0],y:b[1]});c=this.e.D.view.x5(c);d=0;for(e=a.length;d<e;d++){var f=a[d],h=f.Wp.length, k;k=f.dj?c.splice(0,f.dj?f.wa.length:1):c.shift();if(f.dj)f.MS=g.a.uya(k);else for(b=0;b<h;b++){var l=f.Wp[b];l.MS=k;this.qla(l);l.SS||(l.SS=this.Fpa(l));l.lR=this.mI(l)}}}},xda:function(){for(var a=Array(this.Tg.length),b=0,c=this.Tg.length;b<c;b++){var d=this.Tg[b];d.length&&(a[b]=d[0].key+"-"+d[d.length-1].key)}return a.join("|")},WBa:function(){return 0!==this.z6||0!==this.A6},Jla:function(){var a=!1,b=this.xda(this.Tg);this.UP===b?this.nm===this.R.key&&this.labels.CE&&(a=!0):this.UP=b;this.MR= a},kc:function(a,b,c){arguments.callee.ka.apply(this,arguments);this.lang=b.lang;if(this.e&&this.e.D){this.ga=a;this.zF=b;this.R=b.R;this.jfa=!1;this.he=0;this.C2=this.BI=this.Io=!1;this.Ho(b,c);var d=this.Tg;if(this.tE.length){for(var e=0,f=this.tE.length;e<f;e++){var h=this.tE[e];this.Bq[h.url]=this.cX(a,h.FI)}this.tE.length=0}g.a.wf();for(e=d.length-1;0<=e;e-=1){var k=d[e];if(k.length&&(f=k[0].ra.z,h=!1,k.ig&&!g.Da.xe&&("stable"==this.Ff||f<=this.zoom&&"zoomIn"===this.Ff||f>=this.zoom&&"zoomOut"=== this.Ff)&&(!this.labels||!this.labels.length||this.TI||b.Tk||b.cJ||!this.FD(this.labels.el,this.Yj)||this.GI(b)||this.Qf!==b.Qf))){this.MR=!1;h=!0;h=[];b.Qf&&(h.push.apply(h,b.Qf),this.Qf=b.Qf);b.wb.length?(h.push.apply(h,b.wb),this.st=b.wb.dP):this.st=null;for(var l=k.length-1;0<=l;l-=1){var m=k[l],n=!1,p=m.ha;!p&&m.Sb&&m.Sb.ha&&(p=m.Sb.ha,n=!0);if(p)for(var q=0,r=p.length;q<r;q+=1){p[q].reverse=n;p[q].zoom=m.ra.z;var s=!1,u=p[q].wa;this.st&&g.a.Rb(this.st,function(a){!s&&g.wd.Nd(u,a.zf[0].wa)&& (s=!0)});s||h.push(p[q])}}k=[];l={};if(h.length)for(m=0,r=h.length;m<r;m++)h[m].id in l||(l[h[m].id]=1,k.push(h[m]));k.zoom=f;this.hS(k);c.hd&&k.length&&(k.type="label",k=this.J.hd.u2(k,b));k.sort(function(a,b){return a.zIndex!==b.zIndex?a.zIndex>b.zIndex?-1:1:!a.Be^!b.Be?a.Be?1:-1:a.Be==b.Be?a.id==b.id?a.Le==b.Le?a.name<b.name?-1:1:a.Le>b.Le?-1:1:a.id<b.id?-1:1:a.Be>b.Be?-1:1});this.labels=k;this.labels.el=this.Yj;this.TI=!1}}if(this.kP(b)){this.Md();this.wo=b.R.wo;if(!this.e.D.Ja||!this.labels|| !this.labels.length)return;this.oT();if(this.hh=this.labels)this.labels.Oo=this.zoom,this.labels.No=this.nb,this.labels.fq=this.rotation,this.labels.TJ=this.h.ia,this.labels.size=b.size;b.wb&&(this.wb=b.wb);this.wb&&(this.wb.Oo=this.zoom,this.wb.No=this.nb,this.wb.fq=this.rotation,this.wb.size=b.size)}this.D5=!1;this.TR=this.Ff;this.ora=this.wo;"stable"!==this.Ff&&this.set("display")}},GI:function(a){if(a.wb&&a.wb.length)if(this.wb&&this.wb.length){if(this.wb!==a.wb||this.wb.Oo!==this.zoom||this.wb.No!== this.nb||this.wb.fq!==this.rotation||!this.wb.size.cb(a.size))return!0}else return!0;else if(this.wb&&this.wb.length)return!0},hS:function(a){this.labels&&this.labels.opacity||(this.labels=[],this.labels.opacity={});for(var b={},c=0;c<a.length;c+=1){var d=a[c].id;d&&(d in this.labels.opacity?(b[d]=this.labels.opacity[d],delete this.labels.opacity[d]):b[d]=0,a[c].jj=!0)}for(var c=0,e=this.labels.length;c<e;c+=1)d=this.labels[c].id,this.labels.opacity[d]&&!this.labels[c].Iwa&&(a.push(this.labels[c]), b[d]=this.labels.opacity[d],this.labels[c].jj=!1);a.opacity=b},kP:function(a){return this.Qj||this.labels&&(this.e.sQ||this.labels!==this.hh||!this.hh||this.hh.Oo!==this.zoom||this.hh.No!==this.nb||a.Tk||this.hh.fq!==this.rotation||this.hh.TJ!==this.h.ia||!this.hh.size.cb(a.size))?!0:!1},jva:function(){this.labels=[]},N6:function(){this.set("display")},epa:function(){var a=this.e.D.get("highlightColorFactor")||[0.95,0.95,-0.95],b=this.zF.gs||"normal",b=b.replace("amap://styles/","");switch(b){case "insight":case "grey":case "dark":case "blue":case "darkblue":case "blue_night":case "mapv":a= [1.5,1.5,1];break;case "graffiti":a=[0.5,0.5,0.5]}return a},una:function(){var a=this.J.ga,b=this.pa;a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);a.enableVertexAttribArray(b.Sd);a.uniform2fv(b.zU,this.cU);a.uniform3fv(b.qxa,this.epa());var c=this.aua;c.KT(0,this.sA.width,this.sA.height,0,-1,1);a.uniformMatrix4fv(b.uxa,!1,c.elements);a.uniform1i(b.hk,0);for(var c=[],d=0;d<this.labels.length;d+=1){var e=this.labels[d];if(e.lj&&!e.Tu&&!(0.6>e.Fwa)){var f=this.labels.opacity[e.id];f&&(e.wS= f,c.push.apply(c,e.Wp))}}c.length&&this.Hna(b,a,c);a.uniform1i(b.hk,1);c=[];for(d=0;d<this.labels.length;d+=1)if(!this.labels[d].lj||this.labels[d].Tu)if(f=this.labels.opacity[this.labels[d].id])this.labels[d].wS=f,c.push.apply(c,this.labels[d].Wp);c.length&&this.Ena(b,a,c);a.disableVertexAttribArray(b.Sd);a.disable(a.BLEND)},Kia:function(a){this.Gh&&this.Gh.clear();this.Gh=new g.WS(a)},Gla:function(){this.xsa=!0},tDa:function(){var a=this.e.$ka,b=!a||!1===a.Jja;return this.jfa&&this.cN===this.bb&& (b||a.Ja)},oT:function(){var a=this.R.key,b=this.J.ga;this.xja=this.cN>this.zoom?Math.min(1,Math.max(0.75,1-(this.cN-this.zoom))):1;this.Gla();this.Jla();if(this.nm!==a){this.sA=this.e.D.get("size");new g.Gf(0,0,this.sA.width,this.sA.height);var c=this.zF.R.pitch*Math.PI/180;this.Mw=Math.cos(c);this.tca=Math.sin(c)}this.A6=this.z6=0;this.sq={};this.labels.OS||(this.gua(b,this.labels),this.labels.OS=!0);this.MR||(this.ula(this.labels),window.PEa=[]);this.Kia(this.labels.length);this.NS(this.labels); this.nm=a;this.hM=this.rva;this.gM=this.$ta;this.Io=!0;this.tT=this.labels.slice(0);this.tT.zoom=this.cN;this.una(this.hM,this.gM,this.DI);this.he&&this.set("display")},Po:function(a){this.Hsa(a.Wp)},NS:function(a){function b(b){a.opacity[b]<1-e?(a.opacity[b]+=e,d.he=1,d.Qj=1):a.opacity[b]=1}function c(b,c){c.dj?a.opacity[b]=0:a.opacity[b]>e?(a.opacity[b]-=e,d.he=1,d.Qj=1):a.opacity[b]=0}var d=this,e=0.34;if(!a.CE||this.wo&&!this.ora||"stable"==this.Ff&&"stable"!=this.TR){for(var f=0,h=a.length;f< h;f+=1){var k=a[f],e=0.34,l=k.id;if(k.jj){var m=this.Np(k);m?(this.Po(k),k.Fg=!0,b(l)):(k.Fg=!1,c(l,k))}else l in a.opacity&&(k.dj?delete a.opacity[l]:a.opacity[l]>e?(a.opacity[l]-=e,this.Qj=this.he=1):delete a.opacity[l])}a.CE=!0}else if("zoomIn"==this.Ff){f=0;for(h=a.length;f<h;f+=1)k=a[f],e=0.34,l=k.id,k.jj?k.Fg&&(k.dj&&this.Np(k),this.Po(k),b(l)):l in a.opacity&&(k.dj?delete a.opacity[l]:a.opacity[l]>e?(a.opacity[l]-=e,this.Qj=this.he=1):delete a.opacity[l]);f=0;for(h=a.length;f<h;f+=1)k=a[f], e=0.34,l=k.id,k.jj&&!k.Fg&&((m=this.Np(k))?(this.Po(k),k.Fg=!0,b(l)):(k.Fg=!1,c(l,k)))}else if("zoomOut"==this.Ff||a.zoom>this.zoom||!this.wo)for(f=0,h=a.length;f<h;f+=1)k=a[f],e=0.34,l=k.id,k.jj?k.Fg?(m=this.Np(k))?(this.Po(k),k.Fg=!0,b(l)):(k.Fg=!1,c(l,k)):c(l,k):l in a.opacity&&(k.dj?delete a.opacity[l]:a.opacity[l]>e?(a.opacity[l]-=e,this.Qj=this.he=1):delete a.opacity[l]);else for(f=0,h=a.length;f<h;f+=1)k=a[f],e=0.34,l=k.id,k.jj?k.Fg?(this.Po(k),b(l)):c(l,k):k.dj?delete a.opacity[l]:l in a.opacity&& (a.opacity[l]>e?(a.opacity[l]-=e,this.Qj=this.he=1):delete a.opacity[l]);return!1},ko:function(a,b){var c;if(this.zoom&&this.Gh){this.e.D.C=!0;var d=this.e.D.Ae(new g.H(a.hf(),a.de())),e=d.hf(),d=d.de();this.e.D.C=!1;e=this.Gh.search({Jc:e-1,fc:d-1,Hc:e+1,vc:d+1});if(e.length)if(b)for(d=0;d<e.length;d+=1)e[d].label.qs&&(c=e[d].label);else c=e[0].label}return c?[c]:[]},lo:function(a){if(!a)return null;if("IMG"===a.tagName||"CANVAS"===a.tagName||(a=g.Tj.K2(a))&&a.loaded)return a},FD:function(a,b){return a.z== b.z&&a.oy==b.oy&&a.GD==b.GD&&a.HJ==b.HJ&&JSON.stringify(a)==JSON.stringify(b)},mQ:function(a,b,c){if("roadlabel"===a||"poilabel"===a)for(a=0;a<b.length;a+=1){var d=b[a];if(d.sc){var e="",f="",h="";d.ld&&(h=d.ld[0],e=h[3],f=h[4],h=d.lj?"":h[7]);if(e=this.J.hy&&this.J.hy(e,f,h,d.sc,d.ou,c))d.visible=e[4],d.ek=e[3],d.yd=e[0];if(d.ld)for(f=0;f<d.ld.length;f+=1)h=d.ld[f],h[3]=e[0],h[4]=e[1],d.$l&&(h[7]=e[2])}}}}); g.Ba.n$=g.Ba.YK.extend({ja:[g.vL],type:"road_poi_label_limg",r:function(a,b){arguments.callee.ka.apply(this,arguments);this.dc=g.a.ub(this);this.Sn=g.o.xw.ni;this.vo=!0}});g.Ba.XK=g.Ba.YK.extend({type:"road_poi_label",r:function(a,b){arguments.callee.ka.apply(this,arguments);this.dc=g.a.ub(this);a.e.D.Qp&&this.RB(a,b);this.vo=!1;this.Sn=g.o.xw.ni;a.e.g("zoomend",this.Nj,this);a.e.g("moveend",this.Nj,this)}});g.Ba.YK.zb({qt:function(a,b){if(a){if(!this.rl||this.rl.L!==a||this.rl.ro!==b){var c=[];this.rl&&c.push(this.rl.L);this.rl={L:a,ro:b};c.push(a);this.N6(c)}}else this.nA()},nA:function(){this.rl=null},NG:function(){},SG:function(){if(this.rl){var a=[this.rl.L];this.rl=null;this.N6(a)}}});g.Ba.ye.$c=g.aa.extend({r:function(a){this.Xk=a},MD:function(a,b){var c=document.createDocumentFragment(),d=b&&b.HR?null:{},e=!0,f;for(f in a)if(a.hasOwnProperty(f)){var h=a[f],k,l=h.get("params");if(h.ba)k=h.ba;else{k=g.j.create("div");k.className="amap-marker";var m=l.Cg,n=l.G7,p=l.SI;m&&k.appendChild(m);n&&k.appendChild(n);p&&!1!==m.EL&&k.appendChild(p);h.ba=k;h.Cg=m;if(n=l.title)m.title=n;this.h.Tl=!0;-1===g.a.indexOf(this.h.Ng,h)&&this.h.Ng.push(h);h.Te=!0}var p=l.offset,q=p.x,r=p.y,s=l.textAlign, u=l.verticalAlign,n=l.anchor,m=!1,v,x;n&&(n=n.split("-"),2===n.length?(s=n[1],u=n[0]):1===n.length&&"center"===n[0]&&(s="center",u="middle"));var t,n=t=0;if("AMap.Text"==h.rp||"AMap.Marker"==h.rp){if(x=v=0,k.parentNode!==this.Xk&&d&&(m=!0,d[f]=h,e=!1),!m){h.Te||!h.Hj?(t=g.j.jo(h.Cg),h.Hj=t):t=h.Hj;n=t[0];t=t[1];switch(s){case "center":v=n/2;break;case "right":v=n}switch(u){case "middle":x=t/2;break;case "bottom":x=t}q-=v;r-=x}}else v=-q,x=-r;var w;if(!m)if(h.Te){var y=[];w=h.da.wa;w=new g.H(w[0], w[1]);var E=this.h.e.D.view.Ae(w,null,l.altitude);h.Ka=this.Ka;w=l.BE;r=Math.round(E.y+r+w.y);q=Math.round(E.x+q+w.x);y.push("top:"+r+"px");y.push("left:"+q+"px");y.push("z-index:"+(l.E4?this.h.vq+10:l.zIndex));if(!g.l.ue){q=v;if("AMap.Marker"==h.rp){q=-p.x;x=-p.y;switch(s){case "center":q=-p.x+n/2;x=-p.y+t/2;break;case "right":q=-p.x+n}switch(u){case "middle":x=-p.y+t/2;break;case "bottom":x=-p.y+t}}y.push(g.j.p3(k,l.pp,{x:q,y:x}))}y.push("display:"+(l.visible?"block":"none")+";");k.style.cssText= y.join(";");if((p=l.label)&&p.content){l=l.SI;s=p.direction;q=null;h.Xu||(q=g.j.jo(l),h.Xu=q);u=(q=h.Xu)&&q[0];x=q&&q[1];q=r=0;if(s&&u&&x)switch(s){case "top":r=-x;q=(n-u)/2;break;case "right":r=(t-x)/2;q=n;break;case "bottom":r=t;q=(n-u)/2;break;case "left":r=(t-x)/2;q=-u;break;case "center":r=(t-x)/2,q=(n-u)/2}p.offset?(r=r+p.offset.y+"px",q=q+p.offset.x+"px"):(r+="px",q+="px");l.style.top=r;l.style.left=q}}else w=h.da.wa,w=new g.H(w[0],w[1]),E=this.h.e.D.view.Ae(w,null,l.altitude),w=l.BE,r=Math.round(E.y+ r+w.y),q=Math.round(E.x+q+w.x),h.Ka=this.Ka,k.style.top=r+"px",k.style.left=q+"px";h.zoom=this.zoom;k.parentNode!==this.Xk&&(g.l.mi&&g.a.iepngFix(k),c.appendChild(k));h.Te=m;k.dB=this.Xk}this.Xk.appendChild(c);e||this.MD(d,{HR:!0})}});g.Ba.ye.ol=g.Ba.Tb.extend({r:function(a,b){this.bJ=this.ara=!0;arguments.callee.ka.apply(this,arguments);this.Gg()},WQ:function(){return this.Xa.$T},hj:function(){return this.Lb},Gg:function(){this.Lb=document.createElement("div");this.Lb.className="amap-markers";this.Xa=new g.Ba.ye.$c(this.Lb);this.Xa.h=this.h;this.J.K.appendChild(this.Lb)},Ss:function(a,b,c){this.By=c;this.yf=b.R.yf;this.S=b.R.S;this.zoom=b.R.zoom;this.size=b.size;this.Ga=b.R.Ga;this.Vp=b.S;this.ib=b.R.nb;this.eh=b.R.eh;a=!1;if(!this.Ka|| 3E4<Math.abs(this.ib.x-this.Ka.x)/this.S||3E4<Math.abs(this.ib.y-this.Ka.y)/this.S)a=!0;if(a||this.zoom<<0!==this.zoom||this.nf!==this.zoom)this.Ka=this.ib,this.nf=this.zoom},Gu:function(a){a=a.R.Ga.path;for(var b=a.length,c,d,e,f,h=0;h<b;h++)0===h?(c=a[h][0],e=a[h][0],d=a[h][1],f=a[h][1]):(a[h][0]<c&&(c=a[h][0]),a[h][0]>e&&(e=a[h][0]),a[h][1]<d&&(d=a[h][1]),a[h][1]>f&&(f=a[h][1]));return[c,d,e,f]},rv:function(){if(this.Ih&&this.Ih)for(var a in this.Ih)if(this.Ih.hasOwnProperty(a)){var b=this.Ih[a]; b.Xd!==this.Xd&&b.ba&&this.J.ul.appendChild(b.ba)}},kc:function(a,b,c){this.Xd=1E6*Math.random()<<0;this.Ss(a,b,c);this.R=b.R;this.size=b.size;var d=this.h;this.zd=256;var e;this.Yra=d=d.$m(this.Gu(b));var f=!1;c.hd&&(d=this.J.hd.u2(d,b));for(e in d)d.hasOwnProperty(e)&&(d[e].Xd=this.Xd,d[e].S4=this,f=!0);this.rv(d);f&&(this.Ss.call(this.Xa,a,b,c),this.Xa.MD(d),this.Ih=d,this.De(b))},De:function(){var a=Math.pow(2,this.zoom-this.ze);this.transform={translate:this.Ka.$a(this.ib).dd(this.S),scale:a, rotate:0}},Bu:function(a,b,c,d){c=this.h;var e=this.Yra,f=[];if(e&&a){a=this.h.e.D.view.Ae(a);if(c.Tl){for(var h=c.Ng,k=!0,l=[],m=0;m<h.length;m+=1){var n=h[m].Cg;if(n)if(n.parentNode&&n.parentNode.parentNode&&this.J&&n.parentNode.parentNode!==this.J.ul&&"none"!==n.parentNode.style.display){var p=n.clientWidth,q=n.clientHeight;n.childNodes[0]&&(p=p||n.childNodes[0].clientWidth,q=q||n.childNodes[0].clientHeight);window.opera&&(p=Math.max(p,n.childNodes[0].scrollWidth),q=Math.max(q,n.childNodes[0].scrollHeight)); p&&q?(n=Math.max(Math.abs(h[m].get("offset").x),Math.abs(h[m].get("offset").y))+Math.max(p,q),c.mf=Math.max(c.mf,n),c.Yf=Math.max(c.Yf,n),h[m].width=p,h[m].height=q):(k=!1,l.push(h[m]))}else k=!1,l.push(h[m])}k?(c.Tl=!1,c.Ng=[]):c.Ng=l}for(var r in e)if(e.hasOwnProperty(r)&&(h=e[r],l=h.cc()))if(k=h.get("params"),m=l.wa,"AMap.Text"==h.rp)k=h.get("params"),k.visible&&h.ba&&g.j.VC(d,h.ba,"amap-markers")&&f.push(h);else if(l=function(a,b){var c=Math.round(a.x+t),d=Math.round(a.x+t+v),e=Math.round(a.y+ w+x),f=Math.round(a.y+w),h=Math.round(b.x),k=Math.round(b.y);return h<=d&&h>=c&&k<=e&&k>=f?!0:!1},k=h.get("params"),k.visible&&h.ba)if(k.shape){m=new g.H(m[0],m[1]);m=this.h.e.D.view.Ae(m,null,k.altitude);if(n=k.pp%360){var p=a.x-m.x,q=a.y-m.y,s=Math.PI*n/180,n=Math.cos(-s),s=Math.sin(-s),u=p*s+q*n;a.x=m.x+(p*n-q*s);a.y=m.y+u}var v=h.width,x=h.height,t=k.offset.x,w=k.offset.y,p=!1;k.shape?(a.x-=t,a.y-=w,p=this.UC(h,a,m)):p=l(m,a);p&&f.push(h)}else g.j.VC(d,h.ba,"amap-markers")&&f.push(h);f.sort(function(a, b){return a.get("isTop")?-1:b.get("isTop")?1:a.get("zIndex")>b.get("zIndex")||a.get("zIndex")===b.get("zIndex")&&a.Ml>b.Ml?-1:1});b(f,c)}else b([],c)},UC:function(a,b,c){a=a.get("params").shape;if("circle"===a.B.type){var d=c.x+a.B.coords[0];c=c.y+a.B.coords[1];if(Math.sqrt((b.x-d)*(b.x-d)+(b.y-c)*(b.y-c))<=a.B.coords[2])return!0}else{if("poly"===a.B.type)return b=[b.x,b.y],a=a.B.coords,a=this.sH(a),g.wd.Nd(b,a);if("rect"===a.B.type){a=a.B.coords;c=a[0];var d=a[1],e=a[3],f=b.x;b=b.y;if(f<a[2]&&f> c&&b>e&&b<d)return!0}}return!1}});g.Ba.Z$=g.Ba.lw.extend({type:"traffic",Nh:"\\n    precision highp float;\\n    attribute vec4 a_Position;\\n    attribute vec3 a_Op, a_Pre, a_Next;\\n    \\n    uniform float u_Scale;\\n    uniform float u_Width;\\n\\n    uniform mat4 u_modelViewMatrix,u_projectionMatrix;\\n\\n    void main() {\\n      vec4 position = a_Position;\\n\\n      vec3 dir, preDir, nextDir;\\n      vec3 curCoord = position.xyz;\\n      vec3 preCoord = a_Pre.xyz;\\n      vec3 nextCoord = a_Next.xyz;\\n\\n      if (curCoord == preCoord) {\\n        dir = normalize(nextCoord - curCoord);\\n      } else if (curCoord == nextCoord) {\\n        dir = normalize(curCoord - preCoord);\\n      } else {\\n        preDir = normalize(preCoord - curCoord);\\n        nextDir = normalize(nextCoord - curCoord);\\n\\n        if (preDir == -nextDir) {\\n          dir = nextDir; \\n        } else {\\n          dir = normalize(-preDir + nextDir); \\n\\n          float cosA = dot(dir, -preDir);\\n\\n          if (cosA > sqrt(3.0) / 2.0) {\\n            cosA = sqrt(3.0) / 2.0; \\n          }\\n\\n          dir = dir / cosA;\\n        }\\n      }\\n\\n      if (a_Op.z > 0.0) {\\n        position.x = position.x - dir.y * u_Width;\\n        position.y = position.y + dir.x * u_Width;\\n      } else {\\n        position.x = position.x + dir.y * u_Width;\\n        position.y = position.y - dir.x * u_Width;\\n      }\\n\\n      gl_Position=u_projectionMatrix*u_modelViewMatrix*position;\\n    }\\n  ", Wd:"\\n    precision lowp float;\\n    uniform vec4 v_Color;\\n\\n    void main() {\\n      gl_FragColor=v_Color;\\n    }\\n  ",r:function(a,b){this.aE=300;this.bh=!0;arguments.callee.ka.apply(this,arguments);this.Vi=20;this.Za=this.h.Za;this.W("style",a);var c=this.e.get("style");this.style=this.YQ(c)},YQ:function(a){var b=null;a&&a.traffic&&a.traffic.multiFillColors&&(b=a.traffic.multiFillColors);return b},Ch:function(a,b){b.Ld=a.getAttribLocation(b,"a_Position");b.Ag=a.getAttribLocation(b,"a_Next");b.FO= a.getAttribLocation(b,"a_Pre");b.$G=a.getAttribLocation(b,"a_Op");b.Us=a.getUniformLocation(b,"v_Color");b.dxa=a.getUniformLocation(b,"u_Scale");b.nE=a.getUniformLocation(b,"u_Width")},Pj:function(){return Math.pow(2,this.zoom-this.Vi)*(this.h.ia?this.Za:1)},kn:function(a){for(var b=a.length-1;0<=b;b-=1){var c=a[b];if(c.length){var d=function(){var a=c.length;return function(){--a}}();this.Bv(c);this.Sp+=c.length;for(var e=c.length-1;0<=e;e-=1)this.kh(c[e],this.Xl,d)}}},kh:function(a){var b=a.ra; this.ta.Wc(a.key)||(this.ta.set(a.key,a),a.status="loading");var c=this.h.qo(b.x,b.y,b.z),c=new g.fb.vb(c,{callback:"callback"});c.g("complete",function(c){var e=this;this.h&&(a.Ma=c.data?c.data[g.a.OH(b.x,b.y,b.z).join("_")]:[],this.$u+=1,c=this.YQ(this.e.get("style")),g.zc.Ota({Ed:a.ra.z,Ic:[a],Z:this.h.get("forceBig")||g.l.Z,Za:this.h.get("forceBig")?1:this.Za,Mc:this.h.get("forceBig")?!1:this.h.ia,aGa:c},function(a,b){b.data.Ic.forEach(function(a){e.Vwa(a.Ma);a.status="loaded";a.xa=!0;e.ta.set(a.key, a)});e.set("display")}))},this);c.g("error",function(){a.status=null},this)},Md:function(){this.$u>=this.Sp&&(this.h.Ja||(this.h.Ja=!0),this.h.Dd?this.h.na("renderComplete"):(this.h.Dd=!0,this.h.na("complete")))},styleChanged:function(a){a&&(a=this.YQ(a),JSON.stringify(this.style)!==JSON.stringify(a)&&this.set("reload"))},kc:function(a,b,c){arguments.callee.ka.apply(this,arguments);this.ga=a;this.Ho(b,c);if(this.Tg.length&&this.Tg[0].length){var d=this.Tg[0].filter(function(a){return"loaded"===a.status}); d.length&&this.zs(a,d)}this.Md()},Vwa:function(a){var b=this,c=this.J.ga;a.forEach(function(a){a&&a[0].length&&a[1].length&&(a.ui=a[1].length,a[0]=b.um(c.ARRAY_BUFFER,a[0]),a[1]=b.um(c.ELEMENT_ARRAY_BUFFER,a[1]))})},um:function(a,b){if(b.length){var c=this.J.ga,d=c.createBuffer();c.bindBuffer(a,d);c.bufferData(a,b,c.STATIC_DRAW);return d}},zs:function(a,b){var c=this;if(b.length){var d=this.pa;a.useProgram(d);a.enableVertexAttribArray(d.Ld);a.enableVertexAttribArray(d.$G);a.enableVertexAttribArray(d.FO); a.enableVertexAttribArray(d.Ag);b.forEach(function(b){return c.Kna(a,b.Ma)});a.disableVertexAttribArray(d.Ld);a.disableVertexAttribArray(d.$G);a.disableVertexAttribArray(d.FO);a.disableVertexAttribArray(d.Ag)}},Of:function(a){var b=this;a.Ma&&a.Ma.forEach(function(a){b.J.ga.deleteBuffer(a[0]);a[0]=null;b.J.ga.deleteBuffer(a[1]);a[1]=null;a[2]=null})},Kna:function(a,b){var c=this,d=this.pa;b.forEach(function(b){if(0<b.ui){var f=b[2].borderColor,h=b[2].width;f&&(a.bindBuffer(a.ARRAY_BUFFER,b[0]),a.uniform1f(d.dxa, c.Pj()),a.uniform1f(d.nE,h/c.Pj()/2),a.uniform4fv(d.Us,f),a.vertexAttribPointer(d.Ld,2,a.FLOAT,!1,36,0),a.vertexAttribPointer(d.$G,3,a.FLOAT,!1,36,8),a.vertexAttribPointer(d.FO,2,a.FLOAT,!1,36,20),a.vertexAttribPointer(d.Ag,2,a.FLOAT,!1,36,28),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,b[1]),a.drawElements(a.TRIANGLES,b.ui,a.UNSIGNED_SHORT,0))}})}});g.Ba.ol=g.Ba.Tb.extend({type:"vector",Nh:"\\n    precision highp float;\\n\\n    attribute highp vec4 a_Position;\\n    attribute vec4 v_PositionDir;\\n    attribute vec3 v_Props;\\n\\n    uniform vec2 u_DeltaPos;\\n    uniform highp float u_Width;\\n    uniform lowp int u_Type;\\n\\n    varying highp float v_Distance;\\n    varying float v_Render;\\n    uniform highp vec2 u_radius;\\n\\n    uniform mat4 u_mvpMatrix;\\n\\n    void main() {\\n      highp vec4 position = vec4(a_Position.xy, 0, 1);\\n\\n      if (u_Type == 1 || u_Type == 5) {\\n        v_Distance = v_Props.x + u_Width * v_Props.y;\\n        v_Render = v_Props.z;\\n        float dis = sqrt(v_PositionDir.x*v_PositionDir.x+v_PositionDir.y*v_PositionDir.y);\\n        float x = v_PositionDir.x;\\n        float y = v_PositionDir.y;\\n        if(v_PositionDir.z==0.0&&v_PositionDir.w==0.0&&dis>4.0){\\n            x = v_PositionDir.x/dis*4.0;\\n            y = v_PositionDir.y/dis*4.0;\\n        }\\n        position.x = (position.x + u_Width * x) + u_Width * v_PositionDir.z;\\n        position.y = (position.y + u_Width * y) + u_Width * v_PositionDir.w;\\n      }\\n\\n      gl_Position=u_mvpMatrix*(position + vec4(u_DeltaPos.xy, 0, 0));\\n      gl_PointSize = (2.0*u_radius.x+2.0);\\n    }\\n  ", Wd:"\\n    precision highp float;\\n\\n    uniform vec4 v_Color;\\n    uniform vec4 u_ColorBorder;\\n    uniform vec3 u_Dash;\\n    // 2-[10, 10] 3-[10, 2, 10]\\n    uniform float u_DashType;\\n\\n    varying highp float v_Distance;\\n    varying float v_Render;\\n\\n    uniform lowp int u_Type;\\n\\n    uniform highp vec2 u_radius;\\n\\n    void main() {\\n      if (u_Type == 1 || u_Type == 5) {\\n        if (u_DashType == 2.0) {\\n          if (u_Dash[0] != 0.0 && u_Dash[1] != 0.0) {\\n            float all = u_Dash[0] + u_Dash[1];\\n            float off = mod(v_Distance, all);\\n\\n            if (off > u_Dash[0] && off <= all) {\\n              discard;\\n            }\\n          } \\n        } else if(u_DashType == 3.0) {\\n          if (u_Dash[0] != 0.0 && u_Dash[1] != 0.0 && u_Dash[2] != 0.0) {\\n            float all = u_Dash[0] * 2.0 + u_Dash[1] * 2.0 + u_Dash[2] * 2.0;  \\n            float off = mod(v_Distance, all);\\n\\n            vec3 solidBound = vec3(u_Dash[0], u_Dash[0] + u_Dash[1] + u_Dash[2], u_Dash[0] * 2.0 + u_Dash[1] * 2.0 + u_Dash[2]);\\n            vec3 dashBound = vec3(solidBound.x + u_Dash[1], solidBound.y + u_Dash[0], solidBound.z + u_Dash[2]);\\n\\n            if (off > solidBound.x && off <= dashBound.x \\n             || off > solidBound.y && off <= dashBound.y\\n             || off > solidBound.z && off <= dashBound.z) {\\n                discard; \\n             }\\n          } \\n        }\\n\\n        if (v_Render < 0.0) {\\n          discard; \\n        }\\n      }\\n      if(u_Type==6){\\n        float dis2center = distance(gl_PointCoord,vec2(0.5,0.5));\\n        float dis2border = dis2center*(u_radius.x+1.0)*2.0;\\n        if(dis2border<=u_radius.y-0.5){\\n          gl_FragColor=v_Color;\\n        }else if(dis2border<u_radius.x-0.5){\\n          if(dis2border<u_radius.y+0.5){\\n            float fac = 0.5-dis2border+u_radius.y;\\n            gl_FragColor = fac*v_Color+(1.0-fac)*u_ColorBorder;\\n          }else{\\n            gl_FragColor=u_ColorBorder;\\n          }\\n        }else {\\n          if(dis2border<=u_radius.x+0.5){\\n            gl_FragColor = u_ColorBorder;\\n            gl_FragColor.a *= 0.5-dis2border+u_radius.x;\\n          }else{\\n            discard;\\n          }       \\n        }\\n      }else\\n      gl_FragColor=v_Color;\\n    }\\n  ", Eo:[215440491,106744817],Pj:function(){return Math.pow(2,this.zoom-this.Vi)*(this.J.ia?this.Za:1)},Ju:function(a,b){if(a){a=g.a.wH(a);var c;"#"==a[0]?(a=a.substring(1),3==a.length&&(a=a.replace(/./g,function(a){return a+a})),c=g.a.kr(8==a.length?a:"ff"+a)):c=a;c=c.match(/rgba?\\((.+)\\)/)[1].split(",").slice(0,3).map(function(a){return a/255});void 0===b&&(b=1);return c.concat(b)}return[0,0,0,0]},Ch:function(a,b){b.jl=a.getAttribLocation(b,"a_Position");b.Vs=a.getAttribLocation(b,"v_PositionDir");b.Ws= a.getAttribLocation(b,"v_Props");b.$G=a.getAttribLocation(b,"a_Op");b.Us=a.getUniformLocation(b,"v_Color");b.cxa=a.getUniformLocation(b,"u_ColorBorder");b.mE=a.getUniformLocation(b,"u_Type");b.vxa=a.getUniformLocation(b,"u_radius");b.vK=a.getUniformLocation(b,"u_Dash");b.sz=a.getUniformLocation(b,"u_DashType");b.Qs=a.getUniformLocation(b,"u_DeltaPos");b.nE=a.getUniformLocation(b,"u_Width");this.vS=this.GP=this.wy=void 0;this.Hz=0},GBa:function(){},Ica:function(a){var b=this.ga,c=this.pa;b.useProgram(c); b.disableVertexAttribArray(c.jl);b.disableVertexAttribArray(c.Vs);b.disableVertexAttribArray(c.Ws);b.uniform2fv(c.Qs,[0,0]);b.uniform1f(c.sz,0);b.disable(b.DEPTH_TEST);b.enable(b.BLEND);b.blendFuncSeparate(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA,b.ONE,b.ONE_MINUS_SRC_ALPHA);a();b.disableVertexAttribArray(c.jl);b.disableVertexAttribArray(c.Vs);b.disableVertexAttribArray(c.Ws)},tna:function(){"function"===typeof this.$x[this.Wm[0]]?this.OP(this.Wm[0],this.$x[this.Wm[0]]):this.Wm.shift()},OP:function(a,b, c){this.Wm.length&&(this.Wm[0]===a?(this.Ica(b),c||this.Wm.shift(),"function"===typeof this.$x[this.Wm[0]]&&this.OP(this.Wm[0],this.$x[this.Wm[0]])):this.$x[a]=b)},oq:256*Math.pow(2,20),r:function(a,b){this.bh=!0;arguments.callee.ka.apply(this,arguments);this.Vi=20;this.Za=this.h.Za;this.Wm=[];this.$x={};this.HK=0},Gu:function(a){a=a.R.Ga.path;for(var b=a.length,c,d,e,f,h=0;h<b;h++)0===h?(c=a[h][0],e=a[h][0],d=a[h][1],f=a[h][1]):(a[h][0]<c&&(c=a[h][0]),a[h][0]>e&&(e=a[h][0]),a[h][1]<d&&(d=a[h][1]), a[h][1]>f&&(f=a[h][1]));return[c,d,e,f]},kc:function(a,b,c){var d=this;arguments.callee.ka.apply(this,arguments);a.disable(a.DEPTH_TEST);a.enable(a.BLEND);a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA);this.ga=a;this.HK++;a.cullFace(a.BACK);this.Wm.length=0;this.$x={};this.R=b.R;this.S=this.R.S;this.zoom=b.R.zoom;if(this.h.Ll&&this.h.Ll.Mp.length){var e=this.h.Ll.Mp.filter(function(a){return!!a});this.h.cR(e).forEach(function(a){d.U6(a[0],null)})}a.disableVertexAttribArray(this.pa.jl); a.disableVertexAttribArray(this.pa.Vs);a.disableVertexAttribArray(this.pa.Ws)},U6:function(a){for(var b=0,c=a.length;b<c;b+=1){var d=a[b];if(d.get("visible")){var e=d.name.split("-")[0],e="render"+e.slice(0,1).toUpperCase()+e.slice(1);if("function"===typeof this[e]){var f=this.ga,h=this.pa;f.disableVertexAttribArray(h.jl);f.disableVertexAttribArray(h.Vs);f.disableVertexAttribArray(h.Ws);f.uniform2fv(h.Qs,[0,0]);f.uniform1f(h.sz,0);this[e](d)}}}},renderPolygon:function(a){function b(b,h){if(b.length&& (e.bindBuffer(e.ARRAY_BUFFER,b[0]),e.vertexAttribPointer(d.jl,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(d.jl),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,b[1]),e.uniform1i(d.mE,2),e.uniform4fv(d.Us,m),b.Jl&&e.uniform2fv(d.Qs,b.Jl),e.drawElements(e.TRIANGLES,b.ui,b.cn,0),h))for(var l=0;l<b.XI.length;l+=1)c.Y6(b.XI[l],k,b.Jl,a,f)}var c=this,d=this.pa,e=this.ga,f=this.HK,h=[],k=a.style,l=a.cc();l instanceof g.Aa.yc?h=[l]:l instanceof g.Aa.pw&&(h=l.Nf);e.enable(e.BLEND);var m=this.Ju(k.fillColor,k.fillOpacity); h.forEach(function(d){var h="number"===typeof k.strokeWeight;0>=k.strokeWeight&&(k.strokeWeight=1);var l=d.zf;if(l&&l.length){var m=c.jI(a);if(d.Fj){d.Fj=!1;for(var s=[],u=0;u<l.length;u+=1)s.push(l[u].wa);g.zc.j6({Ed:c.e.get("zoom"),jv:s,Mc:c.h.get("forceBig")?!1:!!c.h.ia},function(b,k){var s=k.data;if(0===s[1].length)d.Ma=[];else if(s[1]instanceof Uint32Array?(e.getExtension("OES_element_index_uint"),s.cn=e.UNSIGNED_INT):s.cn=e.UNSIGNED_SHORT,s.ui=s[1].length,s[0]=c.um(e.ARRAY_BUFFER,s[0]),s[1]= c.um(e.ELEMENT_ARRAY_BUFFER,s[1]),s.XI=[],s.Jl=m,h)for(var u=l.length,y=0;y<l.length;y+=1){var E=l[y].wa;c.i6(E,e,E,a,f,function(a,b){a?console.log("loop parse Error"):(s.XI.push(b),s.XI.length==u&&(d.Ma=s,c.h.set("display")))})}})}else d.Ma&&(d.Ma.Jl=m);d.Ma&&b(d.Ma,h)}else d.Ma=[],d.Fj=!1})},jI:function(a){var b=0,c=0,d=a.da.zu()[0]-this.R.nb.x;d>g.a.Ca/2?b=-g.a.Ca:d<-g.a.Ca/2&&(b=g.a.Ca);if(a=a.get("deltaPos"))b+=a[0],c=a[1];if(b||c)return[b,c]},renderPolyline:function(a){function b(a){function b(){a.sAa? g.a.Rb(a,function(a){return f(a)}):f(a)}function f(a){e.bindBuffer(e.ARRAY_BUFFER,a[0]);e.vertexAttribPointer(d.jl,2,e.FLOAT,!1,36,0);e.vertexAttribPointer(d.Vs,4,e.FLOAT,!1,36,8);e.vertexAttribPointer(d.Ws,3,e.FLOAT,!1,36,24);e.enableVertexAttribArray(d.jl);e.enableVertexAttribArray(d.Vs);e.enableVertexAttribArray(d.Ws);e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a[1]);e.drawElements(e.TRIANGLES,a.ui,a.cn,0)}var k=a.Jl;k?e.uniform2fv(d.Qs,k):e.uniform2fv(d.Qs,[0,0]);"dashed"===h.strokeStyle&&2<=h.strokeDasharray.length&& (2==h.strokeDasharray.length?(e.uniform1f(d.sz,2),e.uniform3fv(d.vK,h.strokeDasharray.map(function(a){return a/c.Pj()}).concat(0))):(h.strokeDasharray=h.strokeDasharray.slice(0,3),e.uniform1f(d.sz,3),e.uniform3fv(d.vK,h.strokeDasharray.map(function(a){return a/c.Pj()}))));e.uniform1i(d.mE,1);h.isOutline&&(1>h.borderWeight&&(h.borderWeight=1),e.uniform1f(d.nE,(h.strokeWeight+2*h.borderWeight)/c.Pj()/2*c.Za),e.uniform4fv(d.Us,c.Ju(h.outlineColor,h.strokeOpacity)),b());e.uniform1f(d.nE,h.strokeWeight/ c.Pj()/2*c.Za);e.uniform4fv(d.Us,c.Ju(h.strokeColor,h.strokeOpacity));b()}var c=this,d=this.pa,e=this.ga,f=[],h=a.style,k=a.cc();if(h.strokeColor){1>h.strokeWeight&&(h.strokeWeight=1);var l=h.lineJoin||"miter";k instanceof g.Aa.Jq?f=[k]:k instanceof g.Aa.ow&&(f=k.Nf);f.forEach(function(d){var f=c.jI(a);d.Fj?(d.Fj=!1,g.PU.parse({jv:g.a.jb(d.wa),lineJoin:l,lineCap:h.lineCap||"butt",wy:"dashed"===h.strokeStyle},function(a,b){var h=b.data;0!==h[1].length&&(h.ui=h[1].length,h.Jl=f,h[1]instanceof Uint32Array? (e.getExtension("OES_element_index_uint"),h.cn=e.UNSIGNED_INT):h.cn=e.UNSIGNED_SHORT,h[0]=c.um(e.ARRAY_BUFFER,h[0]),h[1]=c.um(e.ELEMENT_ARRAY_BUFFER,h[1]),d.Ma=h,c.h.set("display",0))})):d.Ma&&(d.Ma.Jl=f);d.Ma&&b(d.Ma)})}else this.tna()},um:function(a,b){if(b.length){var c=this.J.ga,d=c.createBuffer();c.bindBuffer(a,d);c.bufferData(a,b,c.STATIC_DRAW);return d}},Qua:function(a){function b(b,f){0>=f.strokeWeight&&(f.strokeWeight=0);e.enable(e.BLEND);e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA, e.ONE,e.ONE_MINUS_SRC_ALPHA);e.vertexAttrib4f(d.jl,b[0],b[1],b[2],1);e.uniform1i(d.mE,6);e.uniform2f(d.vxa,(f.radius+f.strokeWeight)*c.Za,f.radius*c.Za);var k=h.fillColor,l=k;f.strokeWeight&&(l=h.strokeColor);e.uniform4fv(d.cxa,l);e.uniform4fv(d.Us,k);k=c.jI(a);e.uniform2fv(d.Qs,k||[0,0]);e.drawArrays(e.POINTS,0,1)}var c=this,d=this.pa,e=this.ga,f=a.style,h=a.cc(),k=h;if(k.Fj){k.Fj=!1;var l=k.wa,l=[l[0]-g.a.ac.x,l[1]-g.a.ac.y,0];k.Ma=l;k.fillColor=c.Ju(f.fillColor,f.fillOpacity);k.strokeColor=c.Ju(f.strokeColor, f.strokeOpacity);b(l,f)}else b(k.Ma,f)},renderCircle:function(a){function b(b,f){0>=f.strokeWeight&&(f.strokeWeight=0);e.bindBuffer(e.ARRAY_BUFFER,b[0]);e.vertexAttribPointer(d.jl,2,e.FLOAT,!1,0,0);e.enableVertexAttribArray(d.jl);e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,b[1]);e.uniform1i(d.mE,3);e.uniform4fv(d.Us,c.Ju(f.fillColor,f.fillOpacity));b.Jl&&e.uniform2fv(d.Qs,b.Jl);e.drawElements(e.TRIANGLES,b.ui,e.UNSIGNED_SHORT,0);c.Y6(b.ura,f,b.Jl,a,l)}if(a.Ru)this.Qua(a);else{var c=this,d=this.pa,e=this.ga, f=[],h=a.style,k=a.cc(),l=this.HK;k instanceof g.Aa.vg&&(f=[k]);f.forEach(function(d){var f=c.jI(a);if(d.Fj){d.Fj=!1;var k=d.wa,q=c.e.D.Qd({x:k[0],y:k[1]});g.zc.d6({ib:k.map(function(a,b){return a-c.Eo[b]}),al:a.get("radius")/c.e.D.getResolution(q,20)},function(b,h){var k=h.data;if(0!==k[1].length){k.ui=k[1].length;k.Jl=f;var p=g.a.jb(k[0]).slice(2);k[0]=c.um(e.ARRAY_BUFFER,new Float32Array(k[0]));k[1]=c.um(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(k[1]));c.i6(c.tpa(p),e,d,a,l,function(a,b){a?console.log("loop parse Error"): (k.ura=b,d.Ma=k,c.h.set("display"))})}})}else d.Ma&&(d.Ma.Jl=f);d.Ma&&b(d.Ma,h)})}},tpa:function(a){var b=this,c=[];a.forEach(function(a,e){var f=Math.floor(e/2);void 0===c[f]?c[f]=[a+b.Eo[0]]:c[f][1]=a+b.Eo[1]});return c},i6:function(a,b,c,d,e,f){var h=this;a.length||f(null,null);g.PU.parse({jv:g.a.jb(a),Zqa:!0},function(a,c){var d=c.data;d.ui=d[1].length;d[1]instanceof Uint32Array?(b.getExtension("OES_element_index_uint"),d.cn=b.UNSIGNED_INT):d.cn=b.UNSIGNED_SHORT;d[0]=h.um(b.ARRAY_BUFFER,d[0]); d[1]=h.um(b.ELEMENT_ARRAY_BUFFER,d[1]);f(null,d)})},Y6:function(a,b,c){var d=this,e=this.ga,f=this.pa;e.bindBuffer(e.ARRAY_BUFFER,a[0]);e.vertexAttribPointer(f.jl,2,e.FLOAT,!1,36,0);e.vertexAttribPointer(f.Vs,4,e.FLOAT,!1,36,8);e.vertexAttribPointer(f.Ws,3,e.FLOAT,!1,36,24);e.enableVertexAttribArray(f.jl);e.enableVertexAttribArray(f.Vs);e.enableVertexAttribArray(f.Ws);e.uniform1i(f.mE,5);"dashed"==b.strokeStyle&&2<=b.strokeDasharray.length&&(2==b.strokeDasharray.length?(e.uniform1f(f.sz,2),e.uniform3fv(f.vK, b.strokeDasharray.map(function(a){return a/d.Pj()}).concat(0))):(b.strokeDasharray=b.strokeDasharray.slice(0,3),e.uniform1f(f.sz,3),e.uniform3fv(f.vK,b.strokeDasharray.map(function(a){return a/d.Pj()}))));c&&e.uniform2fv(f.Qs,c);e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a[1]);e.uniform1f(f.nE,b.strokeWeight/d.Pj()/2*d.Za);e.uniform4fv(f.Us,d.Ju(b.strokeColor,b.strokeOpacity));e.drawElements(e.TRIANGLES,a.ui,a.cn||e.UNSIGNED_SHORT,0)}});g.Ba.y$=g.Ba.ol.extend({type:"massVector",RO:1,cU:[1,0,1,1,0,0,1,1,0,1,0,0],Nh:"precision mediump float;attribute highp vec4 a_Position;varying vec4 v_texcoord;uniform vec2 u_texVertices[6];uniform highp mat4 u_modelViewMatrix;uniform highp mat4 u_projectionMatrix;uniform mat4 u_textureMatrix;void main(void) { int pointIdx = int(a_Position.z);  v_texcoord = vec4((u_textureMatrix * vec4(u_texVertices[pointIdx].xy, 0.0, 1.0))); vec4 pos =  vec4(a_Position.xy, 0.0, 1.0); gl_Position = u_projectionMatrix * u_modelViewMatrix * pos;}", Wd:"precision mediump float;uniform sampler2D texture;varying vec4 v_texcoord;void main(void) { gl_FragColor =  texture2D(texture, v_texcoord.xy);}",Ch:function(a,b){b.Sd=a.getAttribLocation(b,"a_Position");b.Fv=a.getUniformLocation(b,"texture");b.zU=a.getUniformLocation(b,"u_texVertices");b.AU=a.getUniformLocation(b,"u_textureMatrix")},r:function(a,b){arguments.callee.ka.apply(this,arguments);this.dc=g.a.ub(this);this.xm=b.ga.createBuffer();this.Da={}},kc:function(a,b,c){arguments.callee.ka.ka.apply(this, arguments);this.R=b.R;this.S=this.R.S;this.zoom=b.R.zoom;var d=this.h.$m(this.Gu(b)),e=[],f;for(f in d)d.hasOwnProperty(f)&&e.push(d[f]);this.mT(e)},mT:function(a){var b={},c=this.h.get("style");a.forEach(function(a){var d=c;d instanceof Array&&(d="number"===typeof a.eb.style&&d[a.eb.style]?d[a.eb.style]:d[0]);b[d.url]||(b[d.url]={style:d,list:[]});b[d.url].list.push(a)});this.yia();for(var d in b)b.hasOwnProperty(d)&&this.Sua(b[d].style,b[d].list);this.xia()},yia:function(){var a=this.pa,b=this.J.ga; b.enable(b.BLEND);b.blendFuncSeparate(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA,b.ONE,b.ONE_MINUS_SRC_ALPHA);b.enableVertexAttribArray(a.Sd);b.uniform2fv(a.zU,this.cU)},xia:function(){var a=this.J.ga;a.disableVertexAttribArray(this.pa.Sd);a.disable(a.BLEND)},Sua:function(a,b){var c=this.lo(a.url);if(!c)return!1;c.Qi&&c.Qi.dc===this.dc||(c.Qi=this.oH(c),c.Qi.dc=this.dc);for(var d=a.size.width,e=a.size.height,f=a.anchor.x,h=a.anchor.y,k=[],l=0,m=b.length;l<m;l++){var n=b[l].cc().wa,p=this.S,n=[n[0]-f*p,n[1]- h*p];k.push(this.vO([n[0],n[1],n[0]+d*p,n[1]+e*p]))}this.Nca(c.Qi,k);return!0},Nca:function(a,b){var c=this.pa,d=this.J.ga;d.disable(d.DEPTH_TEST);d.activeTexture(d.TEXTURE0);d.bindTexture(d.TEXTURE_2D,a.Ua);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR);var e=this.rI(a.width,a.height,[0,0,a.width,a.height]);d.uniformMatrix4fv(c.AU,!1,e.elements);this.OL(d,b,this.xm);d.vertexAttribPointer(c.Sd,4,d.FLOAT,!1,0,0);d.drawArrays(d.TRIANGLES, 0,6*b.length)},rI:function(a,b,c){var d=c[0],e=c[1],f=c[2]-d;c=c[3]-e;var h=new g.Ec;h.yv(1/a,1/b,1);h.translate(d,e,0);h.scale(f,c,1);return h},oH:function(a){var b=this.J.ga,c=b.createTexture();b.bindTexture(b.TEXTURE_2D,c);b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,a);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);return{width:a.width,height:a.height, Ua:c,lz:this.RO++}},vO:function(a){var b=g.a.ac,c=b.x,b=b.y;return[a[0]-c,a[1]-b,a[2]-c,a[3]-b]},OL:function(a,b,c){for(var d=[],e=0,f=b.length;e<f;e++){var h=b[e],k=h[0],l=h[1],m=h[2],h=h[3];d.push.apply(d,[m,l,0,e,m,h,1,e,k,l,2,e,m,h,3,e,k,h,4,e,k,l,5,e])}a.bindBuffer(a.ARRAY_BUFFER,c);a.bufferData(a.ARRAY_BUFFER,new Float32Array(d),a.STATIC_DRAW);return c},lo:function(a){var b=this.Da[a];if("undefined"===typeof b)b=document.createElement("img"),b.crossOrigin="Anonymous",this.Da[a]=b,b.loaded=!1, g.F.oj(b,"load",function(){b.loaded=!0;var a=document.createElement("canvas");a.width=b.naturalWidth;a.height=b.naturalHeight;a.getContext("2d").drawImage(b,0,0);b.canvas=a;this.set("display")},this),b.src=a;else if(b.loaded)return b.canvas||b}});g.Ba.KE=g.Ba.Tb.extend({type:"imagelayer",Nh:"precision highp float;attribute vec3 a_Position;attribute vec2 uv;uniform mat4 u_modelViewMatrix;uniform mat4 u_projectionMatrix;varying vec2 vTextureCoord;void main(void) {\\tvTextureCoord = uv;\\tvec4 pos = u_projectionMatrix*u_modelViewMatrix * vec4(a_Position,1.0);\\tgl_Position = pos;}",Wd:"precision mediump float;uniform sampler2D texture;varying vec2 vTextureCoord;uniform float alpha;void main(void) {\\tvec4 smpColor = texture2D(texture, vTextureCoord);\\tgl_FragColor =  vec4(smpColor.xyz, alpha*smpColor.a);}", Ch:function(a,b){b.Sd=a.getAttribLocation(b,"a_Position");b.KU=a.getAttribLocation(b,"uv");b.Fv=a.getUniformLocation(b,"texture");b.Dka=a.getUniformLocation(b,"alpha")},r:function(a,b){this.bh=!0;arguments.callee.ka.apply(this,arguments);this.W("display",this.e);this.$z=this.Zz=1},Nxa:function(a){var b=this.J.ga;a=a.I;a[0]-=g.a.ac.x;a[1]-=g.a.ac.y;a[2]-=g.a.ac.x;a[3]-=g.a.ac.y;if(6===a.length){var c=-a[5],d=-a[4]-a[5];a=[a[0],a[1],d,a[2],a[3],c,a[0],a[1],c,a[0],a[1],d,a[2],a[3],d,a[2],a[3],c]}else a= [a[0],a[1],0,a[2],a[3],0,a[0],a[3],0,a[0],a[1],0,a[2],a[1],0,a[2],a[3],0];c=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,c);b.bufferData(b.ARRAY_BUFFER,new Float32Array(a),b.STATIC_DRAW);this.ug=c;a=[0,0,this.Zz,this.$z,0,this.$z,0,0,this.Zz,0,this.Zz,this.$z];c=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,c);b.bufferData(b.ARRAY_BUFFER,new Float32Array(a),b.STATIC_DRAW);this.Uxa=c},T2:function(a){for(var b=2;b<a;)b*=2;return b},Md:function(){var a=this.h;a.Ja||(a.Ja=!0,a.Dd?a.na("renderComplete"): (a.Dd=!0,a.na("complete")))},Mra:function(a){function b(a){var b=a.target;"AMap.VideoLayer"===c.h.U.CLASS_NAME&&(b.ontimeupdate=function(){0!==b.currentTime&&(c.Z8(),c.set("display"))});"AMap.CanvasLayer"!==c.h.U.CLASS_NAME&&c.set("display");!c.h.Ja&&c.h&&(c.h.Ja=!0,c.h.Dd?c.h.na("renderComplete"):(c.h.Dd=!0,c.h.na("complete")));c.h.ZD=!0;c.Ua.loaded=!0}var c=this;switch(this.h.U.CLASS_NAME){case "AMap.GroundImage":case "AMap.ImageLayer":this.bc||(this.bc=document.createElement("img"));this.bc.crossOrigin= "anonymous";this.bc.onload=this.bc.onerror=b;this.bc.src=a;break;case "AMap.CanvasLayer":this.bc=a;b({target:a});break;case "AMap.VideoLayer":if(!this.bc){var d=document.createElement("video");d.controls="controls";this.bc=d}g.j.JD(this.bc);this.bc.loop=this.h.U.get("loop");this.bc.autoplay=this.h.U.get("autoplay");this.bc.crossOrigin="anonymous";this.bc.onloadeddata=this.bc.onerror=b;if(a instanceof Array)for(d=0;d<a.length;d+=1){var e=document.createElement("source");e.src=a[d];this.bc.appendChild(e)}else e= document.createElement("source"),e.src=a,this.bc.appendChild(e)}},hv:function(){this.Ua&&(this.bc.ontimeupdate=null,this.J.ga.deleteTexture(this.Ua),this.J.ga.deleteBuffer(this.ug),this.bc=null)},Z8:function(){var a=this.bc,b=this.J.ga,c=a.width,d=a.height;"AMap.VideoLayer"===this.h.U.CLASS_NAME&&(c=a.videoWidth,d=a.videoHeight);if(!(2>c&&2>d)){this.$z=this.Zz=1;if(this.J.QI(c)&&this.J.QI(d))this.canvas=null;else{var e=this.T2(c),f=this.T2(d),h=this.canvas||document.createElement("canvas");this.canvas= h;h.width=e;h.height=f;h.getContext("2d").drawImage(a,0,0,c,d);this.Zz=c/e;this.$z=d/f}b.bindTexture(b.TEXTURE_2D,this.Ua);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,this.canvas||this.bc);b.generateMipmap(b.TEXTURE_2D);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.MIRRORED_REPEAT);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.MIRRORED_REPEAT)}},kc:function(a,b, c){this.Ua||(this.Ua=a.createTexture());if(c.Wg!==this.Ua.Wg||c.Wg.length!==this.Ua.Wg.length)this.bc&&(this.bc.onload=this.bc.onerror=this.bc.iEa=null),this.Ua.loaded=!1,this.Mra(c.Wg),this.Ua.Wg=c.Wg,this.h.nH=!0;if(this.Ua.loaded){this.h.ZD&&(this.h.ZD=!1,this.Z8(c));this.h.nH&&(this.Nxa(c),this.h.nH=!1);var d=this.pa;a.enable(a.BLEND);a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA);arguments.callee.ka.apply(this,arguments);a.activeTexture(a.TEXTURE0);a.uniform1f(d.Dka, c.opacity);a.uniform1i(d.Fv,0);a.bindTexture(a.TEXTURE_2D,this.Ua);a.enableVertexAttribArray(d.Sd);a.bindBuffer(a.ARRAY_BUFFER,this.ug);a.vertexAttribPointer(d.Sd,3,a.FLOAT,!1,0,0);a.enableVertexAttribArray(d.KU);a.bindBuffer(a.ARRAY_BUFFER,this.Uxa);a.vertexAttribPointer(d.KU,2,a.FLOAT,!1,0,0);a.drawArrays(a.TRIANGLES,0,6);this.Md();a.disableVertexAttribArray(d.KU);a.disableVertexAttribArray(d.Sd)}}});g.Kb.zb({gba:function(){var a=this.Sa.Yc;g.F.g(a,"touchstart",this.F3,this);a.addEventListener&&a.addEventListener("touchmove",this.EJ,{Sta:!1})},bga:function(){var a=this.Sa.Yc;g.F.G(a,"touchstart",this.F3,this);a.removeEventListener&&a.removeEventListener("touchmove",this.EJ)},wCa:function(a,b){var c=b.pageY-a.pageY,d=b.pageX-a.pageX;if(0!==d||0!==c){var e=0;0!==b.pageX-a.pageX?(e=180*Math.atan((b.pageY-a.pageY)/(b.pageX-a.pageX))/Math.PI,0===c?e=0<d?0:180:0>c&&0<d?e=-e:0>c&&0>d?e=180-e:0<c&&0> d?e=180-e:0<c&&0<d&&(e=360-e)):e=0<c?270:90;return e}},F3:function(a){if("info"!=a.sf&&(this.Qv(),!(window.PointerEvent&&a instanceof window.PointerEvent&&"mouse"===a.pointerType||(this.ve&&this.ve.stop(),2<a.touches.length)))){var b=this.Sa.Yc;this.V.touches=[];for(var c=0;c<a.touches.length;c+=1)this.V.touches.push({pageX:a.touches[c].pageX,pageY:a.touches[c].pageY,clientX:a.touches[c].clientX,clientY:a.touches[c].clientY});this.V.im||(1===a.touches.length&&(a.touches[0].sf=a.sf,a=this.wi(a.touches[0], !1,!1,a.srcElement),a.bd&&(a.bd.q("touchstart",a),a.bd!==this&&a.bd.get("bubble")&&this.q("touchstart",a),this.V.aG=a,g.F.g(b,"touchend",this.gR,this))),g.F.g(b,"touchmove",this.G3,this))}},HCa:function(a,b){return Math.sqrt((a.pageX-b.pageX)*(a.pageX-b.pageX)+(a.pageY-b.pageY)*(a.pageY-b.pageY))},G3:function(a){if(!this.V.im){if(1==a.touches.length){var b=(new g.H(a.touches[0].pageX,a.touches[0].pageY)).$a(this.V.aG.tb);if(b.length()<(g.l.El?30:10))return;this.V.im="drag"}else if(2<=a.touches.length){var b= new g.H(this.V.touches[0].pageX-a.touches[0].pageX,this.V.touches[0].pageY-a.touches[0].pageY),c=new g.H(this.V.touches[1].pageX-a.touches[1].pageX,this.V.touches[1].pageY-a.touches[1].pageY),d=b.length(),e=c.length();if(17>d&&17>e)return;b.direction();c.direction();(d=b.hu(c))&&30>d&&(60>b.hu(new g.H(0,1))&&60>c.hu(new g.H(0,1))||60>b.hu(new g.H(0,-1))&&60>c.hu(new g.H(0,-1)))?this.V.im="pitch":(d=new g.H(a.touches[1].pageX-a.touches[0].pageX,a.touches[1].pageY-a.touches[0].pageY),b=d.hu(b),c=d.hu(c), this.V.im=b&&(40>b||140<b)||c&&(40>c||140<c)?"zoom":"rotate")}switch(this.V.im){case "drag":this.fta(a);break;case "pitch":this.gta(a);break;case "zoom":this.ita(a);break;case "rotate":this.hta(a)}this.V.im&&(g.F.G(this.Sa.Yc,"touchmove",this.G3,this),g.F.G(this.Sa.Yc,"touchend",this.gR,this),g.F.g(document,"touchend",this.I3,this))}},I3:function(a){if(!(window.PointerEvent&&a instanceof window.PointerEvent&&"mouse"===a.pointerType))switch(0===a.touches.length&&g.F.G(document,"touchend",this.I3,this), this.V.im){case "drag":this.hma();this.V.im=null;break;case "pitch":this.ima();this.V.im=null;break;case "zoom":this.kma();this.V.im=null;break;case "rotate":this.jma(),this.V.im=null}},pt:function(a){var b=this;return function(c){b.na(a,c)}},vW:function(){this.wq||(this.wq=this.pt("touchstart"),this.Lv=this.pt("touchmove"),this.Kv=this.pt("touchend"));this.g("touchstart",this.wq,this);this.g("touchmove",this.Lv,this);this.g("touchend",this.Kv,this)},jZ:function(){this.G("touchstart",this.wq,this); this.G("touchmove",this.Lv,this);this.G("touchend",this.Kv,this);this.Kv=this.Lv=this.wq=null}});g.Kb.zb({gta:function(a){this.LN(a);g.F.g(this.Sa.Yc,"touchmove",this.LN,this)},ima:function(){g.F.G(this.Sa.Yc,"touchmove",this.LN,this)},LN:function(a){if(this.get("pitchEnable")&&!(a.touches.length<(g.l.zK?3:2))){var b=(a.touches[0].pageY-this.V.touches[0].pageY+(a.touches[1].pageY-this.V.touches[1].pageY))/2/this.get("size").height*180;this.set("pitch",b+parseFloat(this.get("pitch")));this.V.touches=[];for(b=0;b<a.touches.length;b+=1)this.V.touches.push({pageX:a.touches[b].pageX,pageY:a.touches[b].pageY, clientX:a.touches[b].clientX,clientY:a.touches[b].clientY})}}});g.Kb.zb({fta:function(){g.F.g(this.Sa.Yc,"touchmove",this.UZ,this);this.oha(this.V.aG);this.V.aG=null},hma:function(){g.F.G(this.Sa.Yc,"touchmove",this.UZ,this);this.nha()},nha:function(){var a=this.V;if(a.bp){var b=this.V.Mj;a.bp=!1;a.Pd=!1;a.Fp.q("touchend",b);a.Fp.q("dragend",b)}a.Fp=null;a.Tf=null;a.Ep=null;a.Mj=null},oha:function(a){var b=this.V,c;this.bN(a.bd)&&a.bd.get("draggable")&&(c=a.bd);!c&&this.pC&&(c=this);c&&(b.Pd=!0,b.Fp=c,b.Tf=a.tb,b.Ep=a)},UZ:function(a){var b=this.V;a.touches[0].sf= a.sf;if(b.Ep){var c=this.wi(a.touches[0],!0,!0);b.Ep.bd.q("touchmove",c);b.Ep.bd!==this&&b.Ep.bd.get("bubble")&&this.q("touchmove",c);if(this.kv(c.tb,b.Mj||b.Ep.tb,2))return;b.Mj=c;this.WN()}else c=this.wi(a.touches[0],!1,!1,a.srcElement),c.bd.q("touchmove",c),c.bd!==this&&c.bd.get("bubble")&&this.q("touchmove",c);if(a.preventDefault)a.preventDefault();else return!1}});g.Kb.zb({ita:function(){g.F.g(this.Sa.Yc,"touchmove",this.a_,this);this.sha(this.V.touches)},kma:function(){g.F.G(this.Sa.Yc,"touchmove",this.a_,this);this.rha()},sha:function(a){var b=a[0];a=a[1];var c=a.clientY-b.clientY,d=a.clientX-b.clientX;this.fN=1;this.dN=Math.sqrt(c*c+d*d);1==this.D.get("touchZoomCenter")?this.bw=this.get("centerCoords"):(b=new g.H((b.clientX+a.clientX)/2,(b.clientY+a.clientY)/2),this.bw=this.lg(b))},a_:function(a){if(!(2>a.touches.length)&&(g.F.preventDefault(a),this.get("zoomEnable")&& this.get("touchZoom"))){var b=0;if(a.scale)b=Math.log(a.scale/this.fN)/Math.log(2),this.fN=a.scale;else{var b=a.touches[0],c=a.touches[1];a=c.clientY-b.clientY;b=c.clientX-b.clientX;a=Math.sqrt(a*a+b*b);b=Math.log(a/this.dN)/Math.log(2);this.dN=a}b&&(b=this.get("zoom")+b,this.q1(b,this.bw,!0))}},rha:function(){this.fN=1;this.dN=null}});g.Kb.zb({hta:function(){g.F.g(this.Sa.Yc,"touchmove",this.WZ,this);this.qha(this.V.touches)},jma:function(){g.F.G(this.Sa.Yc,"touchmove",this.WZ,this);this.pha()},qha:function(a){var b=a[0];a=a[1];this.ZF=Math.atan2(a.clientY-b.clientY,a.clientX-b.clientX);this.eN=0},WZ:function(a){if(!(2>a.touches.length)&&(g.F.preventDefault(a),this.get("rotateEnable"))){var b;if(a.rotation)b=Math.round(this.get("rotation")+a.rotation-this.eN),this.eN=a.rotation;else{var c=a.touches[0];a=a.touches[1];c=Math.atan2(a.clientY- c.clientY,a.clientX-c.clientX);0.1<Math.abs(c-this.ZF)&&(b=Math.round(this.get("rotation")+180*(c-this.ZF)/Math.PI),this.ZF=c)}void 0!==b&&this.set("rotation",b)}},pha:function(){this.eN=0;this.ZF=null}});g.Kb.zb({gR:function(a){if(!(this.V.im||0<a.touches.length)){this.zg&&!this.Xg&&this.q("moveend");a=this.V.aG;var b=a.bd,c=this.D.get("allBubble")||b.get("bubble");c?(b.q("touchend",a),b!==this&&this.q("touchend",a)):b.q("touchend",a);this.Kf&&this.kv(a.tb,this.Ww,600)?(clearTimeout(this.Kf),this.Kf=null,c?(b.q("dblclick",a),b!==this&&this.q("dblclick",a)):b.q("dblclick",a),this.Ww=null):(this.q("clickstart",a),this.Kf&&(clearTimeout(this.Kf),this.Kf=null),this.Ww=a.tb,c?(b.q("click",a),b!==this&& this.q("click",a)):(b.q("click",a),this.q("closeOverlays",a)),b.get("topWhenClick")&&(b.Yb.C=!0,b.Yb.setTop(!0),b.Yb.C=!1),this.q("clickend",a),this.Kf=setTimeout(g.a.bind(function(){this.Kf=null},this),260));g.F.G(this.Sa.Yc,"touchend",this.gR,this)}}});g.Mz=function(a,b){this.min=void 0!==a?a:new g.Oa([Infinity,Infinity,Infinity]);this.max=void 0!==b?b:new g.Oa([-Infinity,-Infinity,-Infinity])}; g.Mz.prototype={constructor:g.Mz,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},jb:function(){return(new this.constructor).copy(this)},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},Qk:function(){var a=this.max.elements,b=this.min.elements;return a[0]<b[0]||a[1]<b[1]||a[2]<b[2]},JI:function(a){return a.max.elements[0]<this.min.elements[0]||a.min.elements[0]>this.max.elements[0]||a.max.elements[1]<this.min.elements[1]||a.min.elements[1]>this.max.elements[1]|| a.max.elements[2]<this.min.elements[2]||a.min.elements[2]>this.max.elements[2]?!1:!0},cb:function(a){return a.min.cb(this.min)&&a.max.cb(this.max)},Lf:function(){var a=new g.Oa,b=new g.Oa,c=new g.Oa,d=new g.Oa,e=new g.Oa,f=new g.Oa,h=new g.Oa,k=new g.Oa,l=[a,b,c,d,e,f,h,k];return function(m){var n=this.max.elements,p=this.min.elements;a.set(n[0],n[1],n[2]);b.set(p[0],n[1],n[2]);c.set(n[0],p[1],n[2]);d.set(p[0],p[1],n[2]);e.set(n[0],n[1],p[2]);f.set(p[0],n[1],p[2]);h.set(n[0],p[1],p[2]);k.set(p[0], p[1],p[2]);a.Lf(m);b.Lf(m);c.Lf(m);d.Lf(m);e.Lf(m);f.Lf(m);h.Lf(m);k.Lf(m);m=new g.Mz;for(var q=p=n=Infinity,r=-Infinity,s=-Infinity,u=-Infinity,v=0,x=l.length;v<x;v+=1){var t=l[v].elements,w=t[0],y=t[1],t=t[2]||0;w<n&&(n=w);y<p&&(p=y);t<q&&(q=t);w>r&&(r=w);y>s&&(s=y);t>u&&(u=t)}m.min.set(n,p,q);m.max.set(r,s,u);return m}}()}; function pd(a,b,c){var d=Infinity,e=Infinity,f=Infinity,h=-Infinity,k=-Infinity,l=-Infinity;c=c||3;for(var m=0,n=b.length;m<n;m+=c){var p=b[m],q=b[m+1],r=b[m+2];p<d&&(d=p);q<e&&(e=q);r<f&&(f=r);p>h&&(h=p);q>k&&(k=q);r>l&&(l=r)}a.min.set(d,e,f);a.max.set(h,k,l)};g.nL=function(a,b){this.origin=void 0!==a?a:new g.Oa;this.direction=void 0!==b?b:new g.Oa}; g.nL.prototype={constructor:g.nL,set:function(a,b){this.origin.copy(a);this.direction.copy(b);return this},jb:function(){return(new this.constructor).copy(this)},copy:function(a){this.origin.copy(a.origin);this.direction.copy(a.direction);return this},GH:function(a,b){return Math.sqrt(this.mna(a,b))},mna:function(){var a=new g.Oa;return function(b,c){var d=a.kz(b,this.origin).vf(this.direction);if(0>d)return Infinity;a.copy(this.direction).pn(d).add(this.origin);c&&c.copy(a);return a.b2(b)}}(),a2:function(){var a= new g.Oa,b=new g.Oa,c=new g.Oa;return function(d,e,f,h){a.copy(d).add(e).pn(0.5);b.copy(e).sub(d).normalize();c.copy(this.origin).sub(a);var k=0.5*d.re(e),l=-this.direction.vf(b),m=c.vf(this.direction),n=-c.vf(b),p=c.W4(),q=Math.abs(1-l*l),r;0<q?(d=l*n-m,e=l*m-n,r=k*q,0<=d?e>=-r?e<=r?(k=1/q,d*=k,e*=k,l=d*(d+l*e+2*m)+e*(l*d+e+2*n)+p):(e=k,d=Math.max(0,-(l*e+m)),l=-d*d+e*(e+2*n)+p):(e=-k,d=Math.max(0,-(l*e+m)),l=-d*d+e*(e+2*n)+p):e<=-r?(d=Math.max(0,-(-l*k+m)),e=0<d?-k:Math.min(Math.max(-k,-n),k),l= -d*d+e*(e+2*n)+p):e<=r?(d=0,e=Math.min(Math.max(-k,-n),k),l=e*(e+2*n)+p):(d=Math.max(0,-(l*k+m)),e=0<d?k:Math.min(Math.max(-k,-n),k),l=-d*d+e*(e+2*n)+p)):(e=0<l?-k:k,d=Math.max(0,-(l*e+m)),l=-d*d+e*(e+2*n)+p);f&&f.copy(this.direction).pn(d).add(this.origin);h&&h.copy(b).pn(e).add(a);return g.a.nc(l,6)}}(),JI:function(){var a=new g.Oa;return function(b){return null!==qd(this,b,a)}}(),vy:function(){var a=new g.Oa,b=new g.Oa,c=new g.Oa,d=new g.Oa,e=new g.Oa;return function(f,h,k,l,m){var n=this.origin, p=this.direction;c.kz(h,f);d.kz(k,f);e.Px(p,d);h=c.vf(e);if(0<h){if(l)return;a.kz(n,f)}else a.kz(f,n),h=-h;if(0>h)return!1;f=a.vf(e);if(0>f||f>h)return!1;b.Px(a,c);p=p.vf(b);if(0>p||f+p>h)return!1;p=d.vf(b);if(0>=p)return!1;p*=1/h;m&&m.copy(this.origin.jb().add(this.direction.jb().pn(p)));return p}}(),cb:function(a){return a.origin.cb(this.origin)&&a.direction.cb(this.direction)}}; function qd(a,b,c){var d,e,f,h;e=1/a.direction.elements[0];h=1/a.direction.elements[1];var k=1/a.direction.elements[2],l=a.origin;0<=e?(d=(b.min.elements[0]-l.elements[0])*e,e*=b.max.elements[0]-l.elements[0]):(d=(b.max.elements[0]-l.elements[0])*e,e*=b.min.elements[0]-l.elements[0]);0<=h?(f=(b.min.elements[1]-l.elements[1])*h,h*=b.max.elements[1]-l.elements[1]):(f=(b.max.elements[1]-l.elements[1])*h,h*=b.min.elements[1]-l.elements[1]);if(d>h||f>e)return null;if(f>d||d!==d)d=f;if(h<e||e!==e)e=h;0<= k?(f=(b.min.elements[2]-l.elements[2])*k,b=(b.max.elements[2]-l.elements[2])*k):(f=(b.max.elements[2]-l.elements[2])*k,b=(b.min.elements[2]-l.elements[2])*k);if(d>b||f>e)return null;if(f>d||d!==d)d=f;if(b<e||e!==e)e=b;return 0>e?null:(c||new g.Oa).copy(a.direction).pn(0<=d?d:e).add(a.origin)};z.o.Mq=z.o.Tb.extend({B:{visible:!0,opacity:1,zIndex:1200,zooms:[3,20],alwaysRender:!1,rejectMapMask:!0,type:"obj3d"},gltfOpts:{position:"",scale:1E3,height:0,scene:0,rotateX:0,rotateY:0,rotateZ:0},msa:[],r:function(a){this.CLASS_NAME=this.CLASS_NAME||"AMap.Object3DLayer";g.c.va(this,a);arguments.callee.ka.apply(this,arguments);this.objects=this.Og=[]},setOption:function(a){g.c.add(this,"setOption");"undefined"!==typeof a.position&&(this.gltfOpts.position=a.position);"undefined"!==typeof a.scale&& (this.gltfOpts.scale=a.scale);"undefined"!==typeof a.height&&(this.gltfOpts.height=a.height);"undefined"!==typeof a.scene&&(this.gltfOpts.scene=a.scene)},add:function(a){g.c.add(this,"add");this.C=!0;if(a&&a.gltf){a.gltf.option&&this.setOption(a.gltf.option);this.meshObj=[];this.gltf=a.gltf;this.Rra(a.gltf);var b=this.meshObj,c=b.length;a.layerMesh=b;for(a=0;a<c;a++)this.Og.push(b[a]),b[a].o=this,b[a].Py&&b[a].Py(),this.reDraw(),this.A5=!0}else-1==g.a.indexOf(this.Og,a)&&(this.Og.push(a),a.o=this, a.Py&&a.Py(),this.reDraw(),this.A5=!0);this.C=!1},remove:function(a){g.c.add(this,"remove");this.C=!0;if(a.gltf&&a.layerMesh)for(var b=0;b<a.layerMesh.length;b++){var c=a.layerMesh[b];-1!==g.a.indexOf(this.Og,c)&&(this.Og=g.a.Tx(this.Og,c),c.o=null,this.reDraw())}else-1!==g.a.indexOf(this.Og,a)&&(this.Og=g.a.Tx(this.Og,a),a.o=null,this.reDraw());this.C=!1},clear:function(){g.c.add(this,"clear");for(var a=0,b=this.Og.length;a<b;a+=1)this.Og[a].o=null;this.objects=this.Og=[];this.C=!0;this.reDraw(); this.C=!1},aI:function(a){return new {5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array}[a.componentType](a.bufferView.data,a.byteOffset||0,a.count*{SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16}[a.type])},eD:function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3];return[c*a[0]+d*a[4]+e*a[8]+f*a[12],c*a[1]+d*a[5]+e*a[9]+f*a[13],c*a[2]+d*a[6]+e*a[10]+f*a[14],c*a[3]+d*a[7]+e*a[11]+f*a[15]]},wsa:function(a,b){var c=this.eD(a,[b[0],b[1],b[2],b[3]]),d=this.eD(a, [b[4],b[5],b[6],b[7]]),e=this.eD(a,[b[8],b[9],b[10],b[11]]),f=this.eD(a,[b[12],b[13],b[14],b[15]]);return[c[0],c[1],c[2],c[3],d[0],d[1],d[2],d[3],e[0],e[1],e[2],e[3],f[0],f[1],f[2],f[3]]},Cna:function(a){for(var b=this.gltfOpts.scale||1,c=this.gltfOpts.position,d=a.primitives,e=this.gltf,f=this.gltfOpts.height||0,h={0:"POINTS",1:"LINES",2:"LINE_LOOP",3:"LINE_STRIP",4:"TRIANGLES",5:"TRIANGLE_STRIP",6:"TRIANGLE_FAN"},k=0;k<d.length;k++){var l=d[k],m=l.attributes,n=Object.keys(m),p=null,q=null,r=null, s=null;if(0==l.indices||l.indices)p=this.aI(e.accessors[l.indices]);for(var u=0;u<n.length;u++){var v=n[u];"POSITION"==v?q=this.aI(m.POSITION):"NORMAL"==v?r=this.aI(m.NORMAL):"TEXCOORD_0"==v&&(s=this.aI(m.TEXCOORD_0))}m=q.length/3;p&&(m=p.length);n={mode:h[l.mode]};(v=l.material)&&v.doubleSided&&!0==v.doubleSided&&(n.backOrFront="both");var l=r?new g.Wb.SE(n):new g.Wb.ft(n),n=l.da,u=[0,0,0,1],x=null;v&&v.pbrMetallicRoughness&&(v=v.pbrMetallicRoughness,v.baseColorFactor&&(u=v.baseColorFactor),v.baseColorTexture&& (v=v.baseColorTexture.index,e.textures&&e.textures[v]&&(x=e.textures[v].source.src,l.kd.push(x))));for(v=0;v<m;v+=1){var t=v;p&&(t=p[v]);var x=3*t,t=2*t,w=[q[x],q[x+1],q[x+2],1];a.cur_matrix&&(w=this.eD(a.cur_matrix,w));n.Y.push(w[0],-w[1],-w[2]);r&&n.bg.push(r[x],-r[x+1],-r[x+2]);s&&n.lk.push(s[t],s[t+1]);n.Wa.push(u[0],u[1],u[2],u[3])}b&&l.scale(b,b,b);if(this.gltf&&this.gltf.rotate)for(p=this.gltf.rotate,q=p.length-1;0<=q;q--)r=Object.keys(p[q])[0],l[r](p[q][r]);l.position(c,f);this.meshObj.push(l)}}, kQ:function(a,b){var c=null;a.matrix&&(c=a.matrix);b&&c?c=this.wsa(b,c):b&&(c=b);if(a.mesh)c&&(a.mesh.cur_matrix=c),this.Cna(a.mesh);else if(a.children)for(var d=a.children,e=d.length,f=0;f<e;f++)c?this.kQ(d[f],c):this.kQ(d[f])},Rra:function(a){var b=this.gltfOpts.scene;if(a.scenes&&a.scenes[b])for(var b=a.scenes[b].nodes,c=b.length,d=0;d<c;d++)this.kQ(a.nodes[b[d].nodeID])},Lo:function(a,b,c,d,e){for(var f=[],h=0,k=this.Og.length;h<k;h+=1){var l=this.Og[h];(l=(l.raycast||l.Lo).call(l,a,b,c,d,e))&& (l.length?f.push.apply(f,l):f.push(l))}f.sort(function(a,b){return a.Od-b.Od});return f[0]||null},reDraw:function(){g.c.add(this,"reDraw");this.o&&this.o.set("display")},Mf:function(a){this.get("map")||this.set("map",a.D,!0);return new g.o.Mq(this,a)}});g.o.Mq=g.o.Tb.extend({r:function(a,b){this.U=a;this.Bi="3D";this.hF=g.a.ub(this);a&&this.Qe(["opacity","visible","zIndex","zooms"],a);this.e=b;this.W("display",b);this.state={visible:!1,zIndex:0,lb:null,opacity:0,K:null,Og:null}},te:function(){this.U.A5&&this.U.Og.sort(function(a,c){return a.transparent!==c.transparent?a.transparent?1:-1:a.id>c.id?1:-1});var a=this.state;a.visible=this.get("visible");a.zIndex=this.get("zIndex");a.lb=this.get("zooms");a.opacity=this.get("opacity");a.K=this.get("container"); a.Og=this.U.Og;a.hd=this.mo();return this.state},Hl:function(a){if(g.Ba.Mq)return new g.Ba.Mq(this,a)}});g.Ba.Mq=g.Ba.Tb.extend({ja:[g.sa,g.Pe],o4:!0,r:function(a,b){this.h=a;this.J=b;this.e=b.e;this.W("display",a);this.Ko={}},createProgram:function(a){var b=this.J.ga,c=a.oh.vn,d=a.oh.Wd;if(c&&d){c=this.G0(c,d,a);if(c=g.om.createProgram(b,c[0],c[1]))c.oE=b.getUniformLocation(c,"_opacity"),c.qE=b.getUniformLocation(c,"u_projectionMatrix"),c.pE=b.getUniformLocation(c,"u_modelViewMatrix"),d=a.getWebGLVariableLoaction||a.Ch,a.bh&&(c.qU=b.getUniformLocation(c,"fog"),c.xK=b.getUniformLocation(c,"fogColor")), d&&(b=this.J.ga,d.call(a,b,c));return c}},wpa:function(a){var b=a.type;if(!b)return null;var c=this.Ko[b];c||(c=this.createProgram(a),this.Ko[b]=c);return c},Ama:function(a){return{Sqa:a.isEnabled(a.DEPTH_TEST),Nqa:a.isEnabled(a.BLEND),Rqa:a.isEnabled(a.CULL_FACE)}},zma:function(a,b){b.Sqa?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST);b.Nqa?a.enable(a.BLEND):a.disable(a.BLEND);b.Rqa?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE);a.cullFace(a.BACK)},jj:function(a,b,c){var d=a.Zc;d||(d=b);a=a.da.Fl.Lf(d); return c.JI(a)?!0:!1},kc:function(a,b,c){b=b.R;var d=c.Og;this.Ga=b.Ga;a.clear(a.DEPTH_BUFFER_BIT);a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA);var e=this.Ama(a);a.enable(a.DEPTH_TEST);for(var f=0,h=d.length;f<h;f+=1){var k=d[f];k.TB&&k.TB(this.e.D);k.AK();k.Co&&k.EU(b.Zc);var l=k.ls;l&&(k.Zc=(new g.Ec).set(b.Zc).multiply(l));if(this.jj(k,b.Zc,b.Xf.wQ,this.e.D)&&(l=this.wpa(k))){a.useProgram(l);a.uniform1f(l.oE,isNaN(c.opacity)?1:parseFloat(c.opacity));k.update(a, l,b.Zc,this.e.D);l.qE&&a.uniformMatrix4fv(l.qE,!1,b.Xf.elements);l.pE&&(k.Fsa=new g.xV(k.Zc.Ig().iE()),a.uniformMatrix4fv(l.pE,!1,k.Zc.elements));if(k.acceptFog||k.bh){var m=this.e.D.view.Rm*(1+1.1*Math.cos(b.pitch*Math.PI/180));a.uniform2f(l.qU,0.9*m,1.5*m);m=this.J.nq.UD;a.uniform4f(l.xK,m[0],m[1],m[2],1)}k.transparent?a.enable(a.BLEND):a.disable(a.BLEND);(k.render||k.N).call(k,a,l)}}this.zma(a,e);this.h.Ja||(this.h.Ja=!0,g.a.Qc(function(){this.h&&(this.h.Dd?this.h.na("renderComplete"):(this.h.Dd= !0,this.h.na("complete")))},this))}});g.Ee=g.aa.extend({r:function(){this.vertices=this.Y=[];this.vertexUVs=this.lk=[];this.vertexColors=this.Wa=[]},AK:function(){this.boundingBox=this.Fl=new g.Mz;pd(this.Fl,this.Y)},Lo:function(a){if(!qd(a,this.Fl))return null}});g.Ee.Nb({AK:"updateBoundingBox"});g.nw={};g.nw.VU=g.aa.extend({r:function(a,b){this.pA=a;this.NA=b;this.update()},update:function(){var a=this.pA,b=this.NA;this.color=[a[0]*b,a[1]*b,a[2]*b]},setColor:function(a){this.pA=a;this.update()},setIntensity:function(a){this.NA=a;this.update()}}); g.nw.dV=g.aa.extend({r:function(a,b,c){this.pA=b;this.NA=c;this.direction=a;this.update()},update:function(){var a=this.pA,b=this.NA;this.color=[a[0]*b,a[1]*b,a[2]*b]},setDirection:function(a){this.direction=a},setIntensity:function(a){this.NA=a;this.update()},setColor:function(a){this.pA=a;this.update()}});g.Ee.ft=g.Ee.extend({r:function(){this.type="mesh";this.boundingBox=this.Fl=null;this.vertices=this.Y=[];this.faces=this.Eg=[];this.vertexUVs=this.lk=[];this.vertexColors=this.Wa=[];this.textureIndices=this.oz=[]}});g.Ee.Vo=g.Ee.extend({r:function(){this.type="line";this.boundingBox=this.Fl=null;this.vertices=this.Y=[];this.segments=this.Kh=[];this.vertexUVs=this.lk=[];this.vertexColors=this.Wa=[];this.textureIndices=this.oz=[]}});g.Ee.Xz=g.Ee.extend({r:function(){this.type="points";this.boundingBox=this.Fl=null;this.vertices=this.Y=[];this.vertexColors=this.Wa=[];this.pointSizes=this.KS=[];this.pointAreas=this.Vy=[];this.vertexUVs=this.lk=[];this.textureIndices=this.oz=[]}});g.Ee.Aw=g.Ee.extend({r:function(){this.type="wideline";this.boundingBox=this.Fl=null;this.vertices=this.Y=[];this.vertexIndices=this.mm=[];this.directions=this.Ux=[];this.vertexUVs=this.lk=[];this.vertexColors=this.Wa=[];this.textureIndices=this.oz=[]},f6:function(){if(this.Y.length){for(var a=[],b=0,c=this.Y.length/3;b<c;b++){var d=3*b;a.push([this.Y[d],this.Y[d+1],this.Y[d+2]])}c=g.PU.parse({jv:a,Y5:!!this.Y5,Qqa:!0,Zwa:!1});a=c[0];b=c[2];this.mm=c[1];this.Vv=[];this.Ux=[];c=0;for(d=a.length/9;c< d;c++){var e=9*c;this.Vv.push(a[e],a[e+1],b[c]);this.Ux.push(a[e+2],a[e+3])}if(this.Vv.length/3>this.Wa.length/4)for(a=this.Vv.length/3-this.Wa.length/4;0<a--;)this.Wa.push.apply(this.Wa,this.Wa.slice(0,4))}}});g.Wb=g.aa.extend({r:function(a){g.c.va(this,a);this.id=g.Wb.count++;this.type="basic";this.DEPTH_TEST=!0;this.transparent=!1;this.bh=!0;this.textures=this.kd=[];this.geometry=this.da=new g.Ee;Object.defineProperty(this,"needUpdate",{configurable:!1,enumerable:!0,set:function(a){this.hZ=this.At=a},get:function(){return this.At}});this.Co=this.needUpdate=!0;this.ls=new g.Ec;this.aK=new g.Ec;this.Bs=new g.Ec},position:function(a,b){a&&(this.yl=a);this.IA=b||0;this.Co=!0;this.reDraw();return this.yl}, reDraw:function(){this.o&&this.o.reDraw()},scale:function(a,b,c){this.aK.scale(a,b,c);this.Co=!0;this.reDraw()},yv:function(a,b,c){this.aK.yv(a,b,c);this.Co=!0;this.reDraw()},fz:function(a,b,c,d){this.Bs.fz(a,b,c,d);this.Co=!0;this.reDraw()},Cs:function(a){this.Bs.Cs(a);this.Co=!0;this.reDraw()},Ds:function(a){this.Bs.Ds(a);this.Co=!0;this.reDraw()},Es:function(a){this.Bs.Es(a);this.Co=!0;this.reDraw()},reset:function(){this.ls.HT();this.Bs.HT();this.aK.HT();this.Co=!0;this.reDraw()},EU:function(){var a= this.o.getMap(),b={x:0,y:0};this.yl&&(b=a.VI(this.yl));this.ls=(new g.Ec).translate(b.x,b.y,-this.IA||0).multiply(this.Bs).multiply(this.aK);this.Co=!1},j5:{vec4:"4fv",mat3:"Matrix3fv",mat4:"Matrix4fv",vec3:"3fv",vec2:"2fv","float":"1f","int":"1i",bool:"1i"},Lo:function(){return!1},u8:function(){if(this.kd.length)for(var a=this.o.o.e.J,b=0;b<this.kd.length;b+=1)if(!a.kd[this.kd[b]].Ua)return!1;return!0},Hd:function(a,b,c,d){if(c.length)return d=d||a.createBuffer(),a.bindBuffer(b,d),a.bufferData(b, c,a.STATIC_DRAW),d},a9:function(){if(this.kd.length)for(var a=this,b=this.o.o.e.J,c=0;c<this.kd.length;c+=1){var d=this.kd[c];if(!b.kd[d]||d.needUpdate)if(b.kd[d]={url:d},d instanceof HTMLCanvasElement){var e=b.createTexture(d);b.kd[d].Ua=e;b.kd[d].width=d.width;b.kd[d].height=d.height}else e=d.replace(/http[s]{0,1}:/,g.A.Cc+":"),b.aS(d,e,function(c,d,e,l){b.kd[c].Ua=d;b.kd[c].width=e;b.kd[c].height=l;a.o.o.set("display")},function(a){b.kd[a].status="load failed"})}},AK:function(){this.hZ&&(this.da.AK(), this.hZ=!1)},update:function(a,b,c,d){this.e=d;this.At&&((this.updateBuffers||this.U8).call(this,a,b),(this.updateTextures||this.a9).call(this,a,b),this.needUpdate=!1)},U8:function(a){var b=this.oh,c=b.attributes,d=0,e;for(e in c)if(c.hasOwnProperty(e)){var f=c[e].value.call(this,this),h=e+"Buffer";!f.length&&this[h]&&(a.deleteBuffer(this[h]),this[h]=null);f.length&&(this[h]=this.Hd(a,a.ARRAY_BUFFER,new Float32Array(f),this[h]),this[h].size=parseInt(c[e].type.substr(3))||1,this[h].length=f.length/ this[h].size,d=this[h].length)}if(b=b.vertexIndices||b.mm)b=b.call(this),!b.length&&this.Nk&&(a.deleteBuffer(this.Nk),this.Nk=null),b.length&&(d>=Math.pow(2,16)&&a.getExtension("OES_element_index_uint")?(this.Nk=this.Hd(a,a.ELEMENT_ARRAY_BUFFER,new Uint32Array(b),this.Nk),this.Nk.cn=a.UNSIGNED_INT):(this.Nk=this.Hd(a,a.ELEMENT_ARRAY_BUFFER,new Uint16Array(b),this.Nk),this.Nk.cn=a.UNSIGNED_SHORT),this.Nk.length=b.length)},W0:function(a,b){if(-1!==b.Q8){if(this.kd.length){for(var c=this.o.o.e.J,d=0;8> d;d+=1)d<this.kd.length?(a.activeTexture(a["TEXTURE"+d]),a.bindTexture(a.TEXTURE_2D,c.kd[this.kd[d]].Ua)):(a.activeTexture(a["TEXTURE"+d]),a.bindTexture(a.TEXTURE_2D,c.Kl[0]));a.uniform1iv(b.Q8,[0,1,2,3,4,5,6,7])}a.uniform1i(b.Axa,this.kd.length)}},N:function(a,b){if((this.texturesAllLoaded||this.u8).call(this)&&this.a_vertexBuffer){this.DEPTH_TEST?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST);var c=this.drawMode;if(c&&0===c.indexOf("TRIANGLE")){var d=this.backOrFront;"both"==d?a.disable(a.CULL_FACE): (a.enable(a.CULL_FACE),a.cullFace("front"==d?a.BACK:a.FRONT))}this.W0(a,b);var d=this.oh,e=d.jm,f;for(f in e)if(e.hasOwnProperty(f)){var h=b["u_"+f],k=e[f].value;k.call&&(k=k.call(this,this));if(k||0===k){var l=e[f].type;if(0==l.indexOf("mat"))a["uniform"+this.j5[l]](h,!1,k);else a["uniform"+this.j5[l]](h,k)}}d=d.attributes;for(f in d)d.hasOwnProperty(f)&&(e=b["a_"+f],-1!==e&&((h=this[f+"Buffer"])?(a.enableVertexAttribArray(e),a.bindBuffer(a.ARRAY_BUFFER,h),a.vertexAttribPointer(e,h.size,a.FLOAT, !1,0,0)):a.disableVertexAttribArray(e)));this.Nk?(a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.Nk),a.drawElements(a[c],this.Nk.length,this.Nk.cn,0)):a.drawArrays(a[c],0,this.a_vertexBuffer.length);(this.afterRender||this.Md).call(this,a,b)}},Md:function(a,b){var c=this.oh.attributes,d;for(d in c)if(c.hasOwnProperty(d)){var e=b["a_"+d];-1!==e&&a.disableVertexAttribArray(e)}},oh:{jm:{},attributes:{a_vertex:{type:"vec3",value:function(){return this.da.Y}}},vn:"\\n\\t\\t\\tattribute vec3 a_vertex;\\n\\t\\t\\tuniform mat4 u_modelViewMatrix;\\n\\t\\t\\tuniform mat4 u_projectionMatrix;\\n\\t\\t\\tvoid main() {\\n\\t\\t\\tgl_Position = u_projectionMatrix * u_modelViewMatrix * vec4( a_vertex, 1.0 );\\n\\t\\t}", Wd:"void main() {\\n\\t\\t\\tgl_FragColor = vec4( 1.0, 1.0, 1.0, 1.0);\\n\\t\\t}"},Ch:function(a,b){var c=this.oh,d=c.attributes,c=c.jm,e;for(e in c)c.hasOwnProperty(e)&&(b["u_"+e]=a.getUniformLocation(b,e));for(e in d)d.hasOwnProperty(e)&&(b["a_"+e]=a.getAttribLocation(b,e));b.Axa=a.getUniformLocation(b,"u_textureNum");b.Q8=a.getUniformLocation(b,"u_textures")},b5:function(a,b,c){var d=!1;a[0]instanceof g.T&&(d=!0);for(var e=[],f=0;f<a.length;f+=1)e[f]=d?b.VI(a[f]):a[f],e[f]=e[f].x?[e[f].x,e[f].y]:[e[f][0], e[f][1]];!c&&2<a.length&&this.cb(a[a.length-1],a[0])&&e.pop();return e},cb:function(a,b){return a.cb?a.cb(b):a[0]===b[0]&&a[1]===b[1]}}); g.Wb.extend=function(a){var b=this.prototype.oh,c=a.shader||a.oh;if(c){c.jm=g.extend({},b.jm,c.uniforms||c.jm||{});c.attributes=g.extend({},b.attributes,c.attributes||c.attributes||{});var d=c.vertexShader||c.vn;c.vn=d?d:b.vn;d=c.fragmentShader||c.Wd;c.Wd=d?d:b.Wd;d=c.vertexIndices||c.mm;d||null===d||(c.mm=b.mm);a.shader&&!a.oh&&(a.oh=c,delete a.shader)}return g.aa.extend.call(this,a)}; g.B$=g.Wb.extend({r:function(){this.children=[]},add:function(a){a&&a.wD!==this&&(a.wD&&a.wD.remove(a),this.children.push(a),a.wD=this)},remove:function(a){a.wD===this&&(g.a.Tx(this.children,a),a.wD=null)},Lo:function(a,b,c){for(var d=[],e=0,f=this.children.length;e<f;e+=1){var h=this.children[e].Lo(a,b,c);h&&d.push(h)}return d.length?d:null},update:function(a,b){for(var c=0,d=this.children.length;c<d;c+=1)this.children[c].update(a,b)},N:function(a,b){for(var c=0,d=this.children.length;c<d;c+=1)this.children[c].N(a, b)}});g.Wb.count=0;g.Wb.Iqa={r:"initialize",update:"update",Lo:"raycast",Md:"afterRender",N:"render",U8:"updateBuffers",Ch:"getWebGLVariableLoaction",W0:"bindTextures",a9:"updateTextures",u8:"texturesAllLoaded"};g.Wb.Nb({scale:"scale",yv:"setScale",fz:"setRotate",Cs:"rotateX",Ds:"rotateY",Es:"rotateZ",reset:"reset"});g.Wb.ft=g.Wb.extend({r:function(a){this.CLASS_NAME=this.CLASS_NAME||"AMap.Object3D.Mesh";this.ph(arguments);this.type="mesh";this.drawMode=a&&a.mode?a.mode:"TRIANGLES";this.geometry=this.da=new g.Ee.ft;this.backOrFront=a&&a.backOrFront?a.backOrFront:"back"},Lo:function(a,b,c){var d=this.Zc;d||(d=c);d.Ue||(d.Ue=d.Ig());b=new g.Oa(d.Ue.mh(b));d=new g.Oa(d.Ue.mh(new g.nl(0,0,0,1)));b=b.sub(d).normalize();a.origin.copy(d);a.direction.copy(b);var e=this.da;if((d=e.Fl)&&!qd(a,d))return null;d=new g.Oa; b=e.Y;var e=e.Eg,f=new g.Oa,h=new g.Oa,k=new g.Oa,l=[],m=!0;"both"==this.backOrFront&&(m=!1);if(e.length)for(var n=0,p=e.length;n<p;n+=3){var q=3*e[n],r=3*e[n+1],s=3*e[n+2];f.set(b[q],b[q+1],b[q+2]);h.set(b[r],b[r+1],b[r+2]);k.set(b[s],b[s+1],b[s+2]);(q="front"==this.backOrFront?a.vy(f,h,k,m,d):a.vy(f,k,h,m,d))&&l.push({Od:q,MP:0,AD:d,index:n/3,object:this})}else for(n=0,p=b.length;n<p;n+=9)q=n,r=n+3,s=n+6,f.set(b[q],b[q+1],b[q+2]),h.set(b[r],b[r+1],b[r+2]),k.set(b[s],b[s+1],b[s+2]),(q="front"==this.backOrFront? a.vy(f,h,k,m,d):a.vy(f,k,h,m,d))&&l.push({Od:q,MP:0,AD:d,index:n/9,object:this});l.sort(function(a,b){return a.Od-b.Od});if(a=l[0])d=d.Lf(this.ls),a.AD=d.elements,a.Od=(new g.Oa(0,0,0)).Lf(c.Ig()).re(d);return a||null},oh:{jm:{},attributes:{a_color:{type:"vec4",value:function(){return this.da.Wa}},a_textureIndex:{type:"float",value:function(){return this.da.oz}},a_uv:{type:"vec2",value:function(){return this.da.lk}}},mm:function(){return this.da.Eg},vn:"attribute vec3 a_vertex;\\n\\t\\tattribute vec4 a_color;\\n\\t\\tattribute vec2 a_uv;\\n\\t\\tattribute float a_textureIndex;\\n\\t\\t\\n\\t\\tuniform mat4 u_modelViewMatrix;\\n\\t\\tuniform mat4 u_projectionMatrix;\\n\\n\\t\\tvarying vec4 v_color;\\n\\t\\tvarying vec2 v_uv;\\n\\t\\tvarying float v_textureIndex;\\n\\n\\t\\tvoid main(void) {\\n\\t\\t\\tv_color = a_color;\\n\\t\\t\\tv_uv = a_uv;\\n\\t\\t\\tv_textureIndex = a_textureIndex;\\n\\t\\t\\tvec4 pos = vec4(a_vertex, 1.0);\\n\\t\\t\\tgl_Position = u_projectionMatrix * u_modelViewMatrix * pos;\\n\\t\\t}\\n\\t", Wd:" precision mediump float;\\n\\t\\tvarying vec4 v_color;\\n\\t\\tvarying vec2 v_uv;\\n\\t\\tvarying float v_textureIndex;\\n\\t\\tuniform int u_textureNum;\\n\\t\\tuniform sampler2D u_textures[8];\\n\\t\\tvoid main(void) {\\n\\t\\t\\tif (u_textureNum == 0) {\\n\\t\\t\\t\\tgl_FragColor = v_color;\\n\\t\\t\\t} else {\\n\\t\\t\\t\\tvec4 smpColor;\\n\\t\\t\\t\\tfloat textureIndex;\\n\\t\\t\\t\\tif (u_textureNum == 1) {\\n\\t\\t\\t\\t\\ttextureIndex = 0.0;\\n\\t\\t\\t\\t} else {\\n\\t\\t\\t\\t\\ttextureIndex = v_textureIndex;\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\tvec2 uv = v_uv.xy;\\n\\t\\t\\t\\tif (textureIndex == 0.0) {\\n\\t\\t\\t\\t\\tsmpColor = texture2D(u_textures[0], uv);\\n\\t\\t\\t\\t} else if (textureIndex == 1.0) {\\n\\t\\t\\t\\t\\tsmpColor = texture2D(u_textures[1], uv);\\n\\t\\t\\t\\t} else if (textureIndex == 2.0) {\\n\\t\\t\\t\\t\\tsmpColor = texture2D(u_textures[2], uv);\\n\\t\\t\\t\\t} else if (textureIndex == 3.0) {\\n\\t\\t\\t\\t\\tsmpColor = texture2D(u_textures[3], uv);\\n\\t\\t\\t\\t} else if (textureIndex == 4.0) {\\n\\t\\t\\t\\t\\tsmpColor = texture2D(u_textures[4], uv);\\n\\t\\t\\t\\t} else if (textureIndex == 5.0) {\\n\\t\\t\\t\\t\\tsmpColor = texture2D(u_textures[5], uv);\\n\\t\\t\\t\\t} else if (textureIndex == 6.0) {\\n\\t\\t\\t\\t\\tsmpColor = texture2D(u_textures[6], uv);\\n\\t\\t\\t\\t} else if (textureIndex == 7.0) {\\n\\t\\t\\t\\t\\tsmpColor = texture2D(u_textures[7], uv);\\n\\t\\t\\t\\t} else {\\n\\t\\t\\t\\t\\tdiscard;\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\tif (smpColor.a == 0.0) {\\n\\t\\t\\t\\t\\tdiscard;\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\tgl_FragColor = smpColor;\\n\\t\\t\\t}\\t\\t\\n\\t\\t}\\n\\t"}});g.Wb.SE=g.Wb.ft.extend({r:function(){this.CLASS_NAME=this.CLASS_NAME||"AMap.Object3D.MeshAcceptLights";this.ph(arguments);this.type="lightmesh";this.da.vertexNormals=this.da.bg=[];this.directionLight=this.ambientLight=null},oh:{jm:{u_ambient:{type:"vec3",value:function(){if(this.e.AmbientLight)return this.e.AmbientLight.color}},u_light:{type:"vec3",value:function(){if(this.e.DirectionLight)return this.e.DirectionLight.color}},u_lightDirection:{type:"vec3",value:function(){var a=this.e;if(this.e.DirectionLight)return a.map.J.X4.elements}}, u_normalMatrix:{type:"mat3",value:function(){return this.Fsa.elements}}},attributes:{a_normal:{type:"vec3",value:function(){return this.da.bg}}},vn:"\\n\\t\\t\\tattribute vec3 a_vertex;\\n\\t\\t\\tattribute vec4 a_color;\\n\\t\\t\\tattribute vec3 a_normal;\\n\\t\\t\\tattribute vec2 a_uv;\\n\\t\\t\\tattribute float a_textureIndex;\\n\\t\\t\\t\\n\\t\\t\\tuniform mat4 u_modelViewMatrix;\\n\\t\\t\\tuniform mat4 u_projectionMatrix;\\n\\t\\t\\tuniform mediump int u_textureNum;\\n\\t\\t\\tuniform vec3 u_ambient;\\n\\t\\t\\tuniform vec3 u_light;\\n\\t\\t\\tuniform vec3 u_lightDirection;\\n\\t\\t\\tuniform mat3 u_normalMatrix;\\n\\t\\t\\tvarying vec4 v_color;\\n\\t\\t\\tvarying vec2 v_uv;\\n\\t\\t\\tvarying float v_textureIndex;\\n\\n\\t\\t\\tvoid main(void) {\\n\\t\\t\\t\\tif(length(a_normal)!=0.0){\\n\\t\\t\\t\\t\\tvec3 normal = normalize(u_normalMatrix * a_normal);\\n\\t\\t\\t\\t\\tfloat nDotL = max(dot(u_lightDirection, -normal), 0.0);\\n\\t\\t\\t\\t\\tvec3 diffuse = u_light*nDotL;\\n\\t\\t\\t\\t\\tvec3 ll = (u_ambient+diffuse);\\n\\t\\t\\t\\t\\tif(u_textureNum==0){//\\u6ca1\\u6709\\u7eb9\\u7406\\uff0c\\u5728\\u9876\\u70b9\\u7740\\u8272\\u5668\\u8fdb\\u884c\\u5149\\u7167\\u53e0\\u52a0\\n\\t\\t\\t\\t\\t\\tv_color = vec4(ll*a_color.rgb,a_color.a);\\n\\t\\t\\t\\t\\t}else{\\n\\t\\t\\t\\t\\t\\tv_color = vec4(ll,a_color.a);//\\u8bb0\\u5f55\\u5149\\u7167\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t}else{\\n\\t\\t\\t\\t\\tv_color = vec4(1.0,0.0,0.0,1.0);\\n\\t\\t\\t\\t\\t// v_color = a_color;\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\tv_uv = a_uv;\\n\\t\\t\\t\\tv_textureIndex = a_textureIndex;\\n\\t\\t\\t\\tvec4 pos = vec4(a_vertex, 1.0);\\n\\t\\t\\t\\tgl_Position = u_projectionMatrix * u_modelViewMatrix * pos;\\n\\t\\t\\t}\\n\\t\\t", Wd:" precision mediump float;\\n\\t\\tvarying vec4 v_color;\\n\\t\\tvarying vec2 v_uv;\\n\\t\\tvarying float v_textureIndex;\\n\\t\\tuniform int u_textureNum;\\n\\t\\tuniform sampler2D u_textures[8];\\n\\t\\tvoid main(void) {\\n\\t\\t\\tif (u_textureNum == 0) {\\n\\t\\t\\t\\tgl_FragColor = v_color;\\n\\t\\t\\t} else {\\n\\t\\t\\t\\tvec4 smpColor;\\n\\t\\t\\t\\tfloat textureIndex;\\n\\t\\t\\t\\tif (u_textureNum == 1) {\\n\\t\\t\\t\\t\\ttextureIndex = 0.0;\\n\\t\\t\\t\\t} else {\\n\\t\\t\\t\\t\\ttextureIndex = v_textureIndex;\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\tvec2 uv = v_uv.xy;\\n\\t\\t\\t\\tif (textureIndex == 0.0) {\\n\\t\\t\\t\\t\\tsmpColor = texture2D(u_textures[0], uv);\\n\\t\\t\\t\\t} else if (textureIndex == 1.0) {\\n\\t\\t\\t\\t\\tsmpColor = texture2D(u_textures[1], uv);\\n\\t\\t\\t\\t} else if (textureIndex == 2.0) {\\n\\t\\t\\t\\t\\tsmpColor = texture2D(u_textures[2], uv);\\n\\t\\t\\t\\t} else if (textureIndex == 3.0) {\\n\\t\\t\\t\\t\\tsmpColor = texture2D(u_textures[3], uv);\\n\\t\\t\\t\\t} else if (textureIndex == 4.0) {\\n\\t\\t\\t\\t\\tsmpColor = texture2D(u_textures[4], uv);\\n\\t\\t\\t\\t} else if (textureIndex == 5.0) {\\n\\t\\t\\t\\t\\tsmpColor = texture2D(u_textures[5], uv);\\n\\t\\t\\t\\t} else if (textureIndex == 6.0) {\\n\\t\\t\\t\\t\\tsmpColor = texture2D(u_textures[6], uv);\\n\\t\\t\\t\\t} else if (textureIndex == 7.0) {\\n\\t\\t\\t\\t\\tsmpColor = texture2D(u_textures[7], uv);\\n\\t\\t\\t\\t} else {\\n\\t\\t\\t\\t\\tdiscard;\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\tif (smpColor.a == 0.0) {\\n\\t\\t\\t\\t\\tdiscard;\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\tgl_FragColor = vec4(v_color.rgb*smpColor.rgb,v_color.a);;\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\t"}, Vf:function(a){var b=new g.Wb.SE;b.Wv={};b.transparent=!0;b.DEPTH_TEST=!1;for(var c=b.da.Wa,d=b.da.Y,e=b.da.Eg,f=b.da.lk,h=b.da.bg,k=0,l=a.length;k<l;k+=1){var m=a[k],n=m.da;g.a.Vf(c,n.Wa);g.a.Vf(f,n.lk);g.a.Vf(h,n.bg);for(var p=d.length/3,q=0,r=n.Eg.length;q<r;q+=1)e.push(n.Eg[q]+p);g.a.Vf(d,n.Y);b.Wv[m.zC]||(b.Wv[m.zC]=[]);b.Wv[m.zC].push([p,d.length/3])}return b}});g.Wb.kL=g.Wb.SE.extend({r:function(a){this.CLASS_NAME=this.CLASS_NAME||"AMap.Object3D.Prism";this.ph(arguments);this.type="prism";this.B=a;this.lr=this.attributeNeedUpdate=!0},TB:function(a){if(this.lr||this.attributeNeedUpdate)this.Pq(this.B,a),this.lr=this.attributeNeedUpdate=!1},mp:function(a,b){var c=a,d=g.a;if("string"===typeof c||d.Uj(c[0],"number"))c=[c];d.Rb(c,function(a,b){c[b]=d.Tm(a)});if(c.length<b)for(var e=c[c.length-1],f=0,h=b-c.length;f<h;f++)c.push(e);return c},Pq:function(a,b){var c= a.path;if(c[0]instanceof g.T||c[0]instanceof g.H)c=[c];for(var d=a.height||0,e=this.mp(a.color,c.length),f=null,f=a.color2?this.mp(a.color2,c.length):e,h=0;h<c.length;h+=1)c[h]=this.b5(c[h],b),c[h]=g.zj.makesureAntiClockwise(c[h]);var k=c[0];k.uh=0;for(var l=[],m=[],h=1;h<c.length;h+=1)c[h].uh=h,!0!==a.uDa&&g.zj.isRingInRing(c[h],k)?l.push(c[h]):m.push(c[h]);c=this.da;c.Eg.length&&(c.Eg=[],c.Wa=[],c.bg=[],c.Y=[]);c.UH=c.faceSet=[];var n=0,p=0;if(d){var q=k.length;this.mJ&&(q-=1);for(var r=4*q,h=0;h< q;h+=1){var s=k[h],u=k[(h+1)%q];c.Y.push(s[0],s[1],0);c.Y.push(s[0],s[1],-d);c.Y.push(u[0],u[1],0);c.Y.push(u[0],u[1],-d);var v=new g.Oa(0,0,-d),s=new g.Oa(u[0]-s[0],u[1]-s[1],0),s=(new g.Oa).Px(s,v).normalize().elements;c.bg.push(s[0],s[1],s[2]);c.bg.push(s[0],s[1],s[2]);c.bg.push(s[0],s[1],s[2]);c.bg.push(s[0],s[1],s[2]);var x=f[k.uh];c.Wa.push.apply(c.Wa,x);c.Wa.push.apply(c.Wa,x);c.Wa.push.apply(c.Wa,x);c.Wa.push.apply(c.Wa,x);var s=4*h,v=s+1,u=(s+2)%r,t=(s+3)%r;c.Eg.push(v,s,u);c.Eg.push(v,u, t);this.lB(c,k.uh,[n++,n++])}p+=r;for(h=0;h<l.length;h+=1){var w=l[h],q=w.length;this.mJ&&(q-=1);r=4*q;for(x=0;x<q;x+=1)s=w[x],u=w[(x+1)%q],c.Y.push(s[0],s[1],0),c.Y.push(s[0],s[1],-d),c.Y.push(u[0],u[1],0),c.Y.push(u[0],u[1],-d),v=new g.Oa(0,0,-d),s=new g.Oa(u[0]-s[0],u[1]-s[1],0),s=(new g.Oa).Px(v,s).normalize().elements,c.bg.push(-s[0],-s[1],-s[2]),c.bg.push(-s[0],-s[1],-s[2]),c.bg.push(-s[0],-s[1],-s[2]),c.bg.push(-s[0],-s[1],-s[2]),s=f[w.uh],c.Wa.push.apply(c.Wa,s),c.Wa.push.apply(c.Wa,s),c.Wa.push.apply(c.Wa, s),c.Wa.push.apply(c.Wa,s),s=4*x,v=s+1,u=(s+2)%r,t=(s+3)%r,c.Eg.push(p+v,p+u,p+s),c.Eg.push(p+v,p+t,p+u),this.lB(c,[n++,n++]);p+=r}}if(!this.mJ){h=r=0;for(q=k.length;h<q;h+=1)s=k[h],c.Y.push(s[0],s[1],-d),c.bg.push(0,0,-1),c.Wa.push.apply(c.Wa,e[k.uh]);r+=k.length;for(h=0;h<l.length;h+=1){w=l[h];x=0;for(q=w.length;x<q;x+=1)s=w[x],c.Y.push(s[0],s[1],-d),c.bg.push(0,0,-1),c.Wa.push.apply(c.Wa,e[w.uh]);r+=w.length}q=g.Bn.Lh(k,l);for(h=0;h<q.length;h+=3)c.Eg.push(q[h]+p,q[h+2]+p,q[h+1]+p),this.lB(c,k.uh, [n++]);p+=r}for(h=0;h<m.length;h+=1){k=m[h];if(d){r=4*k.length;x=0;for(q=k.length;x<q;x+=1)s=k[x],u=k[(x+1)%q],c.Y.push(s[0],s[1],0),c.Y.push(s[0],s[1],-d),c.Y.push(u[0],u[1],0),c.Y.push(u[0],u[1],-d),v=new g.Oa(0,0,-d),s=new g.Oa(u[0]-s[0],u[1]-s[1],0),s=(new g.Oa).Px(s,v).normalize().elements,c.bg.push(s[0],s[1],s[2]),c.bg.push(s[0],s[1],s[2]),c.bg.push(s[0],s[1],s[2]),c.bg.push(s[0],s[1],s[2]),l=f[k.uh],c.Wa.push.apply(c.Wa,l),c.Wa.push.apply(c.Wa,l),c.Wa.push.apply(c.Wa,l),c.Wa.push.apply(c.Wa, l),s=4*x,v=s+1,u=(s+2)%r,t=(s+3)%r,c.Eg.push(p+v,p+s,p+u),c.Eg.push(p+v,p+u,p+t),this.lB(c,k.uh,[n++,n++]);p+=r}if(!this.mJ){x=0;for(q=k.length;x<q;x+=1)s=k[x],c.Y.push(s[0],s[1],-d),c.bg.push(0,0,-1),c.Wa.push.apply(c.Wa,e[k.uh]);q=g.Bn.Lh(k);for(x=0;x<q.length;x+=3)c.Eg.push(q[x]+p,q[x+2]+p,q[x+1]+p),this.lB(c,k.uh,[n++]);p+=k.length}}this.needUpdate=!0},setOptions:function(a){this.B=g.extend(this.B,a);this.lr=!0;this.reDraw()},lB:function(a,b,c){a.UH[b]||(a.UH[b]={});g.a.Rb(c,function(c){a.UH[b][c]= 1})}});g.Wb.laa=g.Wb.kL.extend({r:function(){this.CLASS_NAME=this.CLASS_NAME||"AMap.Object3D.Wall";this.ph(arguments);this.mJ=!0;this.backOrFront="front"}});g.Wb.Vo=g.Wb.extend({r:function(){this.CLASS_NAME=this.CLASS_NAME||"AMap.Object3D.Line";this.ph(arguments);this.type="line";this.drawMode="LINES";this.geometry=this.da=new g.Ee.Vo},Lo:function(a,b,c,d){var e=this.Zc;e||(e=c);e.Ue||(e.Ue=e.Ig());b=new g.Oa(e.Ue.mh(b));e=new g.Oa(e.Ue.mh(new g.nl(0,0,0,1)));b=b.sub(e).normalize();a.origin.copy(e);a.direction.copy(b);var f=this.da;if((e=f.Fl)&&!qd(a,e))return null;var h=Infinity,e=new g.Oa;b=new g.Oa;var k=new g.Oa,l=new g.Oa,m;if(f.Kh.length)for(var n= 0,p=f.Kh.length;n<p;n+=2){var q=new g.Oa,r=new g.Oa,s=3*f.Kh[n],u=3*f.Kh[n+1];k.set(f.Y[s],f.Y[s+1],f.Y[s+2]);l.set(f.Y[u],f.Y[u+1],f.Y[u+2]);s=a.a2(k,l,q,r);s<h&&(h=s,e.copy(q),b.copy(r),m=n/2)}else for(n=0,p=f.Y.length;n<p;n+=6)q=new g.Oa,r=new g.Oa,s=n,u=n+3,k.set(f.Y[s],f.Y[s+1],f.Y[s+2]),l.set(f.Y[u],f.Y[u+1],f.Y[u+2]),s=a.a2(k,l,q,r),s<h&&(h=s,e.copy(q),b.copy(r),m=n/6);d*=2;return h<d*d?(b=b.Lf(this.ls),a=b.elements,c=(new g.Oa(0,0,0)).Lf(c.Ig()).re(b),e=e.Lf(this.ls),d=e.re(b),{Od:c,MP:d, AD:a,index:m,object:this}):null},oh:{jm:{},attributes:{a_color:{type:"vec4",value:function(){return this.da.Wa}},a_textureIndex:{type:"float",value:function(){return this.da.oz}},a_uv:{type:"vec2",value:function(){return this.da.lk}}},mm:function(){return this.da.Kh},vn:"attribute vec3 a_vertex;\\n\\t\\tattribute vec4 a_color;\\n\\t\\tattribute vec2 a_uv;\\n\\t\\tattribute float a_textureIndex;\\n\\t\\tuniform mat4 u_modelViewMatrix;\\n\\t\\tuniform mat4 u_projectionMatrix;\\n\\n\\t\\tvarying vec4 v_color;\\n\\t\\tvarying vec2 v_uv;\\n\\t\\tvarying float v_textureIndex;\\n\\n\\t\\tvoid main(void) {\\n\\t\\t\\tv_color = a_color;\\n\\t\\t\\tv_uv = a_uv;\\n\\t\\t\\tv_textureIndex = a_textureIndex;\\n\\t\\t\\tvec4 pos = vec4(a_vertex, 1.0);\\n\\t\\t\\tgl_Position = u_projectionMatrix * u_modelViewMatrix * pos;\\n\\t\\t}\\n\\t\\t", Wd:" precision mediump float;\\n\\t\\tvarying vec4 v_color;\\n\\t\\tvarying vec2 v_uv;\\n\\t\\tvarying float v_textureIndex;\\n\\t\\tuniform int u_textureNum;\\n\\t\\tuniform sampler2D u_textures[8];\\n\\t\\tvoid main(void) {\\n\\t\\t\\n\\t\\t\\tif (u_textureNum == 0) {\\n\\t\\t\\t\\tgl_FragColor = v_color;\\n\\t\\t\\t} else {\\n\\t\\t\\t\\tvec4 smpColor;\\n\\t\\t\\t\\tfloat textureIndex;\\n\\t\\t\\t\\tif (u_textureNum == 1) {\\n\\t\\t\\t\\t\\ttextureIndex = 0.0;\\n\\t\\t\\t\\t} else {\\n\\t\\t\\t\\t\\ttextureIndex = v_textureIndex;\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\tvec2 uv = v_uv.xy;\\n\\t\\t\\t\\tif (textureIndex == 0.0) {\\n\\t\\t\\t\\t\\tsmpColor = texture2D(u_textures[0], uv);\\n\\t\\t\\t\\t} else if (textureIndex == 1.0) {\\n\\t\\t\\t\\t\\tsmpColor = texture2D(u_textures[1], uv);\\n\\t\\t\\t\\t} else if (textureIndex == 2.0) {\\n\\t\\t\\t\\t\\tsmpColor = texture2D(u_textures[2], uv);\\n\\t\\t\\t\\t} else if (textureIndex == 3.0) {\\n\\t\\t\\t\\t\\tsmpColor = texture2D(u_textures[3], uv);\\n\\t\\t\\t\\t} else if (textureIndex == 4.0) {\\n\\t\\t\\t\\t\\tsmpColor = texture2D(u_textures[4], uv);\\n\\t\\t\\t\\t} else if (textureIndex == 5.0) {\\n\\t\\t\\t\\t\\tsmpColor = texture2D(u_textures[5], uv);\\n\\t\\t\\t\\t} else if (textureIndex == 6.0) {\\n\\t\\t\\t\\t\\tsmpColor = texture2D(u_textures[6], uv);\\n\\t\\t\\t\\t} else if (textureIndex == 7.0) {\\n\\t\\t\\t\\t\\tsmpColor = texture2D(u_textures[7], uv);\\n\\t\\t\\t\\t} else {\\n\\t\\t\\t\\t\\tdiscard;\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\tif (smpColor.a == 0.0) {\\n\\t\\t\\t\\t\\tdiscard;\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\tgl_FragColor = smpColor;\\n\\t\\t\\t}\\n\\t\\t}\\n\\t"}});g.Wb.MV=g.Wb.Vo.extend({r:function(a){this.CLASS_NAME=this.CLASS_NAME||"AMap.Object3D.ThinLine";this.ph(arguments);this.da.distanceToOrigin=this.da.Er=[];this.type="ThinLine";this.B=a;this.gh=new g.Ec([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);this.gh.Sx={};this.gh.qg=0;this.bh=this.transparent=this.DEPTH_TEST=!1;this.lr=this.attributeNeedUpdate=!0},TB:function(a){if(this.lr||this.attributeNeedUpdate)this.Pq(this.B,a),this.lr=this.attributeNeedUpdate=!1},Pq:function(a,b){var c=this.da,d=a.path,e=-a.altitude|| 0,f=g.a.Tm(a.color),d=this.b5(d,b,!0),h=a.dashArray,k=-1;h&&(this.gh.elements[0]=h[0],this.gh.elements[1]=h[1],this.gh.elements[2]=h[2]||0,k=this.gh.elements[3]=0);this.Uma=k;for(var h=0,l,m,n,p,q=0,r=d.length;q<r;q+=1)n=d[q][0],p=d[q][1],c.Y.push(n,p,e),c.Wa.push(f[0],f[1],f[2],f[3]),0<q?(c.Kh.push(q-1,q),h+=Math.sqrt((l-n)*(l-n)+(m-p)*(m-p)),c.Er.push(h,k)):c.Er.push(0,k),l=n,m=p;this.needUpdate=!0},oh:{jm:{u_scale:{type:"float",value:function(){return this.Pj()}},u_dashArrayMatrix:{type:"mat4", value:function(){return this.gh.elements}}},attributes:{a_distanceToOrigin:{type:"vec2",value:function(){return this.da.Er}}},vn:"\\n        attribute vec3 a_vertex;\\n        attribute vec4 a_color;\\n        attribute vec2 a_distanceToOrigin;\\n\\n        uniform mat4 u_modelViewMatrix;\\n        uniform mat4 u_projectionMatrix;\\n\\n        varying vec4 v_color;\\n        varying vec2 v_dis2o;\\n\\n        void main() {\\n            v_color = a_color;\\t\\n            v_dis2o = a_distanceToOrigin;\\n            vec4 pos = vec4(a_vertex, 1.0);\\n            gl_Position = u_projectionMatrix * u_modelViewMatrix * pos;\\n        }\\n        ", Wd:"\\n        precision mediump float;\\n\\n        varying vec4 v_color;\\n        varying vec2 v_dis2o;\\n        uniform mat4 u_dashArrayMatrix;\\n        uniform float u_scale;\\n        void main() {\\n                float dis = v_dis2o[0];\\n                int i = int(floor(v_dis2o[1]));\\n                float d0=0.0,d1=0.0,d2=0.0;\\n                if(i==0){\\n                    d0 = u_dashArrayMatrix[0].x;\\n                    d1 = u_dashArrayMatrix[0].y;\\n                    d2 = u_dashArrayMatrix[0].z;\\n                }else if(i==1){\\n                    d0 = u_dashArrayMatrix[1].x;\\n                    d1 = u_dashArrayMatrix[1].y;\\n                    d2 = u_dashArrayMatrix[1].z;\\n                }else if(i==2){\\n                    d0 = u_dashArrayMatrix[2].x;\\n                    d1 = u_dashArrayMatrix[2].y;\\n                    d2 = u_dashArrayMatrix[2].z;\\n                }else if(i==3){\\n                    d0 = u_dashArrayMatrix[3].x;\\n                    d1 = u_dashArrayMatrix[3].y;\\n                    d2 = u_dashArrayMatrix[3].z;\\n                }\\n                if(d0!=0.0){\\n                    float all = d0+d1+d2;\\n                    float m = mod(dis*2.0/u_scale,all);\\n                    if(d2==0.0){\\n                        if(m<d0)discard;\\n                    }else{\\n                        bool aa =  mod(dis/u_scale/all,2.0)>1.0;\\n                        d2=d1+d0;\\n                        if(aa){\\n                            // discard;\\n                            if(m>=d0 && m<d2)discard;\\n                        }else{\\n                            if(m<d0 || m>=d2)discard;\\n                        }\\n                    }\\n                    \\n                }\\n                gl_FragColor = v_color;\\t\\n                // gl_FragColor = vec4(0.8,0.8,0.8,1);\\t\\n        }\\n        "}, Pj:function(){return Math.pow(2,20-this.o.get("map").get("zoom"))},Vf:function(a){var b=new g.Wb.MV;b.transparent=a[0].transparent;b.Tma=0;b.Wv={};for(var c=b.da.Wa,d=b.da.Y,e=b.da.Kh,f=b.da.Er,h=b.da.lk,k=0,l=a.length;k<l;k+=1){b.rDa=!0;var m=a[k],n=m.da;g.a.Vf(c,n.Wa);g.a.Vf(h,n.lk);if(-1!==m.Uma){2<b.Tma&&console.log("too much diff dash offset");var p=m.B.dashArray.join("_"),q;p in b.gh.Sx?q=b.gh.Sx[p]:(q=b.gh.qg,b.gh.Sx[p]=q,p=b.gh.elements,p[4*q]=m.gh.elements[0],p[4*q+1]=m.gh.elements[1],p[4* q+2]=m.gh.elements[2]||0,b.gh.qg+=1);for(var p=0,r=n.Er.length;p<r;p+=2)f.push(n.Er[p],q)}else g.a.Vf(f,n.Er);q=d.length/3;p=0;for(r=n.Kh.length;p<r;p+=1)e.push(n.Kh[p]+q);g.a.Vf(d,n.Y);b.Wv[m.zC]||(b.Wv[m.zC]=[]);b.Wv[m.zC].push([q,d.length/3])}return b}});g.Wb.Aw=g.Wb.extend({r:function(a){this.CLASS_NAME=this.CLASS_NAME||"AMap.Object3D.WideLine";this.ph(arguments);this.type="WideLine";this.drawMode="TRIANGLES";this.geometry=this.da=new g.Ee.Aw;g.a.Uj(a,"object")||(a={});this.width=parseFloat(a.width)||2;this.backOrFront="front";this.Vi=20},update:function(){(this.lS||this.needUpdate)&&!1!==this.jna&&this.da.f6();g.Wb.Aw.Sc.update.apply(this,arguments)},Pj:function(){return Math.pow(2,this.o.get("map").get("zoom")-this.Vi)},oh:{jm:{u_width:{type:"float", value:function(){return this.width/this.Pj()/2}}},attributes:{a_vertex:{type:"vec3",value:function(){return this.da.Vv}},a_dir:{type:"vec2",value:function(){return this.da.Ux}},a_color:{type:"vec4",value:function(){return this.da.Wa}}},mm:function(){return this.da.mm},vn:"\\n      attribute vec3 a_vertex;\\n      attribute vec2 a_dir;\\n      attribute vec4 a_color;\\n\\n      uniform float u_width;\\n      uniform mat4 u_modelViewMatrix;\\n      uniform mat4 u_projectionMatrix;\\n\\n      varying vec4 v_color;\\n\\n      void main() {\\n        v_color = a_color;\\t\\n        vec4 pos = vec4(a_vertex, 1.0);\\n        float x = a_dir.x;\\n        float y = a_dir.y;\\n        float dis = sqrt(x*x+y*y);\\n        if(dis>4.0){\\n            x = x/dis*4.0;\\n            y = y/dis*4.0;\\n        }\\n        pos.x = pos.x + u_width * x;\\n        pos.y = pos.y + u_width * y;\\n\\n        gl_Position = u_projectionMatrix * u_modelViewMatrix * pos;\\n      }\\n    ", Wd:"\\n      precision mediump float;\\n\\n      varying vec4 v_color;\\n\\n      void main() {\\n        gl_FragColor = v_color;\\t\\t\\n      }\\n    "},Vf:function(a){for(var b=new g.Wb.Aw,c=b.da.Wa,d=b.da.mm,e=b.da.lk,f=b.da.Vv||[],h=b.da.Ux||[],k=0,l=a.length;k<l;k+=1){var m=a[k],n=m.da;(m.lS||m.needUpdate)&&n.f6();c.push.apply(c,n.Wa);for(var m=f.length/3,p=0,q=n.mm.length;p<q;p+=1)d.push(n.mm[p]+m);e.push.apply(e,n.lk);f.push.apply(f,n.Vv);h.push.apply(h,n.Ux)}b.da.Vv=f;b.da.Ux=h;b.jna=!1;b.width=this.width; return b}});g.Wb.Xz=g.Wb.extend({r:function(){this.CLASS_NAME=this.CLASS_NAME||"AMap.Object3D.Points";this.ph(arguments);this.type="points";this.drawMode="POINTS";this.DEPTH_TEST=!1;this.geometry=this.da=new g.Ee.Xz;this.borderColor=null;this.borderWeight=0},Jqa:function(a,b,c,d){var e=this.da;a=b.view.qya(a);b=e.KS[d];var f=4*d,h=0,k=0,l=d=1;e.Vy.length&&(k=e.Vy[f],h=e.Vy[f+1],d=e.Vy[f+2],l=e.Vy[f+3]);e=a.add((new g.H(k-0.5,h-0.5)).Gd(b));a=a.add((new g.H(d-0.5,l-0.5)).Gd(b));if(c.x>=e.x&&c.x<=a.x&&c.y>=e.y&& c.y<=a.y)return!0},Lo:function(a,b,c,d,e){var f=this.Zc;f||(f=c);f.Ue||(f.Ue=f.Ig());b=new g.Oa(f.Ue.mh(b));f=new g.Oa(f.Ue.mh(new g.nl(0,0,0,1)));b=b.sub(f).normalize();a.origin.copy(f);a.direction.copy(b);var h=this.da,f=h.Y,k=Infinity;b=new g.Oa;for(var l,m=new g.Oa,n=this.o.o.e.D,p=0,q=f.length;p<q;p+=3){m.set(f[p],f[p+1],f[p+2]);var r=new g.Oa,s=a.GH(m,r);if(!(s>h.KS[p]/2*1.414*d)&&this.Jqa(m,n,e,p/3)){var u=a.origin.re(r);u<k&&(b.copy(r),l=p/3,k=u)}}return void 0!==l?(b=b.Lf(this.ls),a=b.elements, u=(new g.Oa(0,0,0)).Lf(c.Ig()).re(b),m.set(f[3*l],f[3*l+1],f[3*l+2]),s=m.Lf(this.ls).re(b),{Od:u,MP:s,AD:a,index:l,object:this}):null},oh:{jm:{u_hasPointArea:{type:"int",value:function(){return this.a_areaBuffer?1:0}},u_borderWeight:{type:"float",value:function(){return this.borderWeight}},u_borderColor:{type:"vec4",value:function(){return this.borderColor}},u_retinaRatio:{type:"float",value:function(){return this.e.map.J.Kc}}},attributes:{a_color:{type:"vec4",value:function(){return this.da.Wa}}, a_textureIndex:{type:"float",value:function(){return this.da.oz}},a_uv:{type:"vec4",value:function(){return this.da.lk}},a_size:{type:"float",value:function(){return this.da.KS}},a_area:{type:"vec4",value:function(){return this.da.Vy}}},vn:"attribute vec3 a_vertex;\\n\\t\\tattribute vec4 a_color;\\n\\t\\tattribute vec4 a_uv;\\n\\t\\tattribute float a_size;\\n\\t\\tattribute float a_textureIndex;\\n\\t\\tattribute vec4 a_area;\\n\\t\\tuniform mat4 u_modelViewMatrix;\\n        uniform mat4 u_projectionMatrix;\\n        uniform float u_retinaRatio;\\n\\t\\tuniform mediump float u_borderWeight;\\n\\t\\tvarying vec4 v_color;\\n\\t\\tvarying vec4 v_uv;\\n\\t\\tvarying float v_textureIndex;\\n\\t\\tvarying float v_borderFactor;\\n\\t\\tvarying vec4 v_area;\\n\\n\\t\\tvoid main(void) {\\n\\t\\t\\tv_color = a_color;\\n\\t\\t\\tv_uv = a_uv;\\n\\t\\t\\tv_area = a_area;\\n\\t\\t\\tv_textureIndex = a_textureIndex;\\n\\t\\t\\tvec4 pos = vec4(a_vertex, 1.0);\\n\\t\\t\\tgl_Position = u_projectionMatrix * u_modelViewMatrix * pos;\\n\\t\\t\\tgl_PointSize = a_size*u_retinaRatio;\\n\\t\\t\\tv_borderFactor = u_borderWeight/a_size;\\n\\t\\t}\\n\\t\\t", Wd:" precision mediump float;\\n\\t\\tvarying vec4 v_color;\\n\\t\\tvarying vec4 v_uv;\\n\\t\\tvarying float v_textureIndex;\\n\\t\\tvarying vec4 v_area;\\n\\t\\tvarying float v_borderFactor;\\n\\t\\tuniform vec4 u_borderColor;\\n\\t\\tuniform int u_hasPointArea;\\n\\t\\tuniform int u_textureNum;\\n\\t\\tuniform float u_borderWeight;\\n\\t\\tuniform sampler2D u_textures[8];\\n\\t\\tvoid main(void) {\\n\\t\\t\\tfloat minX = 0.0;\\n\\t\\t\\tfloat maxX = 1.0;\\n\\t\\t\\tfloat minY = 0.0;\\n\\t\\t\\tfloat maxY = 1.0;\\n\\n\\t\\t\\tif (u_hasPointArea == 1) {\\n\\t\\t\\t\\tminX = v_area.x;\\n\\t\\t\\t\\tmaxX = v_area.z;\\n\\t\\t\\t\\tminY = v_area.y;\\n\\t\\t\\t\\tmaxY = v_area.w;\\n\\t\\t\\t\\tif (gl_PointCoord.x < minX || gl_PointCoord.x > maxX || gl_PointCoord.y <minY || gl_PointCoord.y > maxY) {\\n\\t\\t\\t\\t\\tdiscard;\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\t\\n\\t\\t\\tif (u_borderWeight!=0.0&&(gl_PointCoord.x <= minX + v_borderFactor || gl_PointCoord.x >= maxX - v_borderFactor || gl_PointCoord.y <= minY + v_borderFactor || gl_PointCoord.y >= maxY - v_borderFactor)) {\\n\\t\\t\\t\\t\\tgl_FragColor = u_borderColor;\\n\\t\\t\\t}else{\\n\\t\\t\\t\\tif (u_textureNum == 0) {\\n\\t\\t\\t\\t\\tgl_FragColor = v_color;\\n\\t\\t\\t\\t} else {\\n\\t\\t\\t\\t\\tvec4 smpColor;\\n\\t\\t\\t\\t\\tfloat textureIndex;\\n\\t\\t\\t\\t\\tif (u_textureNum == 1) {\\n\\t\\t\\t\\t\\t\\ttextureIndex = 0.0;\\n\\t\\t\\t\\t\\t} else {\\n\\t\\t\\t\\t\\t\\ttextureIndex = v_textureIndex;\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\tvec2 uv = v_uv.xy;\\n\\t\\t\\t\\t\\tfloat x, y;\\n\\t\\t\\t\\t\\tif (u_hasPointArea == 0) {\\n\\t\\t\\t\\t\\t\\tx = gl_PointCoord.x;\\n\\t\\t\\t\\t\\t\\ty = gl_PointCoord.y;\\n\\t\\t\\t\\t\\t} else {\\n\\t\\t\\t\\t\\t\\tx = (gl_PointCoord.x - v_area.x) / (v_area.z - v_area.x);\\n\\t\\t\\t\\t\\t\\ty = (gl_PointCoord.y - v_area.y) / (v_area.w - v_area.y);\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\tuv = vec2(x * (v_uv.z - v_uv.x) + v_uv.x, y * (v_uv.w - v_uv.y) + v_uv.y);\\n\\t\\t\\t\\t\\t\\n\\t\\t\\t\\t\\tif (textureIndex == 0.0) {\\n\\t\\t\\t\\t\\t\\tsmpColor = texture2D(u_textures[0], uv);\\n\\t\\t\\t\\t\\t} else if (textureIndex == 1.0) {\\t\\t\\t\\t\\t\\t\\n\\t\\t\\t\\t\\t\\tsmpColor = texture2D(u_textures[1], uv);\\n\\t\\t\\t\\t\\t} else if (textureIndex == 2.0) {\\n\\t\\t\\t\\t\\t\\tsmpColor = texture2D(u_textures[2], uv);\\n\\t\\t\\t\\t\\t} else if (textureIndex == 3.0) {\\n\\t\\t\\t\\t\\t\\tsmpColor = texture2D(u_textures[3], uv);\\n\\t\\t\\t\\t\\t} else if (textureIndex == 4.0) {\\n\\t\\t\\t\\t\\t\\tsmpColor = texture2D(u_textures[4], uv);\\n\\t\\t\\t\\t\\t} else if (textureIndex == 5.0) {\\n\\t\\t\\t\\t\\t\\tsmpColor = texture2D(u_textures[5], uv);\\n\\t\\t\\t\\t\\t} else if (textureIndex == 6.0) {\\n\\t\\t\\t\\t\\t\\tsmpColor = texture2D(u_textures[6], uv);\\n\\t\\t\\t\\t\\t} else if (textureIndex == 7.0) {\\n\\t\\t\\t\\t\\t\\tsmpColor = texture2D(u_textures[7], uv);\\n\\t\\t\\t\\t\\t} else {\\n\\t\\t\\t\\t\\t\\tsmpColor = vec4(1, 0, 0, 1);\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\tif (smpColor.a == 0.0) {\\n\\t\\t\\t\\t\\t\\tdiscard;\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\tgl_FragColor = smpColor;\\n\\t\\t\\t\\t}\\t\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\t"}});g.Wb.M$=g.Wb.Xz.extend({r:function(){this.CLASS_NAME=this.CLASS_NAME||"AMap.Object3D.RoundPoints";this.ph(arguments);this.type="roundpoints";this.merge=!1},oh:{jm:{u_merge:{type:"int",value:function(){return this.merge}}},attributes:{},vn:"attribute vec3 a_vertex;\\n\\t\\tattribute vec4 a_color;\\n\\t\\tattribute vec4 a_uv;\\n        attribute float a_size;\\n        uniform float u_retinaRatio;\\n\\t\\tattribute float a_textureIndex;\\n\\t\\tuniform mat4 u_modelViewMatrix;\\n\\t\\tuniform mat4 u_projectionMatrix;\\n\\t\\tuniform mediump float u_borderWeight;\\n\\t\\tvarying vec4 v_color;\\n\\t\\tvarying vec4 v_uv;\\n\\t\\tvarying float v_textureIndex;\\n\\t\\tvarying vec2 v_rs;\\n\\n\\t\\tvoid main(void) {\\n\\t\\t\\tv_color = a_color;\\n\\t\\t\\tv_uv = a_uv;\\n\\t\\t\\tv_textureIndex = a_textureIndex;\\n\\t\\t\\tvec4 pos = vec4(a_vertex, 1.0);\\n\\t\\t\\tgl_Position = u_projectionMatrix * u_modelViewMatrix * pos;\\n\\t\\t\\tgl_PointSize = a_size*u_retinaRatio;\\n\\t\\t\\tv_rs = vec2(a_size/2.0,a_size/2.0-u_borderWeight)*u_retinaRatio;//\\u5916\\u534a\\u5f84\\uff0c\\u5185\\u534a\\u5f84\\n\\t\\t}\\n\\t", Wd:" precision mediump float;\\n\\t\\tvarying vec4 v_color;\\n\\t\\tvarying vec4 v_uv;\\n\\t\\tvarying float v_textureIndex;\\n\\t\\tvarying float v_borderFactor;\\n\\t\\tuniform vec4 u_borderColor;\\n\\t\\tuniform int u_textureNum;\\n\\t\\tuniform int u_merge;\\n\\t\\tuniform float u_borderWeight;\\n\\t\\tuniform sampler2D u_textures[8];\\n\\t\\tvarying vec2 v_rs;\\n\\t\\tvoid main(void) {\\n\\t\\t\\tfloat ro = v_rs.x;\\n\\t\\t\\tfloat ri = v_rs.y;\\n\\t\\t\\tfloat dis2center = distance(gl_PointCoord,vec2(0.5,0.5))*ro*2.0;//\\u8ddd\\u79bb\\u8fb9\\u754c\\u7684\\u50cf\\u7d20\\u8ddd\\u79bb\\n\\t\\t\\tif(dis2center>ro){\\n\\t\\t\\t\\tdiscard;\\n\\t\\t\\t}\\n\\t\\t\\tif(u_borderWeight>0.0){//\\u6709border\\n\\t\\t\\t\\tif(dis2center>ro-1.0){\\n\\t\\t\\t\\t\\tgl_FragColor = vec4(u_borderColor.xyz,u_borderColor.a*(ro-dis2center));\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}else if(dis2center>ri){\\n\\t\\t\\t\\t\\tgl_FragColor=u_borderColor;\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\t\\t\\tvec4 color = v_color;\\n\\t\\t\\tif (u_textureNum != 0) {\\n\\t\\t\\t\\tfloat textureIndex;\\n\\t\\t\\t\\tif (u_textureNum == 1) {\\n\\t\\t\\t\\t\\ttextureIndex = 0.0;\\n\\t\\t\\t\\t} else {\\n\\t\\t\\t\\t\\ttextureIndex = v_textureIndex;\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\tvec2 uv = mix(v_uv.xy,v_uv.zw,gl_PointCoord);\\n\\t\\t\\t\\tif (textureIndex == 0.0) {\\n\\t\\t\\t\\t\\tcolor = texture2D(u_textures[0], uv);\\n\\t\\t\\t\\t} else if (textureIndex == 1.0) {\\n\\t\\t\\t\\t\\tcolor = texture2D(u_textures[1], uv);\\n\\t\\t\\t\\t} else if (textureIndex == 2.0) {\\n\\t\\t\\t\\t\\tcolor = texture2D(u_textures[2], uv);\\n\\t\\t\\t\\t} else if (textureIndex == 3.0) {\\n\\t\\t\\t\\t\\tcolor = texture2D(u_textures[3], uv);\\n\\t\\t\\t\\t} else if (textureIndex == 4.0) {\\n\\t\\t\\t\\t\\tcolor = texture2D(u_textures[4], uv);\\n\\t\\t\\t\\t} else if (textureIndex == 5.0) {\\n\\t\\t\\t\\t\\tcolor = texture2D(u_textures[5], uv);\\n\\t\\t\\t\\t} else if (textureIndex == 6.0) {\\n\\t\\t\\t\\t\\tcolor = texture2D(u_textures[6], uv);\\n\\t\\t\\t\\t} else if (textureIndex == 7.0) {\\n\\t\\t\\t\\t\\tcolor = texture2D(u_textures[7], uv);\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\tif(u_merge==1){\\n\\t\\t\\t\\t\\tcolor = vec4(color.rgb * color.a + v_color.rgb * (1.0 - color.a), color.a+v_color.a*(1.0-color.a));\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\t\\t\\tif(dis2center>ri-1.0){\\n\\t\\t\\t\\tfloat factor = ri-dis2center;//\\u586b\\u5145\\u8272\\u7684\\u767e\\u5206\\u6bd4\\n\\t\\t\\t\\tif (u_borderWeight == 0.0) {\\n\\t\\t\\t\\t\\tfloat a = color.a*factor;\\n\\t\\t\\t\\t\\tgl_FragColor = vec4(color.rgb, a);\\n\\t\\t\\t\\t} else {\\n\\t\\t\\t\\t\\tfloat a = u_borderColor.a*(1.0-factor) +color.a*factor;\\n\\t\\t\\t\\t\\tgl_FragColor = vec4(u_borderColor.rgb * (1.0-factor) + color.rgb * factor, a);\\n\\t\\t\\t\\t}\\n\\t\\t\\t}else{\\n\\t\\t\\t\\tgl_FragColor=color;\\n\\t\\t\\t}\\n\\t\\t}"}});g.Wb.z$=g.Wb.Aw.extend({r:function(a){this.CLASS_NAME=this.CLASS_NAME||"AMap.Object3D.MeshLine";this.ph(arguments);this.type="meshline";this.B=a},TB:function(a){(this.lS||this.needUpdate)&&this.Pq(this.B,a)},Pq:function(a,b){var c=g.a,d=a.path,e=a.height||0,f=c.Tm(a.color||"black"),h=[],k=[],l=a.unit;"px"===l?d[0]instanceof g.H||c.Rb(d,function(a,b){d[b]=new g.H(a[0],a[1])}):d[0]instanceof g.T||c.Rb(d,function(a,b){d[b]=new g.T(a[0],a[1])});var e=c.isArray(e)?c.map(e,function(a){return-1*a}):c.map(d, function(){return-1*e}),m=e[e.length-1];d.forEach(function(a,c){var d=void 0,d="px"===l?a:b.VI(a);h.push(d.x,d.y,e[c]||m);k.push.apply(k,f)});this.da.Y.length&&this.da.Y.splice(0,this.da.Y.length);this.da.Wa.length&&this.da.Wa.splice(0,this.da.Wa.length);this.da.Y.push.apply(this.da.Y,h);this.da.Wa.push.apply(this.da.Wa,k)},setColor:function(a){this.B.color=a;this.TG()},setHeight:function(a){this.B.height=a;this.TG()},setWidth:function(a){this.width=this.B.width=a;this.TG()},setPath:function(a){this.B.path= a;this.TG();this.TB(this.o.get("map"))},TG:function(){this.lS=this.needUpdate=!0;this.reDraw()}});$=window.AMap;$.Vector3=g.Oa;$.Object3D=g.Wb;$.Object3DLayer=z.o.Mq;$.Object3DGroup=g.B$;$.Walls=g.dF;$.Object3D.Mesh=g.Wb.ft;$.Object3D.MeshAcceptLights=g.Wb.SE;$.Object3D.Prism=g.Wb.kL;$.Object3D.Wall=g.Wb.laa;$.Object3D.Line=g.Wb.Vo;$.Object3D.ThinLine=g.Wb.MV;$.Object3D.Points=g.Wb.Xz;$.Object3D.RoundPoints=g.Wb.M$;$.Object3D.MeshLine=g.Wb.z$;$.Geometry3D={Mesh:g.Ee.ft,Line:g.Ee.Vo,Points:g.Ee.Xz};$.Lights={AmbientLight:g.nw.VU,DirectionLight:g.nw.dV}; ')