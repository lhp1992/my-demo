_jsload_('AMap.Geolocation', 'g.yn=g.aa.extend({ja:[g.sa],xi:".amap-geolocation-con .amap-geo{background:#fff url(../../theme/v1.3/markers/b/loc_gray.png) 50% 50% no-repeat;width:35px;height:35px;border:1px solid #ccc;border-radius:3px;right:4px}.amap-locate-loading .amap-geo{background-image:url(../../theme/v1.3/loading.gif)}.amap-locate{position:absolute;width:18px;height:18px;background:url(../../theme/v1.3/map_view.png);_background:url(../../theme/v1.3/map_view.gif);background-position:-130px -185px;cursor:pointer}",r:function(a){this.CLASS_NAME= "AMap.Geolocation";g.c.va(this,a);this.options={enableHighAccuracy:!1,timeout:5E3,maximumAge:0,GeoLocationFirst:!1,convert:!0,convertUrl:g.A.Rd+"/v3/assistant/coordinate/convert?coordsys=gps&output=json&s=rsv3&locations={x},{y}&key="+g.A.key,showButton:!0,buttonDom:\'<div class="amap-geo"></div>\',buttonPosition:"LB",buttonOffset:new g.H(10,20),showMarker:!0,markerOptions:{innerOverlay:!0,offset:new g.H(-11,-11),content:"<div style=\'width:23px;height:23px;overflow:hidden;\'><img style=\'position:relative;cursor:pointer;\'  width=\'23px\' height=\'23px\'  src=\'"+ g.A.ri+"/loc.png\'></div>"},showCircle:!0,circleOptions:{innerOverlay:!0,strokeColor:"#0093FF",noSelect:!0,strokeOpacity:0.5,strokeWeight:1,fillColor:"#02B0FF",fillOpacity:0.25},panToLocation:!0,zoomToAccuracy:!1,noIpLocate:0,noGeoLocation:0,useNative:!1,extensions:"base",stopWhenPermissionDenied:!0};if(a)for(var b in a)b in this.options&&(this.options[b]=a[b]);switch(this.options.noGeoLocation){case 0:this.xz=!0;break;case 1:this.xz=!g.l.Z;break;case 2:this.xz=g.l.Z;break;case 3:this.xz=!1;break; default:this.xz=!0}switch(this.options.noIpLocate){case 0:this.Uv=!0;break;case 1:this.Uv=!g.l.Z;break;case 2:this.Uv=g.l.Z;break;case 3:this.Uv=!1;break;case !0:this.Uv=!1;break;default:this.Uv=!0}this.Hb=this.Mb=this.QL=this.Kw=this.Wh=this.e=null;this.XW=g.event.addListener(this,"complete",this.Lsa,this);this.pX=g.event.addListener(this,"error",this.Nsa,this)},isSupported:function(){return!!navigator.geolocation},Al:function(a){new g.fb.vb(g.A.Cc+"://webapi.amap.com/count?"+["type=loc","k="+g.A.key, "u="+g.A.Wt,"m="+(g.l.Z?1:0),"pf="+g.l.Uy,"suc="+a].join("&"))},Qoa:function(a){function b(b){b.status=1;d.bv(b,function(b,c){c.info="SUCCESS";a&&a("complete",c);g.event.O(d,"complete",c)})}function c(b){function c(f){f.message=b.message+f.message;f.status=1;d.bv(f,function(b,c){c.info="SUCCESS";a&&a("complete",c);g.event.O(d,"complete",c)})}function h(c){b.message+=c.message;b.info="FAILED";b.status=0;a&&a("error",b);g.event.O(d,"error",b)}d.xz?d.V2(c,h):h({message:"GeoLocation is closed by noGeoLocation option,pass Geolocation."})} var d=this;d.Uv?d.a3(b,c):c({message:"IpLocation is closed by noIpLocate option,pass IpLocation."})},V2:function(a,b){if(this.isSupported()){var c=this;g.a.OQ(function(d,e){if(d)c.Al("err"),b({message:d?d.message:""});else{var f=setTimeout(function(){f=null;b({message:"Get geolocation time out."});c.Al("waitetimeout");h=!0},c.options.timeout),h=!1;e.getCurrentPosition(function(d){if(!h)if(clearTimeout(f),d.coords&&d.coords.longitude){c.Al("success");d={position:new g.T(d.coords.longitude,d.coords.latitude), location_type:"html5",message:"Get geolocation success.",accuracy:d.coords.accuracy};var e=!1;g.l.F2&&(e=!0);c.options.convert?e?(d.isConverted=!0,d.message+="Don\'t need convert.",a(d)):c.BH(d,function(b){a(b)}):(e?(d.message+="Don\'t need convert.",d.isConverted=!0):(d.isConverted=!1,d.message+="convert option is false,pass convert."),a(d))}else c.Al("failed"),b({code:2,info:"POSITION_UNAVAILABLE",message:"Get geolocation failed."})},function(a){h||(clearTimeout(f),1===a.code?(a={code:1,info:"PERMISSION_DENIED", message:"Geolocation permission denied."},c.Al("denied"),b(a)):3===a.code?(a={code:3,info:"TIME_OUT",message:"Get geolocation time out."},c.Al("timeout"),b(a)):2===a.code&&(a={code:3,info:"POSITION_UNAVAILABLE",message:"Get geolocation failed."},c.Al("failed"),b(a)))},this.options)}},{timeout:c.options.timeout})}else b({message:"Browser not Support html5 geolocation."})},BH:function(a,b){var c=a.position,c=this.options.convertUrl.replace("{x}",c.Q).replace("{y}",c.P),c=new g.fb.vb(c,{callback:"callback"}); g.event.addListener(c,"complete",function(c){1===parseInt(c.status)&&c.locations?(c=c.locations.split(","),c=new g.T(parseFloat(c[0]),parseFloat(c[1])),a.position=c,a.isConverted=!0,a.message+="Convert Success."):(a.isConverted=!1,a.message+="Convert failed.");b(a)},this);g.event.addListener(c,"error",function(){a.message+="Convert request failed.";a.isConverted=!1;b(a)},this)},a3:function(a,b){var c=new g.fb.vb(g.A.Cc+"://webapi.amap.com/maps/ipLocation?key="+g.A.key,{callback:"callback"});c.g("complete", function(c){c.status&&c.lng&&c.lat?(c.position=g.a.ana(c.lng,c.lat),delete c.lng,delete c.lat,c.message="Get ipLocation success.",c.location_type="ip",c.accuracy=null,c.isConverted=!0,a(c)):b({message:"Get ipLocation failed."})},this);c.g("error",function(){b({message:"Request ipLocation failed."})},this)},Poa:function(a){function b(b){function e(e){e.message=b.message+e.message;e.status=1;c.bv(e,function(b,d){d.info="SUCCESS";a&&a("complete",d);g.event.O(c,"complete",d)})}function f(e){b.message+= e.message;if(1===e.code)b.info="FAILED",b.status=0,a&&a("error",b),g.event.O(c,"error",b);else{e=function(e){b.message+=e.message;b.info="FAILED";b.status=0;a&&a("error",b);g.event.O(c,"error",b)};var f=function(e){e.status=1;e.message=b.message+e.message;c.bv(e,function(b,d){d.info="SUCCESS";a&&a("complete",d);g.event.O(c,"complete",d)})};c.Uv?c.a3(f,e):e({message:"IpLocation is closed by noIpLocate option,pass ipLocation."})}}c.xz?c.V2(e,f):f({message:"Geolocation is closed by noGeoLocation option,pass Geolocation."})} var c=this;this.options.useNative&&g.l.El?this.Tra(function(b){b.status=1;c.bv(b,function(b,d){d.info="SUCCESS";a&&a("complete",d);g.event.O(c,"complete",d)})},function(a){b(a)}):b({message:""})},getCurrentPosition:function(a){g.c.add(this,"getCurrentPosition");this.lN=!0;g.j.Ra(this.Wh,"amap-locate-loading");g.l.Z||this.options.GeoLocationFirst?this.Poa(a):this.Qoa(a)},getCityInfo:function(a){g.c.add(this,"getCityInfo");var b=new g.fb.vb(g.A.Cc+"://webapi.amap.com/maps/ipCity?key="+g.A.key,{callback:"callback"}); b.g("complete",function(b){b.center&&1===b.status?(b.isConverted=!0,b.info="SUCCESS",b.message="Get city by ip success.",a&&a("complete",b)):(b.info="FAILED",b.message="Get city by ip failed.",a&&a("error",b))},this);b.g("error",function(){a&&a("error",{status:0,message:"Request ipCity failed.",info:"FAILED"})},this)},watchPosition:function(){if(this.options.useNative&&window.AMapAndroidLoc)this.hya();else if(g.c.add(this,"watchPosition"),this.isSupported()){if(g.l.Z){var a=this;return g.a.OQ(function(b, c,d){if(b)g.event.O(a,"error",{status:0,info:"FAILED",message:"Get geolocation error on watch."});else return b=c.watchPosition(function(b){if(b.coords&&b.coords.longitude){b={position:new g.T(b.coords.longitude,b.coords.latitude),location_type:"html5",message:"Watch position success by GeoLocation.",status:1,accuracy:b.coords.accuracy};var c=!1;g.l.F2&&(c=!0);var d=function(b){a.bv(b,function(b,c){c.info="SUCCESS";g.event.O(a,"complete",c)})};a.options.convert?c?(b.message+="Don\'t need convert.", b.isConverted=!0,d(b)):a.BH(b,function(a){d(a)}):(c?(b.message+="Don\'t need convert.",b.isConverted=!0):(b.message+="convert option is false,pass convert.",b.isConverted=!1),d(b))}else g.event.O(a,"error",{status:0,info:"FAILED",message:"Watch position failed by GeoLocation,incorrect position."})},function(){g.event.O(a,"error",{status:0,info:"FAILED",message:"Watch position failed by GeoLocation."})},a.options),d&&g.a.Rva(d,b),b},{eya:!0})}g.event.O(this,"error",{status:0,info:"NOT_SUPPORT",message:"Forbidden watchPosition on PC device."})}else return g.event.O(this, "error",{status:0,info:"NOT_SUPPORT",message:"Browser not Support html5 GeoLocation."}),null},clearWatch:function(a){g.c.add(this,"clearWatch");if(this.options.useNative&&window.AMapAndroidLoc)g.yn.dw.ni.rwa(this);else if(this.isSupported())return g.a.OQ(function(b,c){b||g.a.dya(a,function(b,e){b||(g.a.ama(a),c.clearWatch(e))})})},Tt:function(a,b){if(!this.Wh){var c=document.createElement("div");this.lN&&g.j.Ra(c,"amap-locate-loading");g.j.Ra(c,"amap-geolocation-con");"object"===typeof this.options.buttonDom? c.appendChild(this.options.buttonDom):c.innerHTML=this.options.buttonDom;c.style.position="absolute";c.style.zIndex="9999";this.options.showButton||(c.style.visibility="hidden");this.tB(c,this.options.buttonPosition,this.options.buttonOffset);this.Wh=c}this.e=a;b.appendChild(this.Wh);this.Kw=b;this.QL=g.event.X(this.Wh,"click",this.Ksa,this)},qv:function(){g.event.removeListener(this.XW);this.XW=null;g.event.removeListener(this.pX);this.pX=null;g.event.removeListener(this.QL);this.QL=null;this.Kw.removeChild(this.Wh); this.e=this.Kw=null;this.Mb&&(this.Mb.setMap(null),this.Mb=null);this.Hb&&(this.Hb.setMap(null),this.Hb=null)},tB:function(a,b,c){"LT"!==b&&"RT"!==b&&"LB"!==b&&"RB"!==b&&(b="LT");switch(b){case "LT":g.j.Va(a,{left:c.x+"px",top:c.y+"px",right:"",bottom:""});break;case "RT":g.j.Va(a,{right:c.x+"px",top:c.y+"px",left:"",bottom:""});break;case "LB":g.j.Va(a,{left:c.x+"px",bottom:c.y+"px",right:"",top:""});break;case "RB":g.j.Va(a,{right:c.x+"px",bottom:c.y+"px",left:"",top:""})}this.Kw&&(this.Kw.removeChild(a), this.Kw.appendChild(a))},ewa:function(a,b){if(this.e){var c=this.options;c.showMarker&&(this.Mb||(this.Mb=new z.w.rb(c.markerOptions),this.Mb.za=!0),this.Mb.setPosition(a),this.Mb.setMap(this.e));c.showCircle&&(this.Hb||(this.Hb=new z.w.Ug(c.circleOptions)),this.Hb.setCenter(a),this.Hb.setRadius(b||0),this.Hb.setMap(this.e),this.Hb.za=!0);c.panToLocation&&this.e.panTo(a);c.zoomToAccuracy&&this.Hb&&this.e.setFitView([this.Hb])}},ZCa:function(){this.Mb&&this.Mb.setMap(null);this.Hb&&this.Hb.setMap(null)}, bv:function(a,b){var c=this,d=a.position;g.qb.load("AMap.Geocoder",function(){c.G2||(c.G2=new g.kV({extensions:c.options.extensions}));c.G2.getAddress(d,function(c,d){"complete"===c?(g.extend(a,d.regeocode),a.message+="Get address success."):a.message+="Get address fail,check your key or network.";b("complete",a)})})},Ksa:function(){this.getCurrentPosition()},Lsa:function(a){this.lN=!1;g.j.ab(this.Wh,"amap-locate-loading");this.ewa(a.position,a.accuracy)},Nsa:function(){this.lN=!1;g.j.ab(this.Wh, "amap-locate-loading")},Tra:function(a,b){function c(a){1!==a&&d.Al("sdkerror");b&&b.call&&b.call(d,{message:"Get sdkLocation failed."})}if(window.AMapAndroidLoc)this.Ura(a,b);else{var d=this,e=new g.fb.vb("http://127.0.0.1:43689/geolocation?to=3000&_="+(new Date).getTime(),{callback:"callback"});e.g("complete",function(b){a&&a.call&&b.location&&b.location.x&&b.location.y?(a.call(d,{position:new g.T(b.location.x,b.location.y),accuracy:b.location.precision,message:"Get sdkLocation success.",location_type:"sdk", isConverted:!0}),d.Al("sdksuccess")):(c(1),d.Al("sdkfail"))});e.g("error",c)}},Ura:function(a,b){var c=this;g.yn.dw.ni.opa(this,function(d){a&&a.call&&d.result&&d.result.x&&d.result.y?(a.call(c,{position:new g.T(d.result.x,d.result.y),accuracy:d.result.precision,message:"Get sdkLocation success.",location_type:"sdk",isConverted:!0}),c.Al("sdksuccess")):(b&&b.call&&b.call(c,{sdkErrorInfo:d.errorInfo,sdkLocationDetail:d.locationDetail,message:"Get sdkLocation failed."}),c.Al("sdkfail"))})},hya:function(){var a= this;g.yn.dw.ni.gya(this,function(b){b.result&&b.result.x&&b.result.y?(b={position:new g.T(b.result.x,b.result.y),location_type:"sdk",message:"Watch position success by Android SDK.",status:1,accuracy:b.result.precision},b.message+="Don\'t need convert.",b.isConverted=!0,function(b){a.bv(b,function(b,c){c.info="SUCCESS";g.event.O(a,"complete",c)})}(b)):g.event.O(a,"error",{status:0,info:"FAILED",message:"Watch position failed by Android SDK,incorrect position."})})}});window.AMap.Geolocation=g.yn; g.yn.cbk=function(a){a=JSON.parse(a);var b=g.yn.dw.ni;b.q("get",a);b.q("watch",a)}; g.yn.dw=g.aa.extend({ja:[g.sa],r:function(){},opa:function(a,b){var c=window.AMapAndroidLoc;this.g("get",b,a,!0);this.ee("watch")||c.getLocation(JSON.stringify({to:a.options.timeout,useGPS:1,watch:0,callback:"AMap.Geolocation.cbk"}))},gya:function(a,b){this.ee("watch")||window.AMapAndroidLoc.getLocation(JSON.stringify({to:a.options.timeout,useGPS:1,watch:1,interval:a.options.watchInterval||5,callback:"AMap.Geolocation.cbk"}));this.g("watch",b,a)},rwa:function(a){var b=window.AMapAndroidLoc;this.nJ("watch", a);this.ee("watch")||b.stopLocation()}});g.yn.dw.ni=new g.yn.dw; ')